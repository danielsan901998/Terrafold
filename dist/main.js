function W(t){let r=1;if(t.ctrlKey)r*=5;if(t.shiftKey)r*=10;return r}function Bt(t){return Math.floor(t*10)/10}function Ht(t){return Math.floor(t*100)/100}function yt(t){return Number(t.toPrecision(2))}function I(t){return Number(t.toPrecision(3))}function B(t,r,s,i,u){return v(t,r,s,i)<u}function v(t,r,s,i){return Math.sqrt(Math.pow(Math.abs(t-s),2)+Math.pow(Math.abs(r-i),2))}function _t(t,r){let s=1;if(t<0)s=-1,t*=-1;if(t>=1e4)return(s===1?"+":"-")+vt(t,3);else return(s===1?"+":"-")+Ot(t,r)}function n(t,r){if(t>=1e4)return vt(t,3);else return Ot(t,r)}function Ot(t,r){if(Number.isInteger(t))return t.toString();let s=3;if(r!==void 0)s=r;return t.toFixed(s-1).replace(bt,"$1")}var It=[{value:1000000000000000000000000000000000000000000000000000000000000000,symbol:"V"},{value:1000000000000000000000000000000000000000000000000000000000000,symbol:"Nd"},{value:1000000000000000000000000000000000000000000000000000000000,symbol:"Od"},{value:1000000000000000000000000000000000000000000000000000000,symbol:"Sd"},{value:1000000000000000000000000000000000000000000000000000,symbol:"sd"},{value:1000000000000000000000000000000000000000000000000,symbol:"Qd"},{value:1000000000000000000000000000000000000000000000,symbol:"qd"},{value:1000000000000000000000000000000000000000000,symbol:"Td"},{value:1000000000000000000000000000000000000000,symbol:"Dd"},{value:1000000000000000000000000000000000000,symbol:"Ud"},{value:1000000000000000000000000000000000,symbol:"Dc"},{value:1000000000000000000000000000000,symbol:"N"},{value:1000000000000000000000000000,symbol:"O"},{value:1000000000000000000000000,symbol:"Sp"},{value:1000000000000000000000,symbol:"Sx"},{value:1000000000000000000,symbol:"Qi"},{value:1000000000000000,symbol:"Qa"},{value:1000000000000,symbol:"T"},{value:1e9,symbol:"B"},{value:1e6,symbol:"M"},{value:1000,symbol:"K"}],bt=/\.0+$|(\.[0-9]*[1-9])0+$/,_=new Map;function vt(t,r){let s=t+"|"+r,i=_.get(s);if(i!==void 0)return i;let u,d=!1;for(let h=0;h<It.length;h++){let b=It[h];if(b&&t>=b.value/1.000501){u=(t/b.value).toPrecision(r).replace(bt,"$1")+b.symbol,d=!0;break}}if(!d)u=t.toPrecision(r).replace(bt,"$1");if(_.size>1000){let h=_.keys().next().value;if(h!==void 0)_.delete(h)}return _.set(s,u),u}function Ct(t,r){t.sort((s,i)=>s[r]-i[r])}async function Et(t){let r=new Blob([t]).stream().pipeThrough(new CompressionStream("gzip")),i=await new Response(r).arrayBuffer(),u=new Uint8Array(i),d="";for(let h=0;h<u.byteLength;h++)d+=String.fromCharCode(u[h]);return btoa(d)}async function Tt(t){if(!t)return"";let r=t.trim();if(r.startsWith("{")&&r.endsWith("}"))return r;try{let s=atob(t),i=Uint8Array.from(s,(d)=>d.codePointAt(0)),u=new Blob([i]).stream().pipeThrough(new DecompressionStream("gzip"));return new Response(u).text()}catch(s){return t}}class m{static foodPerShip=20;static actionRate=1;static actionSpeed=40;static defaultSpeed=0.5;static emptySpeed=0.05;static globalTargetIndex=-1;static tick(t){m.checkEmpty(t),m.moveToNearestTarget(t),m.checkJoinFleet(t),m.attackTarget(t)}static updateGlobalTarget(){if(!e)return;let t=e.hangar.getTarget();m.globalTargetIndex=m.findClosestTarget(t.x,t.y)}static findClosestTarget(t,r){if(!e)return-1;let s=-1,i=1/0;for(let u=0;u<e.space.planets.length;u++){let d=e.space.planets[u];if(!f.doneBuilding(d)){let h=v(t,r,d.x,d.y);if(s===-1||h<i)s=u,i=h}}return s}static checkJoinFleet(t){if(!e||!t.engaged)return;for(let r=e.space.ships.length-1;r>=0;r--){let s=e.space.ships[r];if(s===t||m.isEmpty(s))continue;if(B(t.x,t.y,s.x,s.y,20))m.combineShips(t,s),e.space.ships.splice(r,1)}}static checkEmpty(t){if(t.food-=t.count,!m.isEmpty(t))return;t.food=0,t.engaged=!1,t.targetIndex=-1}static getTargetObject(t){if(!e)return null;if(t.targetIndex===-1)return e.hangar.getTarget();if(t.targetIndex>=0&&t.targetIndex<e.space.planets.length){let r=e.space.planets[t.targetIndex];if(!f.doneBuilding(r))return r}return t.targetIndex=m.findClosestTarget(t.x,t.y),t.targetIndex===-1?e.hangar.getTarget():e.space.planets[t.targetIndex]}static returnHome(t){if(!e)return;e.spaceDock.battleships+=t.count,e.spaceDock.sended-=t.count,e.farms.food+=t.food*m.foodPerShip,e.events.emit("spaceDock:updated");for(let r=e.space.ships.length-1;r>=0;r--)if(e.space.ships[r]===t){e.space.ships.splice(r,1);break}}static isEmpty(t){return t.food<=0}static getSpeed(t){return m.isEmpty(t)?m.emptySpeed:m.defaultSpeed}static moveToNearestTarget(t){let r=m.getTargetObject(t);if(!r)return;if(v(t.x,t.y,r.x,r.y)<40){if(!("isHome"in r)){t.engaged=!0;return}m.returnHome(t);return}t.engaged=!1;let s=m.getSpeed(t),i=0,u=r.y-t.y,d=r.x-t.x;if(u>=0&&d<0||u<0&&d<0)i=Math.PI;let h=Math.atan(u/d)+i;t.x=t.x+s*Math.cos(h),t.y=t.y+s*Math.sin(h),t.direction=h}static attackTarget(t){let r=m.getTargetObject(t);if(r&&!("isHome"in r)&&t.engaged){let s=r;if(t.actionCounter++,t.actionCounter>=m.actionSpeed){if(t.actionCounter=0,f.alive(s))f.takeDamage(s,m.actionRate*t.count);else if(f.workConstruction(s,t.count),f.doneBuilding(s))t.engaged=!1,t.targetIndex=m.findClosestTarget(t.x,t.y)}}}static combineShips(t,r){if(t.count+=r.count,t.energy+=r.energy,t.food+=r.food,r.actionCounter>t.actionCounter)t.actionCounter=r.actionCounter}}var T=document.getElementById("spaceCanvas"),o=T?T.getContext("2d"):null;if(o)o.font="13px Arial";var H=240,pt={x:0,y:0};function Ut(){if(!T||!e)return;if(T.width!==e.canvasWidth||T.height!==e.canvasHeight){if(T.width=e.canvasWidth,T.height=e.canvasHeight,H=T.width/5,o)o.font="13px Arial"}}if(T)window.addEventListener("resize",Ut),Ut(),T.addEventListener("mousemove",function(t){pt={x:t.offsetX-H,y:t.offsetY}});function kt(){if(!o||!e||!T)return;o.clearRect(0,0,T.width,T.height),Zt(),Qt(),wt()}function wt(){if(!e)return;for(let t=0;t<e.space.planets.length;t++)Dt(e.space.planets[t])}function Qt(){if(!e)return;for(let t=0;t<e.space.ships.length;t++)jt(e.space.ships[t])}function Zt(){if(!e)return;for(let t=0;t<e.space.planets.length;t++){let r=e.space.planets[t];Jt(r,r.isBoss?"B":(t+1).toString())}}function jt(t){if(!o)return;let r=t.x+H,s=m.getTargetObject(t);if(t.engaged&&s&&t.actionCounter<10){let b="isHome"in s,y=xt(!b?s.isBoss:!1);o.save(),o.beginPath(),o.strokeStyle="rgba(255, 50, 50, "+(1-t.actionCounter/10)+")",o.lineWidth=3,o.moveTo(r+25,t.y+25),o.lineTo(s.x+H+y,s.y+y),o.stroke(),o.restore()}o.save(),o.translate(r+25,t.y+25),o.rotate(t.direction);let i={x:-10,y:-10},u={x:10,y:0},d={x:-10,y:10},h={x:-7,y:0};o.beginPath(),o.fillStyle="#008080",o.lineWidth=3,o.moveTo(i.x,i.y),o.lineTo(u.x,u.y),o.lineTo(d.x,d.y),o.lineTo(h.x,h.y),o.fill(),o.restore(),o.save(),o.translate(r+25,t.y+25),o.fillStyle="white",o.fillText(t.count.toString(),-4,20),o.fillText(n(t.food/t.count/10),-4,30),o.restore()}function Jt(t,r){if(!o)return;let s=xt(t.isBoss),i=t.x+H;o.save(),o.translate(i+s,t.y+s),zt(t,s),Pt(t,s),gt(t,s),o.fillStyle="white",o.fillText(r,-3,4),o.restore()}function Dt(t){if(!o)return;let r=xt(t.isBoss),s=t.x+H;if(!B(pt.x,pt.y,t.x+r,t.y+r,50))return;o.save(),o.translate(s+r,t.y+r),o.fillStyle="#ffffff",o.fillText("Atmosphere: "+n(t.atmo),-15,r),o.fillText("Reduction: "+n(f.getShieldReduction(t)*100)+"%",-15,r+10),o.fillText("Health: "+n(t.health),-15,r+20),o.fillText("Dirt: "+n(t.dirt),-15,r+30),o.fillText("Ore: "+n(t.ore),-15,r+40),o.fillText("C.Bots: "+t.bots+" / "+t.maxMines,-15,r+50),o.fillText("Solar: "+t.solar,-15,r+60),o.fillText("Build Factory: "+t.factoryTicks+" / "+f.FACTORY_TICKS_MAX,-15,r+70),o.fillText("Build Coilgun: "+t.coilgunTicks+" / "+f.COILGUN_TICKS_MAX,-15,r+80),o.fillText("Coilgun Charge: "+n(t.coilgunCharge)+" / "+f.COILGUN_CHARGE_MAX,-15,r+90),o.fillText("Build Solar: "+n(t.solarTicks)+" / "+f.SOLAR_TICKS_MAX,-15,r+100),o.fillText("Mines: "+t.mines+" / "+t.maxMines,-15,r+110),o.fillText("Build Mine: "+t.mineTicks+" / "+f.MINE_TICKS_MAX,-15,r+120),o.restore()}function zt(t,r){if(!o)return;let s=r*(t.atmo/t.maxAtmo/2+0.5),i=o.createRadialGradient(0,0,s*1.1,0,0,s/3.3);i.addColorStop(0,"black");let u="hsl("+(t.view.color+120)+",90%,60%)";i.addColorStop(1,u),o.fillStyle=i,o.fillRect(-r,-r,r*2,r*2),o.beginPath(),o.strokeStyle="#008080",o.lineWidth=3,o.arc(0,0,r-4,0,2*Math.PI*(t.atmo/t.maxAtmo)),o.stroke()}function Pt(t,r){if(!o)return;o.beginPath();let s=Math.floor(t.health/t.maxHealth*70+10);o.fillStyle="hsl("+t.view.color+","+s+"%,"+t.view.light+"%)",o.arc(0,0,r/2,0,2*Math.PI),o.fill(),o.beginPath(),o.strokeStyle="#b6000b",o.lineWidth=3,o.moveTo(-r*2/3,-r),o.lineTo(-r*2/3+r*4/3*(t.health/t.maxHealth),-r),o.stroke()}function gt(t,r){if(!o||f.empty(t))return;let s=Math.PI/2,i=-s;if(t.factoryTicks>0&&t.factoryTicks<f.FACTORY_TICKS_MAX){let d=2*(t.factoryTicks/f.FACTORY_TICKS_MAX)*Math.PI-s;o.beginPath(),o.strokeStyle="#888888",o.lineWidth=2,o.arc(0,0,r*0.9,i,d),o.stroke()}if(t.coilgunTicks>0&&t.coilgunTicks<f.COILGUN_TICKS_MAX){let d=2*(t.coilgunTicks/f.COILGUN_TICKS_MAX)*Math.PI-s;o.beginPath(),o.strokeStyle="#884400",o.lineWidth=2,o.arc(0,0,r*0.8,i,d),o.stroke()}if(t.coilgunTicks>=f.COILGUN_TICKS_MAX&&t.coilgunCharge>0){let d=2*(t.coilgunCharge/f.COILGUN_CHARGE_MAX)*Math.PI-s;o.beginPath(),o.strokeStyle="#ffcc00",o.lineWidth=2,o.arc(0,0,r*0.8,i,d),o.stroke()}if(t.solar>0||t.solarTicks>0){let d=2*(t.solarTicks/f.SOLAR_TICKS_MAX)*Math.PI-s;o.beginPath(),o.strokeStyle="#4444ff",o.lineWidth=2,o.arc(0,0,r*0.7,i,d),o.stroke()}if(t.mines<t.maxMines&&(t.mines>0||t.mineTicks>0)){let u=(t.mines+Math.min(1,t.mineTicks/f.MINE_TICKS_MAX))/t.maxMines,d=2*Math.min(1,u)*Math.PI-s;o.beginPath(),o.strokeStyle="#666666",o.lineWidth=2,o.arc(0,0,r*0.6,i,d),o.stroke()}}function Nt(t){if(t.view.rotation+=t.view.rotationSpeed/10+0.01,t.view.rotation>=Math.PI*2)t.view.rotation-=Math.PI*2}function xt(t){return t?40:25}class f{static MINE_TICKS_MAX=2000;static FACTORY_TICKS_MAX=8000;static SOLAR_TICKS_MAX=1000;static COILGUN_TICKS_MAX=1000;static COILGUN_CHARGE_MAX=1000;static findArea(t){if(!e)return;let r=0;while(f.isWithinDistanceOfAny(t,t.x,t.y,75)){if(r++,r>40){console.log("too many planets");return}t.x=f.xAreaAllowed(),t.y=f.yAreaAllowed()}}static xAreaAllowed(){if(!e)return 0;let t=e.canvasWidth*0.8;return Math.random()*(t-200)}static yAreaAllowed(){if(!e)return 0;let t=e.canvasHeight*0.8;return Math.random()*(t-55)+10}static isWithinDistanceOfAny(t,r,s,i){if(!e)return!1;for(let u=0;u<e.space.planets.length;u++){let d=e.space.planets[u];if(!d||d===t)continue;if(B(r,s,d.x,d.y,i))return!0}return!1}static tick(t){f.regenShields(t),f.tickResources(t),Nt(t)}static empty(t){return t.dirt<=0}static alive(t){return t.health>0}static regenShields(t){if(!f.alive(t)){t.atmo=0;return}if(t.atmo+=(t.maxAtmo-t.atmo)/100,t.atmo>t.maxAtmo)t.atmo=t.maxAtmo}static getShieldReduction(t){return t.atmo/t.maxAtmo}static takeDamage(t,r){let s=f.getShieldReduction(t),i=r*(1-s);t.atmo-=r*s;let u=0;if(t.atmo<0)u=t.atmo*-1,t.atmo=0;if(t.health-=i+u,t.health<0)t.health=0}static calcPower(t,r){t.power=r*(t.isBoss?1.5:1),t.atmo=t.maxAtmo=Math.min(200,I(t.power*2+100)),t.health=t.maxHealth=I(t.power*20+1000),t.dirt=I(t.power*200+2000),t.maxMines=Math.floor((t.dirt+0.1)/1000)}static workConstruction(t,r){if(!f.doneFactory(t)){f.workOnFactory(t,r);return}if(!f.doneCoilgun(t)){f.workOnCoilgun(t,r);return}f.workOnMine(t,r)}static tickResources(t){if(f.empty(t))return;f.tickMines(t),f.tickBots(t),f.tickFactory(t),f.tickSolar(t),f.tickCoilgun(t)}static doneBuilding(t){return t.mines>=t.maxMines}static workOnMine(t,r){if(t.mineTicks+=r,t.mineTicks>=f.MINE_TICKS_MAX){let s=Math.floor(t.mineTicks/f.MINE_TICKS_MAX);s=Math.min(s,t.maxMines-t.mines),t.mines+=s,t.mineTicks-=s*f.MINE_TICKS_MAX}}static tickMines(t){t.ore+=t.mines}static tickBots(t){let r=Math.min(t.bots,t.ore);t.ore-=r,f.workOnSolar(t,r)}static doneFactory(t){return t.factoryTicks>=f.FACTORY_TICKS_MAX}static workOnFactory(t,r){t.factoryTicks+=r}static tickFactory(t){if(t.ore>=200){let r=Math.floor(t.ore/200);t.bots+=r,t.ore-=r*200}}static workOnSolar(t,r){if(t.solarTicks+=r,t.solarTicks>=f.SOLAR_TICKS_MAX){let s=Math.floor(t.solarTicks/f.SOLAR_TICKS_MAX);t.solar+=s,t.solarTicks-=s*f.SOLAR_TICKS_MAX}}static tickSolar(t){t.coilgunCharge+=t.solar}static doneCoilgun(t){return t.coilgunTicks>=f.COILGUN_TICKS_MAX}static workOnCoilgun(t,r){t.coilgunTicks+=r}static tickCoilgun(t){if(t.coilgunCharge>=f.COILGUN_CHARGE_MAX){let r=Math.floor(t.coilgunCharge/f.COILGUN_CHARGE_MAX);t.coilgunCharge-=r*f.COILGUN_CHARGE_MAX;let s=500*r;if(t.dirt<=s)s=t.dirt;if(t.dirt-=s,e&&e.spaceStation.orbiting[1])e.spaceStation.orbiting[1].amount+=s}}}class C{isBoss=!1;view;x;y;mines=0;mineTicks=0;ore=0;bots=0;factoryTicks=0;solarTicks=0;solar=0;energy=0;coilgunTicks=0;coilgunCharge=0;id;power=0;atmo=0;maxAtmo=0;health=0;maxHealth=0;dirt=0;maxMines=0;constructor(){this.view={rotation:0,rotationSpeed:Math.random(),color:Math.floor(Math.random()*360),light:Math.floor(Math.random()*15+40)},this.x=f.xAreaAllowed(),this.y=f.yAreaAllowed(),f.findArea(this)}}class U{planets;ships;sector;constructor(){this.planets=[],this.ships=[],this.sector=0}tick(){let t=!0;m.updateGlobalTarget();for(let r=0;r<this.planets.length;r++){let s=this.planets[r];if(f.tick(s),f.empty(s)===!1)t=!1}if(t&&this.ships.length===0)this.planets=[],this.sector++,this.newLevel();for(let r=0;r<this.ships.length;r++)m.tick(this.ships[r])}spawnShip(t,r){t.x=-120,t.y=r,this.ships.push(t)}newLevel(){for(let r=0;r<10;r++){let s=new C;this.planets.push(s)}Ct(this.planets,"x");let t=this.planets[this.planets.length-1];if(t)t.isBoss=!0;for(let r=0;r<this.planets.length;r++)f.calcPower(this.planets[r],this.sector)}}class N{ice;buyable;gain;max;transferred;constructor(){this.ice=0,this.buyable=1000,this.gain=10,this.max=1000,this.transferred=0}tick(){if(this.buyable+=this.gain,this.buyable>this.max)this.buyable=this.max}transferWater(){return this.transferred=this.ice/1000,this.ice-=this.transferred,this.transferred}buyIce(t){if(this.buyable<t)t=this.buyable;return this.buyable-=t,this.ice+=t,t}findIceSeller(t){this.max+=t*200,this.gain+=t}}class V{indoor;outdoor;maxIndoor;selling;excess;gain;transferred=0;constructor(){this.indoor=0,this.outdoor=0,this.maxIndoor=50,this.selling=0,this.excess=0,this.gain=0}tick(t){if(this.indoor+=t,this.excess=this.indoor-this.maxIndoor,this.excess>0)this.indoor=this.maxIndoor,this.outdoor+=this.excess;else this.excess=0;if(this.selling=this.indoor/100,this.indoor-=this.selling,this.gain=this.selling*2,e)e.cash+=this.gain}transferWater(){return this.transferred=this.outdoor/1000,this.outdoor-=this.transferred,this.transferred}sellWater(t){if(this.indoor<t)t=this.indoor;if(this.indoor-=t,e)e.cash+=this.getPrice(t)}getPrice(t){return t*2}}class A{water;initialStormTimer;stormTimer;stormRate;storming;initialStormDuration;stormDuration;transferred;lightningChance;lightningStrength;constructor(){this.water=0,this.initialStormTimer=300,this.stormTimer=300,this.stormRate=0,this.storming=0,this.initialStormDuration=60,this.stormDuration=60,this.transferred=0,this.lightningChance=0,this.lightningStrength=0}tick(t){this.water+=t,this.nextStormTimer(),this.tickLightning()}tickLightning(){if(this.lightningChance+=0.01*this.stormRate/100,this.lightningStrength=this.water*0.01,this.stormRate===100&&this.lightningChance>Math.random()*100){if(this.lightningChance=0,e)e.energy.gainEnergy(this.lightningStrength)}}transferWater(){return this.transferred=this.water/500*this.stormRate/100,this.water-=this.transferred,this.transferred}nextStormTimer(){if(this.stormTimer>0)this.stormTimer--;else if(this.stormDuration>0)this.storming=1;if(this.stormRate>=100)if(this.storming=0,this.stormDuration>0)this.storming=0,this.stormDuration--;else this.storming=-1;else if(this.stormRate<=0&&this.storming===-1)this.stormDuration=this.initialStormDuration,this.stormTimer=this.initialStormTimer,this.storming=0;this.stormRate+=this.storming}gainStormDuration(t){this.stormDuration+=t,this.initialStormDuration+=t}}class M{land;baseLand;optimizedLand;water;soil;transferred;convertedLand=0;constructor(t){this.land=t,this.baseLand=t,this.optimizedLand=t,this.water=0,this.soil=0,this.transferred=0}tick(t){this.water+=t,this.turnLandToSoil()}turnLandToSoil(){if(this.convertedLand=this.water/1000,this.land<this.convertedLand)this.convertedLand=this.land;this.land-=this.convertedLand,this.soil+=this.convertedLand,this.water-=this.convertedLand}transferWater(){return this.transferred=this.water/1000,this.water-=this.transferred,this.transferred}improveLand(){let t=(10*this.baseLand-this.optimizedLand)/100;this.optimizedLand+=t,this.land+=t}addLand(t){this.optimizedLand+=t,this.land+=t,this.baseLand+=t}}class X{water;ferns;fernsDelta;fernsWaterUse;smallTrees;smallTreesDelta;smallTreesWaterUse;trees;treesDelta;treesWaterUse;totalPlants;oxygenGain;transferred=0;constructor(){this.water=0,this.ferns=0,this.fernsDelta=0,this.fernsWaterUse=0,this.smallTrees=0,this.smallTreesDelta=0,this.smallTreesWaterUse=0,this.trees=0,this.treesDelta=0,this.treesWaterUse=0,this.totalPlants=0,this.oxygenGain=0}tick(t){if(this.water+=t,this.plantGrowth(),this.oxygenGain=this.ferns/1000+3*this.smallTrees/1000+this.trees/100,e)e.oxygen+=this.oxygenGain}plantGrowth(){if(!e)return;if(this.totalPlants=this.ferns+this.smallTrees+this.trees,this.treesDelta=this.smallTrees/1000,this.smallTreesDelta=this.ferns/1000-this.treesDelta,this.fernsDelta=(e.land.soil-this.totalPlants)/1000-this.ferns/1000,this.fernsWaterUse=(e.land.soil-this.totalPlants)/1000,this.fernsWaterUse=this.fernsWaterUse<0?0:this.fernsWaterUse,this.smallTreesWaterUse=this.ferns/1000,this.treesWaterUse=this.smallTrees/1000,this.fernsDelta<0){let t=0;if(this.ferns+this.fernsDelta<0)t=this.fernsDelta+this.ferns,this.fernsDelta=-1*this.ferns;if(this.smallTreesDelta+=t,t=0,this.smallTrees+this.smallTreesDelta<0)t=this.smallTrees+this.smallTreesDelta,this.smallTreesDelta=-1*this.smallTrees;this.treesDelta+=t}if(this.water<this.treesWaterUse)this.treesDelta=this.treesDelta>0?this.water:this.treesDelta,this.treesWaterUse=this.water;if(this.trees+=this.treesDelta,this.water-=this.treesWaterUse,this.water<this.smallTreesWaterUse)this.smallTreesDelta=this.smallTreesDelta>0?this.water:this.smallTreesDelta,this.smallTreesWaterUse=this.water;if(this.smallTrees+=this.smallTreesDelta,this.water-=this.smallTreesWaterUse,this.water<this.fernsWaterUse)this.fernsDelta=this.fernsDelta>0?this.water:this.fernsDelta,this.fernsWaterUse=this.water;this.ferns+=this.fernsDelta,this.water-=this.fernsWaterUse}transferWater(){return this.transferred=this.water/1000,this.water-=this.transferred,this.transferred}}class K{water;farms;food;foodCreated;efficiency;transferred=0;constructor(){this.water=0,this.farms=0,this.food=0,this.foodCreated=0,this.efficiency=1}tick(t){this.water+=t,this.gainFood()}transferWater(){return this.transferred=this.water/1000,this.water-=this.transferred,this.transferred}gainFood(){if(this.foodCreated=this.farms/100*this.efficiency,this.foodCreated>this.water)this.foodCreated=this.water;this.water-=this.foodCreated,this.food+=this.foodCreated}addFarm(t){this.farms+=t,e?.events.emit("farms:updated")}improve(){this.efficiency+=0.02,e?.events.emit("farms:updated")}}class G{people;foodEaten;popGrowth;starving;scienceRatio;scienceDelta;cashDelta;happiness;houseBonus;happinessFromTrees=0;happinessFromOxygen=0;constructor(){this.people=0,this.foodEaten=0,this.popGrowth=0,this.starving=0,this.scienceRatio=0,this.scienceDelta=0,this.cashDelta=0,this.happiness=1,this.houseBonus=1}tick(){if(!e)return;if(this.foodEaten=this.people/100,this.foodEaten>e.farms.food)this.starving=this.foodEaten-e.farms.food,this.foodEaten=e.farms.food;else this.starving=0;e.farms.food-=this.foodEaten,this.popGrowth=(e.farms.food-this.people)/1000-this.starving/100,this.people+=this.popGrowth,this.updateHappiness(),this.tickRatio()}updateHappiness(){if(!e)return;this.happinessFromTrees=Math.log10(e.trees.trees+1)/10,this.happinessFromOxygen=Math.log10(e.oxygen+1)/20,this.happiness=this.houseBonus*(1+this.happinessFromTrees+this.happinessFromOxygen)}tickRatio(){if(!e)return;this.scienceDelta=this.people/100*(100-this.scienceRatio)/100*this.happiness,this.cashDelta=this.people/100*this.scienceRatio/100*this.happiness,e.science+=this.scienceDelta,e.cash+=this.cashDelta}improveHouse(){this.houseBonus+=0.1}}class x{text;tooltip;currentTicks=0;ticksNeeded;threads;cost;costType;completions=0;isMoving=!1;finish;showing;done;constructor(t){this.text=t.text||"",this.tooltip=t.tooltip||"",this.currentTicks=t.currentTicks||0,this.ticksNeeded=t.ticksNeeded||0,this.threads=t.threads||0,this.cost=t.cost||0,this.costType=t.costType||"",this.finish=t.finish||(()=>{}),this.showing=t.showing||(()=>!0),this.done=t.done}}class ${unlocked;threads;freeThreads;speed;processes;constructor(){this.unlocked=0,this.threads=1,this.freeThreads=1,this.speed=1,this.processes=[new x({text:"Optimize Land",tooltip:"Improve 1% of unimproved land.<br>Max to improve to is ( 10 x base land )<br>Percent Optimized: <div id='landOptimized'></div>",ticksNeeded:600,finish:function(){if(e)e.land.improveLand();if(e)this.ticksNeeded=Math.floor(e.land.baseLand);e?.events.emit("computer:updated")}}),new x({text:"Buy Ice",tooltip:"Buy available ice",ticksNeeded:50,finish:function(){if(e)e.buyIce()}}),new x({text:"Sell Water",tooltip:"Sells up to 50 water",ticksNeeded:50,finish:function(){if(e)e.water.sellWater(50)}}),new x({text:"Improve Farms",tooltip:"Farm efficiency increases by 2%",ticksNeeded:40,finish:function(){if(e)e.farms.improve();this.ticksNeeded=I(20*(this.completions+2)+Math.pow(this.completions,2)/10)}}),new x({text:"Find more Ice Sellers",tooltip:"Gain 200 buyable ice and 1 more per tick",ticksNeeded:2000,cost:0.5,costType:"cash",finish:function(){if(e)e.ice.findIceSeller(1)}}),new x({text:"Bigger Storms",tooltip:"Storms last 5 more ticks. Max 300 duration.",ticksNeeded:600,cost:2,costType:"science",finish:function(){if(e)e.clouds.gainStormDuration(5);this.cost+=0.5,this.ticksNeeded+=50},done:function(){return e?e.clouds.initialStormDuration>=300:!1},showing:function(){return!this.done?.()}}),new x({text:"Build Robots",tooltip:"Builds a robot",ticksNeeded:1e4,cost:0.01,costType:"metal",finish:function(){if(e)e.robots.gainRobots(1)},showing:function(){return e?e.robots.unlocked!==0:!1},done:function(){return e?e.robots.robots>=e.robots.robotMax:!1}}),new x({text:"More Robot Storage",tooltip:"Can hold 5 more robots",ticksNeeded:20000,cost:0.5,costType:"wood",finish:function(){if(e)e.robots.gainStorage(5);this.ticksNeeded+=2000},showing:function(){return e?e.robots.unlocked!==0:!1}}),new x({text:"Improve House Design",tooltip:"Improves base happiness modifier by .1",ticksNeeded:3000,cost:10,costType:"science",finish:function(){if(e)e.population.improveHouse();this.ticksNeeded+=500},showing:function(){return e?e.robots.unlocked!==0:!1}})]}tick(){for(let t=0;t<this.processes.length;t++){let r=this.processes[t];this.tickRow(r,this.speed*r.threads)}}tickRow(t,r){if(r===0){t.isMoving=!1;return}if(t.done&&t.done()){if(t.isMoving=!1,t.threads>0)this.freeThreads+=t.threads,t.threads=0;return}t.isMoving=!0;let s=r*t.cost;if(t.costType){if(e&&e[t.costType]<s){t.isMoving=!1;return}if(e)e[t.costType]-=s}t.currentTicks+=r;while(t.currentTicks>=t.ticksNeeded){let i=t.currentTicks-t.ticksNeeded;t.currentTicks=0,t.completions++,t.finish(),t.currentTicks=i}}unlockComputer(){if(!e)return;if(e.science>=1000)e.science-=1000,this.unlocked=1,e.events.emit("computer:unlocked")}buyThread(){if(!e)return;let t=this.getThreadCost();if(e.cash>=t)e.cash-=t,this.threads++,this.freeThreads++,e.events.emit("computer:updated")}getThreadCost(){return yt(Math.pow(2,this.threads)*500)}buySpeed(){if(!e)return;let t=this.getSpeedCost();if(e.science>=t)e.science-=t,this.speed++,e.events.emit("computer:updated")}getSpeedCost(){return yt(Math.pow(2,this.speed)*500)}addThread(t,r){r=Math.min(r,this.freeThreads);let s=this.processes[t];if(s)s.threads+=r,this.freeThreads-=r,e?.events.emit("computer:updated")}removeThread(t,r){let s=this.processes[t];if(s)r=Math.min(r,s.threads),s.threads-=r,this.freeThreads+=r,e?.events.emit("computer:updated")}}class R{text;tooltip;workers;currentTicks=0;ticksNeeded=0;cost;costType;isMoving=!1;completions=0;finish;showing;done;during;constructor(t){this.text=t.text||"",this.tooltip=t.tooltip||"",this.workers=t.workers||0,this.ticksNeeded=t.ticksNeeded||0,this.cost=t.cost,this.costType=t.costType,this.finish=t.finish||(()=>{}),this.showing=t.showing||(()=>!0),this.done=t.done,this.during=t.during}}class Y{robots;robotsFree;robotMax;unlocked;ore;mines;jobs;constructor(){this.robots=0,this.robotsFree=0,this.robotMax=5,this.unlocked=0,this.ore=0,this.mines=0,this.jobs=[new R({text:"Cut Trees",tooltip:"Cut down 2 trees for 1 wood",finish:function(){if(e)e.robots.cutTrees(this.workers)}}),new R({text:"Expand indoor water storage",tooltip:"Gives 50 more max indoor water.<br>Cost increases by 1",ticksNeeded:3000,cost:[0.1],costType:["metal"],finish:function(){if(this.ticksNeeded+=1000,e)e.water.maxIndoor+=50}}),new R({text:"Build Mines",tooltip:"Build up to (total land / 1000) mines",ticksNeeded:300,cost:[1],costType:["wood"],finish:function(){if(e)e.robots.mines++;this.ticksNeeded+=100},done:function(){return e?e.robots.mines*1000>=e.land.optimizedLand:!1}}),new R({text:"Mine Ore",tooltip:"Get (mines / 100) ore per tick",finish:function(){if(e)e.robots.mineOre(this.workers)}}),new R({text:"Smelt Ore",tooltip:"Each tick costs 5 wood, 1 ore, and 1000 oxygen<br>Gain 1 metal",finish:function(){if(e)e.robots.smeltOre(this.workers)}}),new R({text:"Turn ore into dirt",tooltip:"Each tick costs 1 energy and 1000 ore<br>Gain 5 Base Land<br>Total land gained: <span id='totalDirtFromOre'></span>",ticksNeeded:1000,during:function(){if(e&&e.power>=1*this.workers&&e.robots.ore>=this.workers*1000)return e.power-=1*this.workers,e.robots.ore-=this.workers*1000,!0;return!1},finish:function(){if(e)e.land.addLand(50)},showing:function(){return e?e.energy.unlocked!==0:!1}})]}tick(){for(let t=0;t<this.jobs.length;t++)this.tickRow(this.jobs[t],this.jobs[t].workers)}tickRow(t,r){if(r===0||t.done&&t.done()){t.isMoving=!1;return}if(t.ticksNeeded===0){t.finish();return}if(t.during&&!t.during()){t.isMoving=!1;return}if(t.cost&&t.costType){for(let s=0;s<t.cost.length;s++){let i=r*t.cost[s],u=t.costType[s];if(u){if(e&&e[u]<i){t.isMoving=!1;return}}}for(let s=0;s<t.cost.length;s++){let i=t.costType[s];if(e)e[i]-=r*t.cost[s]}}if(t.currentTicks+=r,t.isMoving=!0,t.currentTicks>=t.ticksNeeded){let s=t.currentTicks-t.ticksNeeded;t.currentTicks=0,t.completions++,t.finish(),e?.events.emit("robots:updated"),this.tickRow(t,s)}}gainRobots(t){this.robots+=t,this.robotsFree+=t,e?.events.emit("robots:updated")}gainStorage(t){this.robotMax+=t,e?.events.emit("robots:updated")}unlockRobots(){if(!e)return;if(e.cash>=3000)e.cash-=3000,this.unlocked=1,e.events.emit("robots:unlocked"),this.gainRobots(1);e.events.emit("robots:updated")}addWorker(t,r){let s=this.jobs[t];if(s)r=Math.min(r,this.robotsFree),s.workers+=r,this.robotsFree-=r;e?.events.emit("robots:updated")}removeWorker(t,r){let s=this.jobs[t];if(s)r=Math.min(r,s.workers),s.workers-=r,this.robotsFree+=r;e?.events.emit("robots:updated")}cutTrees(t){if(e&&e.trees.trees>=2*t)e.trees.trees-=2*t,e.wood+=t}mineOre(t){if(e)e.robots.ore+=e.robots.mines/100*t}smeltOre(t){if(e&&e.wood>=5*t&&this.ore>=t&&e.oxygen>=t*1000)e.wood-=5*t,this.ore-=t,e.oxygen-=1000*t,e.metal+=t}}class q{unlocked;battery;drain=0;constructor(){this.unlocked=0,this.battery=100}unlockEnergy(){if(e&&e.metal>=500)e.metal-=500,this.unlocked=1,e.events.emit("energy:unlocked");e?.events.emit("energy:updated")}tick(){if(!e)return;let t=e.power-this.battery;if(this.drain=0,t>0)this.drain=t/500,e.power-=this.drain}gainEnergy(t){if(e)e.power+=t}buyBattery(t){this.battery+=t,e?.events.emit("energy:updated")}}class w{unlocked;orbiting;constructor(){this.unlocked=0,this.orbiting=[{type:"ice",amount:1e6},{type:"dirt",amount:500}]}unlockSpaceStation(){if(e&&e.metal>=2000&&e.wood>=20000)e.metal-=2000,e.wood-=20000,this.unlocked=1,e.events.emit("spaceStation:unlocked");e?.events.emit("spaceStation:updated")}tick(){if(!this.unlocked||!e)return;for(let t=0;t<this.orbiting.length;t++){let r=this.orbiting[t],s=r.amount/1e5;r.amount-=s;let i=r.type;if(i==="ice")e.ice.ice+=s;else if(i==="dirt")e.land.addLand(s)}}}class Q{unlocked;cometSpotChance;takeAmount;comets;constructor(){this.unlocked=0,this.cometSpotChance=0.006,this.takeAmount="",this.comets=[]}tick(){if(!this.unlocked||!e)return;if(this.checkForNewAsteroids(),this.comets.length){let t=e.power/1000;e.power-=this.pullIntoOrbit(t),this.removeAsteroidIfDone()}}unlockTractorBeam(){if(!e)return;if(e.science>=500000&&e.oxygen>=5000000)e.science-=500000,e.oxygen-=2000000,this.unlocked=1,e.events.emit("tractorBeam:unlocked"),e.spaceDock.unlocked=1,e.events.emit("spaceDock:unlocked");e.events.emit("tractorBeam:updated")}pullIntoOrbit(t){if(!e)return 0;let r=t/this.comets.length,s=0;this.takeAmount="";for(let i=0;i<e.spaceStation.orbiting.length;i++){let u=e.spaceStation.orbiting[i],d=0;for(let h=0;h<this.comets.length;h++){let b=this.comets[h];if(b.amountType===u.type){let y=Math.min(r,b.amount);s+=y,b.amount-=y,d+=y}}if(u.amount+=d,this.takeAmount+=n(d,3)+" "+u.type,i<e.spaceStation.orbiting.length-1)this.takeAmount+=", "}return s}checkForNewAsteroids(){if(Math.random()<this.cometSpotChance)this.addComet()}removeAsteroidIfDone(){let t=this.comets.length-1;for(let r=t;r>=0;r--){let s=this.comets[r];if(s.duration--,s.duration<0||s.amount<1){if(s.drawed)e?.events.emit("tractorBeam:removeComet",s);this.comets.splice(r,1)}}}addComet(){if(!e||this.comets.length>20)return;let t=Math.random(),r=Math.random()*100*e.space.sector+200,s=Math.floor(Math.random()*750+250),i=Math.random()*2+1,u={};if(t<0.9)u={name:"Comet",amountType:"ice",amount:r*1000,initialAmount:r*1000,duration:s,initialDuration:s,speed:i};else u={name:"Asteroid",amountType:"dirt",amount:r,initialAmount:r,duration:s*2,initialDuration:s*2,speed:i/2};u.id=Vt(),u.drawed=!1,this.comets.push(u)}}class Z{battleships;unlocked;sended;constructor(){this.battleships=0,this.unlocked=0,this.sended=0}addBattleship(t){this.battleships+=t,e?.events.emit("spaceDock:updated")}}class j{count;food;actionCounter;energy;x;y;engaged;direction;targetIndex;constructor(t,r,s){this.count=t,this.food=r/s,this.actionCounter=0,this.energy=0,this.x=0,this.y=0,this.engaged=!1,this.direction=0,this.targetIndex=-1}}class J{sendRate;timeRemaining;totalTime;y;constructor(){this.sendRate=1,this.timeRemaining=this.totalTime=40,this.y=(e?.canvasHeight||600)*0.5-25}tick(){if(!e)return;if(this.y=e.canvasHeight*0.5-25,this.timeRemaining--,this.timeRemaining<0)if(e.spaceDock.battleships>0){let t=Math.min(this.sendRate,e.spaceDock.battleships),r=e.farms.food*0.05;e.farms.food-=r;let s=new j(t,r,m.foodPerShip);s.targetIndex=m.globalTargetIndex,e.space.spawnShip(s,this.y),e.spaceDock.battleships-=t,e.spaceDock.sended+=t,e.events.emit("spaceDock:updated"),this.timeRemaining=this.totalTime}else this.timeRemaining=0}getTarget(){return{isHome:!0,x:-125,y:this.y}}}class O{aProgress;color;lastPercentage=-1;constructor(t,r){this.aProgress=document.getElementById(t),this.color=r}tick(t,r){if(!this.aProgress||r<=0)return;let s=t/r;if(Math.abs(this.lastPercentage-s)<0.001)return;this.lastPercentage=s,this.reset(this.aProgress),this.drawProgress(this.aProgress,s,this.color)}reset(t){if(!t)return;let r=t.getContext("2d");if(!r)return;r.lineCap="square";let s=t.width/2,i=t.width/2-5;r.beginPath(),r.lineWidth=8,r.fillStyle="#1e1e1e",r.arc(s,s,i,0,2*Math.PI),r.fill()}drawProgress(t,r,s){if(!t)return;let i=t.getContext("2d");if(!i)return;let u=Math.PI/2,d=2*r*0.95*Math.PI-u*0.9,h=0-u*0.9,b=t.width/2,y=t.width/2-10;i.lineCap="square",i.beginPath(),i.lineWidth=8,i.strokeStyle=s,i.arc(b,b,y,h,d),i.stroke()}}class c{textCache=new Map;elementCache=new Map;clearCache(){this.textCache.clear(),this.elementCache.clear()}getElement(t){let r=this.elementCache.get(t);if(!r){let s=document.getElementById(t);if(!s)throw Error(`Element ${t} not found`);r=s,this.elementCache.set(t,r)}return r}updateElementText(t,r){if(this.textCache.get(t)===r)return;this.getElement(t).textContent=r,this.textCache.set(t,r)}setVisible(t,r){let s=this.getElement(t);if(r)s.classList.remove("hidden");else s.classList.add("hidden")}}class D extends c{hoveredIndex=null;constructor(){super();if(e)e.events.on("computer:unlocked",()=>this.checkUnlocked()),e.events.on("computer:updated",()=>this.update())}checkUnlocked(){if(!e)return;if(e.computer.unlocked)this.setVisible("unlockedComputer",!0),this.setVisible("unlockComputer",!1),this.setVisible("robotsContainer",!0),this.update();else this.setVisible("unlockedComputer",!1),this.setVisible("unlockComputer",!0),this.setVisible("robotsContainer",!1)}update(){if(!e)return;this.updateElementText("freeThreads",String(e.computer.freeThreads)),this.updateElementText("threads",String(e.computer.threads)),this.updateElementText("speed",String(e.computer.speed)),this.updateElementText("threadCost",n(e.computer.getThreadCost())),this.updateElementText("speedCost",n(e.computer.getSpeedCost())),this.updateElementText("landOptimized",Ht(e.land.optimizedLand/(e.land.baseLand*10)*100)+"%");for(let t=0;t<e.computer.processes.length;t++){let r=e.computer.processes[t];if(!r)continue;this.updateElementText("computerRow"+t+"Threads",String(r.threads)),this.setVisible("computerRow"+t+"Container",r.showing())}}updateRowProgress(t){if(!e||!e.computer.unlocked)return;let r=e.computer.processes[t];if(!r||!r.showing())return;let s="computerRow"+t,i=this.getElement(s+"PB");if(i.style.width=r.currentTicks/r.ticksNeeded*100+"%",i.style.backgroundColor=r.isMoving?"yellow":"red",this.hoveredIndex===t){this.updateElementText(s+"CurrentTicks",n(r.currentTicks)),this.updateElementText(s+"TicksNeeded",n(r.ticksNeeded));let u=this.getElement(s+"CostContainer");if(r.cost!==0)u.classList.remove("hidden"),this.updateElementText(s+"Cost",n(r.cost)),this.updateElementText(s+"CostType",r.costType);else u.classList.add("hidden")}}addComputerRow(t){let r=this.getElement("computerRows"),s=document.createElement("div");s.className="computerRow";let i="computerRow"+t;s.id=i+"Container",s.addEventListener("mouseenter",()=>{this.hoveredIndex=t,this.updateRowProgress(t)}),s.addEventListener("mouseleave",()=>this.hoveredIndex=null);let u=document.createElement("div");u.id=i+"Plus",u.className="button",u.innerHTML="+",u.addEventListener("click",(k)=>e?.computer.addThread(t,W(k)));let d=document.createElement("div");d.id=i+"Minus",d.className="button",d.innerHTML="-",d.addEventListener("click",(k)=>e?.computer.removeThread(t,W(k)));let h=document.createElement("div");h.id=i+"Threads",h.className="small",h.style.marginRight="4px";let b=e?.computer.processes[t]?.text||"",y=document.createElement("div");y.innerHTML=b;let p=document.createElement("div");p.className="rowProgressBarOuter",p.innerHTML="<div class='rowProgressBarInner' id='"+i+"PB'></div>";let l=document.createElement("div");l.className="computerTooltipContainer",l.id=i+"Tooltip";let E=document.createElement("div");E.className="rowTooltip";let F=e?.computer.processes[t]?.tooltip||"";E.innerHTML=`
            <div class="tooltipDescription">${F}</div>
            <div class="tooltipDivider"></div>
            <div class="tooltipStats">
                <div><b>Progress:</b> <span id="${i}CurrentTicks"></span> / <span id="${i}TicksNeeded"></span> ticks</div>
                <div id="${i}CostContainer" class="hidden"><b>Cost:</b> <span id="${i}Cost"></span> <span id="${i}CostType"></span> per tick</div>
            </div>
        `,l.appendChild(E),s.appendChild(u),s.appendChild(h),s.appendChild(d);let L=document.createElement("div");L.className="rowLabel",L.appendChild(y),s.appendChild(L),s.appendChild(p),s.appendChild(l),r.appendChild(s)}}class z extends c{hoveredIndex=null;constructor(){super();if(e)e.events.on("robots:unlocked",()=>{this.checkUnlocked(),this.updateFull()}),e.events.on("robots:updated",()=>this.updateFull())}checkUnlocked(){if(!e)return;if(e.robots.unlocked)this.setVisible("unlockedRobots",!0),this.setVisible("unlockRobots",!1),this.setVisible("lightningContainer",!0),this.setVisible("lightningTooltip",!0),this.setVisible("energyContainer",!0),this.setVisible("woodContainer",!0),this.setVisible("metalContainer",!0),this.updateFull();else this.setVisible("unlockedRobots",!1),this.setVisible("unlockRobots",!0),this.setVisible("lightningContainer",!1),this.setVisible("lightningTooltip",!1),this.setVisible("energyContainer",!1),this.setVisible("woodContainer",!1),this.setVisible("metalContainer",!1)}update(){if(!e)return;this.updateElementText("ore",n(e.robots.ore))}updateFull(){if(!e)return;if(this.updateElementText("robots",String(e.robots.robots)),this.updateElementText("robotsFree",String(e.robots.robotsFree)),this.updateElementText("robotMax",String(e.robots.robotMax)),e.robots.jobs[5])this.updateElementText("totalDirtFromOre",n(e.robots.jobs[5].completions*5));for(let t=0;t<e.robots.jobs.length;t++){let r=e.robots.jobs[t];if(!r)continue;this.updateElementText("robotRow"+t+"Workers",String(r.workers)),this.setVisible("robotRow"+t+"Container",r.showing())}this.update()}updateRowProgress(t){if(!e)return;let r=e.robots.jobs[t];if(!r||!r.showing()||r.ticksNeeded===0)return;let s="robotRow"+t,i=this.getElement(s+"PB");if(i.style.width=r.currentTicks/r.ticksNeeded*100+"%",i.style.backgroundColor=r.isMoving?"yellow":"red",this.hoveredIndex===t){this.updateElementText(s+"CurrentTicks",n(r.currentTicks)),this.updateElementText(s+"TicksNeeded",n(r.ticksNeeded));let u=this.getElement(s+"CostContainer");if(r.cost&&r.costType){u.classList.remove("hidden");let d=n(r.cost[0]||0)+" "+(r.costType[0]||"");d+=r.cost.length>1?" and "+n(r.cost[1]||0)+" "+(r.costType[1]||""):"",this.updateElementText(s+"Cost",d)}else u.classList.add("hidden")}}addRobotRow(t){let r=this.getElement("robotRows"),s=document.createElement("div");s.className="robotRow";let i="robotRow"+t;s.id=i+"Container",s.addEventListener("mouseenter",()=>{this.hoveredIndex=t,this.updateRowProgress(t)}),s.addEventListener("mouseleave",()=>this.hoveredIndex=null);let u=document.createElement("div");u.id=i+"Plus",u.className="button",u.innerHTML="+",u.addEventListener("click",(S)=>e?.robots.addWorker(t,W(S)));let d=document.createElement("div");d.id=i+"Minus",d.className="button",d.innerHTML="-",d.addEventListener("click",(S)=>e?.robots.removeWorker(t,W(S)));let h=document.createElement("div");h.id=i+"Workers",h.className="small",h.style.marginRight="4px";let b=e?.robots.jobs[t]?.text||"",y=document.createElement("div");y.innerHTML=b;let p=document.createElement("div");if(e?.robots.jobs[t]?.ticksNeeded)p.className="rowProgressBarOuter",p.innerHTML="<div class='rowProgressBarInner' id='"+i+"PB'></div>";let l=document.createElement("div");l.className="computerTooltipContainer",l.id=i+"Tooltip";let E=document.createElement("div");E.className="rowTooltip";let F=e?.robots.jobs[t]?.tooltip||"",L="";if(e?.robots.jobs[t]?.ticksNeeded)L=`
                <div class="tooltipDivider"></div>
                <div class="tooltipStats">
                    <div><b>Progress:</b> <span id="${i}CurrentTicks"></span> / <span id="${i}TicksNeeded"></span> ticks</div>
                    <div id="${i}CostContainer" class="hidden"><b>Cost:</b> <span id="${i}Cost"></span> per tick</div>
                </div>
            `;E.innerHTML=`
            <div class="tooltipDescription">${F}</div>
            ${L}
        `,l.appendChild(E),s.appendChild(u),s.appendChild(h),s.appendChild(d);let k=document.createElement("div");if(k.className="rowLabel",k.appendChild(y),s.appendChild(k),p.innerHTML)s.appendChild(p);s.appendChild(l),r.appendChild(s)}}class P extends c{update(){if(!e)return;this.updateElementText("totalWater",n(e.ice.ice+e.water.indoor+e.water.outdoor+e.clouds.water+e.land.water+e.trees.water+e.farms.water)),this.updateElementText("cash",n(e.cash)),this.updateElementText("oxygen",n(e.oxygen)),this.updateElementText("science",n(e.science)),this.updateElementText("wood",n(e.wood)),this.updateElementText("metal",n(e.metal)),this.updateElementText("oxygenLeak",n(e.oxygenLeak,4))}}class g extends c{update(){if(!e)return;this.updateElementText("ice",n(e.ice.ice)),this.updateElementText("buyableIce",n(e.ice.buyable)),this.updateElementText("iceTransferred",n(e.ice.transferred,4)),this.updateElementText("indoorWaterReceived",n(e.ice.transferred,4)),this.updateElementText("iceBuyerAmount",String(e.ice.gain))}}class tt extends c{update(){if(!e)return;this.updateElementText("indoorWater",n(e.water.indoor)),this.updateElementText("indoorWaterMax",n(e.water.maxIndoor)),this.updateElementText("indoorWaterSelling",n(e.water.selling)),this.updateElementText("indoorWaterProfits",n(e.water.gain)),this.updateElementText("excessWater",n(e.water.excess,4)),this.updateElementText("lakeWaterFromStorage",n(e.water.excess,4)),this.updateElementText("outdoorWater",n(e.water.outdoor)),this.updateElementText("waterTransferred",n(e.water.transferred,4)),this.updateElementText("cloudsReceived",n(e.water.transferred,4))}}class et extends c{update(){if(!e)return;this.updateElementText("clouds",n(e.clouds.water)),this.updateElementText("stormTimer",String(e.clouds.stormTimer)),this.updateElementText("stormRate",e.clouds.stormRate+"%"),this.getElement("intensityPB").style.height=e.clouds.stormRate+"%",this.updateElementText("stormDuration",String(e.clouds.stormDuration)),this.updateElementText("rain",n(e.clouds.transferred,4)),this.updateElementText("landReceived",n(e.clouds.transferred,4)),this.updateElementText("lightningChance",n(e.clouds.lightningChance)+"%"),this.getElement("lightningPB").style.height=e.clouds.lightningChance+"%",this.updateElementText("lightningStrength",n(e.clouds.lightningStrength))}}class rt extends c{update(){if(!e)return;this.updateElementText("landWater",n(e.land.water)),this.updateElementText("optimizedLand",n(e.land.optimizedLand)),this.updateElementText("baseLand",n(e.land.baseLand)),this.updateElementText("land",n(e.land.land)),this.updateElementText("soil",n(e.land.soil)),this.updateElementText("landConverted",n(e.land.convertedLand,4)),this.updateElementText("landWaterToForest",n(e.land.transferred,4)),this.updateElementText("forestReceived",n(e.land.transferred,4)),this.updateElementText("landWaterToFarm",n(e.land.transferred,4)),this.updateElementText("farmReceived",n(e.land.transferred,4))}}class st extends c{update(){if(!e)return;this.updateElementText("population",n(e.population.people)),this.updateElementText("foodEaten",n(e.population.foodEaten,4)),this.updateElementText("populationGrowth",_t(e.population.popGrowth,4)),this.updateElementText("starving",n(e.population.starving,4)),this.updateElementText("scienceDelta",n(e.population.scienceDelta,4)),this.updateElementText("cashDelta",n(e.population.cashDelta,4)),this.updateElementText("scienceRatio",e.population.scienceRatio<50?100-e.population.scienceRatio+"% science":e.population.scienceRatio+"% cash"),this.updateElementText("happiness",n(e.population.happiness,4)),this.updateElementText("happinessFromHouse",n(e.population.houseBonus)),this.updateElementText("happinessFromTrees",n(e.population.happinessFromTrees,4)),this.updateElementText("happinessFromOxygen",n(e.population.happinessFromOxygen,4))}}class it extends c{update(){if(!e)return;this.updateElementText("forestWater",n(e.trees.water)),this.updateElementText("ferns",n(e.trees.ferns)),this.updateElementText("fernsDelta",n(e.trees.fernsDelta,4)),this.updateElementText("smallTrees",n(e.trees.smallTrees)),this.updateElementText("smallTreesDelta",n(e.trees.smallTreesDelta,4)),this.updateElementText("trees",n(e.trees.trees)),this.updateElementText("treesDelta",n(e.trees.treesDelta,4)),this.updateElementText("totalPlants",n(e.trees.totalPlants)),this.updateElementText("oxygenGain",n(e.trees.oxygenGain,4)),this.updateElementText("forestWaterToLake",n(e.trees.transferred,4)),this.updateElementText("lakeWaterFromForest",n(e.trees.transferred,4)),this.updateElementText("fernWater",n(e.trees.fernsWaterUse,4)),this.updateElementText("smallTreesWater",n(e.trees.smallTreesWaterUse,4)),this.updateElementText("treesWater",n(e.trees.treesWaterUse,4))}}class nt extends c{constructor(){super();if(e){e.events.on("farms:updated",()=>this.updateFull());let t=document.getElementById("buyFarmAmount");if(t)t.addEventListener("input",()=>this.updateFull())}}update(){if(!e)return;this.updateElementText("farmsWater",n(e.farms.water)),this.updateElementText("food",n(e.farms.food)),this.updateElementText("foodCreated",n(e.farms.foodCreated,4)),this.updateElementText("farmFoodEaten",n(e.population.foodEaten,4)),this.updateElementText("farmWaterToLake",n(e.farms.transferred,4)),this.updateElementText("lakeWaterFromFarm",n(e.farms.transferred,4))}updateFull(){if(!e)return;this.updateElementText("farms",n(e.farms.farms)),this.updateElementText("efficiency",n(e.farms.efficiency*100));let t=document.getElementById("buyFarmAmount"),r=t?Number(t.value):1;this.updateElementText("farmCost",n(r*50)),this.update()}}class ot extends c{constructor(){super();if(e){e.events.on("energy:unlocked",()=>{this.checkUnlocked(),this.updateFull()}),e.events.on("energy:updated",()=>this.updateFull());let t=document.getElementById("buyBattery");if(t)t.addEventListener("input",()=>this.updateFull())}}checkUnlocked(){if(!e)return;if(e.energy.unlocked){if(this.setVisible("unlockedEnergy",!0),this.setVisible("unlockEnergy",!1),this.getElement("spaceStationContainer").classList.contains("hidden"))this.getElement("spaceStationContainer").classList.remove("hidden");this.updateFull()}else if(this.setVisible("unlockedEnergy",!1),this.setVisible("unlockEnergy",!0),!this.getElement("spaceStationContainer").classList.contains("hidden"))this.getElement("spaceStationContainer").classList.add("hidden")}update(){if(!e)return;this.updateElementText("energy",n(e.power)),this.updateElementText("drain",n(e.energy.drain))}updateFull(){if(!e)return;this.updateElementText("battery",n(e.energy.battery));let t=document.getElementById("buyBattery"),r=t?Number(t.value):1;this.updateElementText("batteryCost",n(r*30000)+" oxygen and "+n(r*20000)+" science"),this.update()}}class ut extends c{constructor(){super();if(e)e.events.on("spaceStation:unlocked",()=>this.checkUnlocked()),e.events.on("spaceStation:updated",()=>this.update())}checkUnlocked(){if(!e)return;if(e.spaceStation.unlocked)this.setVisible("spaceStationContainer",!0),this.setVisible("unlockedSpaceStation",!0),this.setVisible("unlockSpaceStation",!1),this.setVisible("tractorBeamContainer",!0);else this.setVisible("spaceStationContainer",!1),this.setVisible("unlockedSpaceStation",!1),this.setVisible("unlockSpaceStation",!0),this.setVisible("tractorBeamContainer",!1)}update(){if(!e)return;let t="",r="";for(let s=0;s<e.spaceStation.orbiting.length;s++){let i=e.spaceStation.orbiting[s];if(!i)continue;if(t+=n(i.amount)+" "+i.type,r+=n(i.amount/1e4,4)+" "+i.type,s!==e.spaceStation.orbiting.length-1)t+=", ",r+=", "}this.updateElementText("orbitingResources",t),this.updateElementText("orbitSending",r)}}class dt extends c{cometRows=new Map;constructor(){super();if(e)e.events.on("tractorBeam:unlocked",()=>this.checkUnlocked()),e.events.on("tractorBeam:updated",()=>this.update()),e.events.on("tractorBeam:removeComet",(t)=>{if(a)a.removeComet(t)})}checkUnlocked(){if(!e)return;if(e.tractorBeam.unlocked)this.setVisible("unlockedTractorBeam",!0),this.setVisible("unlockTractorBeam",!1);else this.setVisible("unlockedTractorBeam",!1),this.setVisible("unlockTractorBeam",!0)}update(){if(!e||!a)return;let t=this.getElement("allPassing"),r=e.tractorBeam.comets,s=new Set(r.map((i)=>i.id));for(let[i,u]of this.cometRows.entries())if(!s.has(i))u.remove(),this.cometRows.delete(i);for(let i=0;i<r.length;i++){let u=r[i];if(!u)continue;if(!this.cometRows.has(u.id)){let d=document.createElement("div");d.className="comet-row",d.innerHTML=`<span>${u.name}</span> with <span id="comet-amount-${u.id}"></span> ${u.amountType} passing in <span id="comet-duration-${u.id}"></span>`,t.appendChild(d),this.cometRows.set(u.id,d)}this.updateElementText(`comet-amount-${u.id}`,n(u.amount)),this.updateElementText(`comet-duration-${u.id}`,String(u.duration)),a.drawComet(u)}this.updateElementText("takeAmount",String(e.tractorBeam.takeAmount))}}class ft extends c{constructor(){super();if(e){e.events.on("spaceDock:unlocked",()=>{this.checkUnlocked(),this.update()}),e.events.on("spaceDock:updated",()=>this.update());let t=document.getElementById("buyBattleshipAmount");if(t)t.addEventListener("input",()=>this.update())}}checkUnlocked(){if(!e)return;if(e.spaceDock.unlocked)this.setVisible("spaceDockContainer",!0),this.setVisible("hangarContainer",!0),this.setVisible("spaceCanvas",!0),this.setVisible("spaceContainer",!0),this.update();else this.setVisible("spaceDockContainer",!1),this.setVisible("hangarContainer",!1),this.setVisible("spaceCanvas",!1),this.setVisible("spaceContainer",!1)}update(){if(!e)return;this.updateElementText("battleships",String(e.spaceDock.battleships)),this.updateElementText("totalBattleships",String(e.spaceDock.battleships+e.spaceDock.sended));let t=document.getElementById("buyBattleshipAmount"),r=t?Number(t.value):1;this.updateElementText("battleshipCost",n(r*30000000)+" oxygen and "+n(r*15000000)+" science")}}class ht extends c{constructor(){super();if(e){e.events.on("hangar:updated",()=>this.updateFull());let t=document.getElementById("buyHangarAmount");if(t)t.addEventListener("input",()=>this.updateFull())}}update(){if(!e)return;this.updateElementText("hangarSending",e.hangar.sendRate+" in "+Bt(e.hangar.timeRemaining/10)+" seconds.")}updateFull(){if(!e)return;let t=document.getElementById("buyHangarAmount"),r=t?Number(t.value):1;this.updateElementText("hangarCost",n(r*1e6)),this.update()}}class lt extends c{progressBar1;progressBar2;computerView;robotsView;resourceView;iceView;waterView;cloudsView;landView;populationView;treesView;farmsView;energyView;spaceStationView;tractorBeamView;spaceDockView;hangarView;cometPool=[];allContainers=[];columns=[];lastVisibleCount=-1;lastWidth=-1;resizeHandler;constructor(){super();this.progressBar1=new O("nextStormProgress","#21276a"),this.progressBar2=new O("stormDurationProgress","#1c7682"),this.computerView=new D,this.robotsView=new z,this.resourceView=new P,this.iceView=new g,this.waterView=new tt,this.cloudsView=new et,this.landView=new rt,this.populationView=new st,this.treesView=new it,this.farmsView=new nt,this.energyView=new ot,this.spaceStationView=new ut,this.tractorBeamView=new dt,this.spaceDockView=new ft,this.hangarView=new ht;let t=this.getElement("mainContainer");if(t.querySelectorAll(".container").forEach((r)=>t.appendChild(r)),t.querySelectorAll(".column").forEach((r)=>r.remove()),this.allContainers=Array.from(t.querySelectorAll(".container")),this.resizeHandler=()=>this.refreshLayout(),window.addEventListener("resize",this.resizeHandler),e)e.events.on("tick",()=>{if(!document.hidden)this.update()}),e.events.on("computer:unlocked",()=>this.refreshLayout()),e.events.on("robots:unlocked",()=>this.refreshLayout()),e.events.on("energy:unlocked",()=>this.refreshLayout()),e.events.on("spaceStation:unlocked",()=>this.refreshLayout()),e.events.on("tractorBeam:unlocked",()=>this.refreshLayout()),e.events.on("spaceDock:unlocked",()=>this.refreshLayout())}destroy(){window.removeEventListener("resize",this.resizeHandler)}update(){if(!e)return;this.resourceView.update(),this.iceView.update(),this.waterView.update(),this.cloudsView.update(),this.landView.update(),this.treesView.update(),this.farmsView.update(),this.populationView.update(),this.updateComputerRowProgress(),this.robotsView.update(),this.updateRobotsRowProgress(),this.energyView.update(),this.spaceStationView.update(),this.tractorBeamView.update(),this.hangarView.update(),this.progressBar1.tick(e.clouds.initialStormTimer-e.clouds.stormTimer,e.clouds.initialStormTimer),this.progressBar2.tick(e.clouds.stormDuration,e.clouds.initialStormDuration),kt()}refreshLayout(){let t=this.getElement("mainContainer");if(t.offsetWidth===0)return;let r=window.getComputedStyle(t),s=parseFloat(r.columnGap||r.gap||"0"),i=280,u=t.querySelector(".column");if(u)i=parseFloat(window.getComputedStyle(u).minWidth);else{let l=document.createElement("div");l.className="column",l.style.visibility="hidden",l.style.position="absolute",t.appendChild(l),i=parseFloat(window.getComputedStyle(l).minWidth),t.removeChild(l)}i=Math.max(200,i||0);let d=i+s,h=t.offsetWidth,b=Math.max(1,Math.floor((h+s)/d)),y=this.allContainers.filter((l)=>!l.classList.contains("hidden")),p=y.length;if(this.columns.length===b&&p===this.lastVisibleCount&&h===this.lastWidth)return;for(let l of this.allContainers)t.appendChild(l);if(this.columns.length!==b){this.columns.forEach((l)=>l.remove()),this.columns=[];for(let l=0;l<b;l++){let E=document.createElement("div");E.className="column",t.appendChild(E),this.columns.push(E)}}if(this.lastVisibleCount=p,this.lastWidth=h,this.columns.length===0)return;for(let l=0;l<y.length;l++){let E=y[l],F=this.columns[0];if(l<this.columns.length)F=this.columns[l];else{let L=F.offsetHeight;for(let k=1;k<this.columns.length;k++){let S=this.columns[k];if(S.offsetHeight<L)F=S,L=S.offsetHeight}}F.appendChild(E)}}clearComputerRows(){this.getElement("computerRows").innerHTML="",this.computerView.clearCache()}clearRobotRows(){this.getElement("robotRows").innerHTML="",this.robotsView.clearCache()}updateComputerRowProgress(){if(!e||!e.computer.unlocked)return;for(let t=0;t<e.computer.processes.length;t++)this.computerView.updateRowProgress(t)}updateRobotsRowProgress(){if(!e)return;for(let t=0;t<e.robots.jobs.length;t++)this.robotsView.updateRowProgress(t)}drawComet(t){let r,s="comet"+t.id;if(!t.drawed){r=this.cometPool.pop()||document.createElement("div"),r.className=t.name.toLowerCase(),r.id=s,r.classList.remove("hidden");let i=t.speed*t.duration;t.startingY=Math.random()*(i*0.4)+i*0.1,t.left=0,t.top=t.endingX=Math.pow(Math.pow(i,2)-Math.pow(t.startingY,2),0.5),t.slope=(0-t.startingY)/t.endingX,this.getElement("cometsContainer").appendChild(r),t.drawed=!0}else r=document.getElementById(s);if(r){t.left=(t.initialDuration-t.duration)/t.initialDuration*t.endingX,t.top=t.slope*t.left+t.startingY;let i=t.amountType==="ice"?t.amount/1000:t.amount,d=(t.name==="Comet"?40:20)*Math.sqrt(i/200);r.style.width=Math.round(d)+"px",r.style.height=Math.round(d)+"px",r.style.borderRadius=Math.round(d/2)+"px",r.style.left=Math.round(t.left-d/2)+"px",r.style.top=Math.round(t.top-d/2)+"px"}}removeComet(t){let r="comet"+t.id,s=document.getElementById(r);if(s)s.classList.add("hidden"),s.id="",this.cometPool.push(s);else console.log(r+"not found")}}var At=()=>{let t=(i,u)=>{let d=document.getElementById(i);if(d)d.addEventListener("click",u)};t("btnHardReset",Mt),t("btnPause",Lt),t("btnBeg",Gt),t("btnSave",mt),t("btnExport",Xt),t("btnImport",Kt),t("btnBuyIce",()=>e?.buyIce()),t("btnBuyFarms",()=>e?.buyFarms()),t("unlockComputer",()=>e?.computer.unlockComputer()),t("buyThread",()=>e?.computer.buyThread()),t("buySpeed",()=>e?.computer.buySpeed()),t("unlockRobots",()=>e?.robots.unlockRobots()),t("unlockEnergy",()=>e?.energy.unlockEnergy()),t("btnBuyBattery",()=>e?.buyBattery()),t("unlockSpaceStation",()=>e?.spaceStation.unlockSpaceStation()),t("unlockTractorBeam",()=>e?.tractorBeam.unlockTractorBeam()),t("btnBuyBattleship",()=>e?.buyBattleship()),t("btnBuyHangar",()=>e?.buyHangar()),document.getElementById("mainContainer")?.addEventListener("contextmenu",(i)=>i.preventDefault()),document.getElementById("scienceSlider")?.addEventListener("input",function(){if(e)e.population.scienceRatio=Number(this.value)}),document.querySelectorAll(".numeric-input-small").forEach((i)=>{i.addEventListener("change",function(){let u=Number(this.value);if(isNaN(u)||u<1)u=1;this.value=Math.floor(u).toString(),this.dispatchEvent(new Event("input"))})})};if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",At);else At();var ct=[];function te(){if(ct.length===0)return;let t=ct[0]?.key;if(ct.splice(0,1),t===66)e?.buyIce()}document.addEventListener("keydown",function(t){let r={key:t.charCode!==0?t.charCode:t.keyCode,shift:t.shiftKey};ct.push(r),te()});class at{events=new Map;on(t,r){if(!this.events.has(t))this.events.set(t,[]);this.events.get(t)?.push(r)}off(t,r){let s=this.events.get(t);if(s)this.events.set(t,s.filter((i)=>i!==r))}emit(t,...r){let s=this.events.get(t);if(s)s.forEach((i)=>i(...r))}}var e=null,a=null,Yt=0,Ft=!1,$t=0;function ee(){Yt++}function re(){Ft=!Ft}function Vt(){return $t++,$t}class qt{totalLand;cash;oxygen;science;wood;metal;power;oxygenLeak=0;canvasWidth=1200;canvasHeight=600;space;ice;water;clouds;land;trees;farms;population;computer;robots;energy;spaceStation;tractorBeam;spaceDock;hangar;events;constructor(){this.totalLand=1000,this.cash=100,this.oxygen=0,this.science=0,this.wood=0,this.metal=0,this.power=0,this.canvasWidth=1200,this.canvasHeight=600,this.events=new at}tick(){this.ice.tick(),this.robots.tick(),this.computer.tick(),this.farms.tick(this.land.transferWater()),this.population.tick(),this.water.outdoor+=this.farms.transferWater(),this.trees.tick(this.land.transferWater()),this.water.outdoor+=this.trees.transferWater(),this.land.tick(this.clouds.transferWater()),this.clouds.tick(this.water.transferWater()),this.energy.tick(),this.water.tick(this.ice.transferWater()),this.tractorBeam.tick(),this.spaceStation.tick(),this.space.tick(),this.oxygenLeak=this.oxygen/1e5,this.oxygen-=this.oxygenLeak,this.hangar.tick(),this.events.emit("tick")}initialize(){this.space=new U,this.ice=new N,this.water=new V,this.clouds=new A,this.land=new M(this.totalLand),this.trees=new X,this.farms=new K,this.population=new G,this.computer=new $,this.robots=new Y,this.energy=new q,this.spaceStation=new w,this.tractorBeam=new Q,this.spaceDock=new Z,this.hangar=new J,a?.clearComputerRows();for(let t=0;t<this.computer.processes.length;t++){a?.computerView.addComputerRow(t);let r=this.computer.processes[t];if(r)r.isMoving=!1,r.completions=0}a?.clearRobotRows();for(let t=0;t<this.robots.jobs.length;t++){a?.robotsView.addRobotRow(t);let r=this.robots.jobs[t];if(r)r.completions=0}}buyIce(){let t=this.cash;if(t<=0)return;this.cash-=this.ice.buyIce(t)}buyFarms(){let t=document.getElementById("buyFarmAmount"),r=Number(t.value);if(r*50>this.land.soil)r=Math.floor(this.land.soil/50);if(r<=0)return;this.land.soil-=r*50,this.farms.addFarm(r)}buyBattery(){let t=document.getElementById("buyBattery"),r=Number(t.value);if(r*30000>this.oxygen)r=Math.floor(this.oxygen/30000);if(r*20000>this.science)r=Math.floor(this.science/20000);if(r<=0)return;this.oxygen-=r*30000,this.science-=r*20000,this.energy.buyBattery(r)}buyBattleship(){let t=document.getElementById("buyBattleshipAmount"),r=Number(t.value);if(r*30000000>this.oxygen)r=Math.floor(this.oxygen/30000000);if(r*15000000>this.science)r=Math.floor(this.science/15000000);if(r<=0)return;this.oxygen-=30000000*r,this.science-=15000000*r,this.spaceDock.addBattleship(r)}buyHangar(){let r=document.getElementById("buyHangarAmount"),s=Number(r.value);if(s*1e6>this.land.soil)s=Math.floor(this.land.soil/1e6);if(s<=0)return;this.land.soil-=s*1e6,this.hangar.sendRate+=s,this.events.emit("hangar:updated")}}function se(){if(Ft)return;if(ee(),e?.tick(),Yt%100===0)mt()}function ie(t){St.postMessage({stop:!0}),St.postMessage({start:!0,ms:1000/t})}function Lt(){re()}var St=new Worker(new URL("./workers/interval.js",import.meta.url).href);St.onmessage=function(t){if(t.data==="interval.start")se()};async function Mt(){window.localStorage.terrafold2="",await Rt()}function ne(){if(a)a.destroy();e=new qt,a=new lt,e?.initialize(),window.game=e,window.view=a}function oe(){if(!a)return;a.farmsView.updateFull(),a.hangarView.updateFull(),a.spaceDockView.checkUnlocked(),a.tractorBeamView.checkUnlocked(),a.spaceStationView.checkUnlocked(),a.energyView.checkUnlocked(),a.computerView.checkUnlocked(),a.robotsView.checkUnlocked(),a.update()}async function Rt(){if(ne(),window.localStorage.terrafold2){let t=await Tt(window.localStorage.terrafold2),r=JSON.parse(t);if(e)Wt(r,e);if(e)for(let i of e.tractorBeam.comets)i.drawed=!1;let s=document.getElementById("scienceSlider");if(s&&e)s.value=e.population.scienceRatio.toString()}oe(),a?.refreshLayout(),ie(10)}function Wt(t,r){for(let s in t)if(typeof t[s]==="object"&&t[s]!==null){if(typeof r[s]>"u")r[s]=Array.isArray(t[s])?[]:{};Wt(t[s],r[s])}else if(typeof t[s]!=="function")r[s]=t[s]}async function mt(){let t={};if(e)Wt(e,t);window.localStorage.terrafold2=await Et(JSON.stringify(t))}async function Xt(){await mt();let t=document.getElementById("exportImportSave");if(t)t.value=await Et(window.localStorage.terrafold2||""),t.select(),document.execCommand("copy"),t.value=""}async function Kt(){let t=document.getElementById("exportImportSave");if(t)window.localStorage.terrafold2=await Tt(t.value),await Rt()}function Gt(){if(e)e.cash+=0.1}Rt();window.game=e;window.view=a;window.pauseGame=Lt;export{a as view,mt as save,Lt as pauseGame,Vt as incrementCometId,Kt as importSave,e as game,Xt as exportSave,Mt as clearSave,Gt as begForMoney};

//# debugId=363F66EF92CCAD1764756E2164756E21
//# sourceMappingURL=main.js.map
