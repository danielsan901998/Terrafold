function S(e){let s=1;if(e.ctrlKey)s*=5;if(e.shiftKey)s*=10;return s}function Ie(e){return Math.floor(e*10)/10}function Le(e){return Math.floor(e*100)/100}function fe(e){return Number(e.toPrecision(2))}function I(e){return Number(e.toPrecision(3))}function L(e,s,o,n,i){return M(e,s,o,n)<i}function M(e,s,o,n){return Math.sqrt(Math.pow(Math.abs(e-o),2)+Math.pow(Math.abs(s-n),2))}function E(e,s){let o=1;if(e<0)o=-1,e*=-1;if(e>=1e4)return(o===1?"+":"-")+Be(e,3);else return(o===1?"+":"-")+Re(e,s)}function r(e,s){if(e>=1e4)return Be(e,3);else return Re(e,s)}function Re(e,s){if(Number.isInteger(e))return e.toString();let o=3;if(s!==void 0)o=s;return e.toFixed(o-1).replace(pe,"$1")}var Se=[{value:1000000000000000000000000000000000000000000000000000000000000000,symbol:"V"},{value:1000000000000000000000000000000000000000000000000000000000000,symbol:"Nd"},{value:1000000000000000000000000000000000000000000000000000000000,symbol:"Od"},{value:1000000000000000000000000000000000000000000000000000000,symbol:"Sd"},{value:1000000000000000000000000000000000000000000000000000,symbol:"sd"},{value:1000000000000000000000000000000000000000000000000,symbol:"Qd"},{value:1000000000000000000000000000000000000000000000,symbol:"qd"},{value:1000000000000000000000000000000000000000000,symbol:"Td"},{value:1000000000000000000000000000000000000000,symbol:"Dd"},{value:1000000000000000000000000000000000000,symbol:"Ud"},{value:1000000000000000000000000000000000,symbol:"Dc"},{value:1000000000000000000000000000000,symbol:"N"},{value:1000000000000000000000000000,symbol:"O"},{value:1000000000000000000000000,symbol:"Sp"},{value:1000000000000000000000,symbol:"Sx"},{value:1000000000000000000,symbol:"Qi"},{value:1000000000000000,symbol:"Qa"},{value:1000000000000,symbol:"T"},{value:1e9,symbol:"B"},{value:1e6,symbol:"M"},{value:1000,symbol:"K"}],pe=/\.0+$|(\.[0-9]*[1-9])0+$/,B=new Map;function Be(e,s){let o=e+"|"+s,n=B.get(o);if(n!==void 0)return n;let i,a=!1;for(let c=0;c<Se.length;c++){let m=Se[c];if(m&&e>=m.value/1.000501){i=(e/m.value).toPrecision(s).replace(pe,"$1")+m.symbol,a=!0;break}}if(!a)i=e.toPrecision(s).replace(pe,"$1");if(B.size>1000){let c=B.keys().next().value;if(c!==void 0)B.delete(c)}return B.set(o,i),i}function Ne(e,s){e.sort((o,n)=>o[s]-n[s])}async function be(e){let s=new Blob([e]).stream().pipeThrough(new CompressionStream("gzip")),n=await new Response(s).arrayBuffer(),i=new Uint8Array(n),a="";for(let c=0;c<i.byteLength;c++)a+=String.fromCharCode(i[c]);return btoa(a)}async function ge(e){if(!e)return"";let s=e.trim();if(s.startsWith("{")&&s.endsWith("}"))return s;try{let o=atob(e),n=Uint8Array.from(o,(a)=>a.codePointAt(0)),i=new Blob([n]).stream().pipeThrough(new DecompressionStream("gzip"));return new Response(i).text()}catch(o){return e}}class u{static MINE_TICKS_MAX=2000;static FACTORY_TICKS_MAX=8000;static SOLAR_TICKS_MAX=1000;static COILGUN_TICKS_MAX=1000;static COILGUN_CHARGE_MAX=1000;static findArea(e){if(!t)return;let s=0;while(u.isWithinDistanceOfAny(e,e.x,e.y,75)){if(s++,s>40){console.log("too many planets");return}e.x=u.xAreaAllowed(),e.y=u.yAreaAllowed()}}static xAreaAllowed(){if(!t)return 0;let e=t.canvasWidth*0.8;return Math.random()*(e-200)}static yAreaAllowed(){if(!t)return 0;let e=t.canvasHeight*0.8;return Math.random()*(e-55)+10}static isWithinDistanceOfAny(e,s,o,n){if(!t)return!1;for(let i=0;i<t.space.planets.length;i++){let a=t.space.planets[i];if(!a||a===e)continue;if(L(s,o,a.x,a.y,n))return!0}return!1}static tick(e){if(!t)return;e.maxMines=t.hangar.maxMines,u.regenShields(e),u.tickResources(e)}static empty(e){return e.dirt<=0}static alive(e){return e.health>0}static regenShields(e){if(!u.alive(e)){e.atmo=0;return}if(e.atmo+=(e.maxAtmo-e.atmo)/100,e.atmo>e.maxAtmo)e.atmo=e.maxAtmo}static getShieldReduction(e){return e.atmo/e.maxAtmo}static takeDamage(e,s){let o=u.getShieldReduction(e),n=s*(1-o);e.atmo-=s*o;let i=0;if(e.atmo<0)i=e.atmo*-1,e.atmo=0;if(e.health-=n+i,e.health<0)e.health=0}static calcPower(e,s){if(!t)return;e.power=s*(e.isBoss?1.5:1),e.atmo=e.maxAtmo=Math.min(200,I(e.power*2+100)),e.health=e.maxHealth=I(e.power*20+1000),e.dirt=I(e.power*200+2000),e.maxMines=t.hangar.maxMines}static workConstruction(e,s){if(!u.doneFactory(e)){u.workOnFactory(e,s);return}if(!u.doneCoilgun(e)){u.workOnCoilgun(e,s);return}u.workOnMine(e,s)}static tickResources(e){if(u.empty(e))return;u.tickMines(e),u.tickBots(e),u.tickFactory(e),u.tickSolar(e),u.tickCoilgun(e)}static doneBuilding(e){return e.mines>=e.maxMines||u.empty(e)}static workOnMine(e,s){if(e.mineTicks+=s,e.mineTicks>=u.MINE_TICKS_MAX){let o=Math.floor(e.mineTicks/u.MINE_TICKS_MAX);o=Math.max(0,Math.min(o,e.maxMines-e.mines)),e.mines+=o,e.mineTicks-=o*u.MINE_TICKS_MAX}}static tickMines(e){e.ore+=e.mines}static tickBots(e){let s=Math.min(e.bots,e.ore);e.ore-=s,u.workOnSolar(e,s)}static doneFactory(e){return e.factoryTicks>=u.FACTORY_TICKS_MAX}static workOnFactory(e,s){e.factoryTicks+=s}static tickFactory(e){if(e.ore>=200){let s=Math.floor(e.ore/200);e.bots+=s,e.ore-=s*200}}static workOnSolar(e,s){if(e.solarTicks+=s,e.solarTicks>=u.SOLAR_TICKS_MAX){let o=Math.floor(e.solarTicks/u.SOLAR_TICKS_MAX);e.solar+=o,e.solarTicks-=o*u.SOLAR_TICKS_MAX}}static tickSolar(e){e.coilgunCharge+=e.solar}static doneCoilgun(e){return e.coilgunTicks>=u.COILGUN_TICKS_MAX}static workOnCoilgun(e,s){e.coilgunTicks+=s}static tickCoilgun(e){if(e.coilgunCharge>=u.COILGUN_CHARGE_MAX){let s=Math.floor(e.coilgunCharge/u.COILGUN_CHARGE_MAX);e.coilgunCharge-=s*u.COILGUN_CHARGE_MAX;let o=500*s;if(e.dirt<=o)o=e.dirt;if(e.dirt-=o,t&&t.spaceStation.orbiting[1])t.spaceStation.orbiting[1].amount+=o}}}class h{static foodPerShip=20;static actionRate=1;static actionSpeed=40;static globalTargetIndex=-1;static tick(e){h.checkEmpty(e),h.moveToNearestTarget(e),h.checkJoinFleet(e),h.attackTarget(e)}static updateGlobalTarget(){if(!t)return;let e=t.hangar.getTarget();h.globalTargetIndex=h.findClosestTarget(e.x,e.y)}static findClosestTarget(e,s){if(!t)return-1;let o=-1,n=1/0;for(let i=0;i<t.space.planets.length;i++){let a=t.space.planets[i];if(!u.doneBuilding(a)){let c=M(e,s,a.x,a.y);if(o===-1||c<n)o=i,n=c}}return o}static checkJoinFleet(e){if(!t||!e.engaged)return;for(let s=t.space.ships.length-1;s>=0;s--){let o=t.space.ships[s];if(o===e||h.isEmpty(o))continue;if(L(e.x,e.y,o.x,o.y,20))h.combineShips(e,o),t.space.ships.splice(s,1)}}static checkEmpty(e){if(e.food-=e.count,!h.isEmpty(e))return;e.food=0,e.engaged=!1,e.targetIndex=-1}static getTargetObject(e){if(!t)return null;if(e.targetIndex===-1)return t.hangar.getTarget();if(e.targetIndex>=0&&e.targetIndex<t.space.planets.length){let s=t.space.planets[e.targetIndex];if(!u.doneBuilding(s))return s}return e.targetIndex=h.findClosestTarget(e.x,e.y),e.targetIndex===-1?t.hangar.getTarget():t.space.planets[e.targetIndex]}static returnHome(e){if(!t)return;t.spaceDock.battleships+=e.count,t.spaceDock.sended-=e.count,t.farms.food+=e.food*h.foodPerShip,t.events.emit("spaceDock:updated");for(let s=t.space.ships.length-1;s>=0;s--)if(t.space.ships[s]===e){t.space.ships.splice(s,1);break}}static isEmpty(e){return e.food<=0}static getSpeed(e){if(t)return h.isEmpty(e)?t.spaceDock.emptySpeed:t.spaceDock.defaultSpeed;return h.isEmpty(e)?0.05:0.5}static moveToNearestTarget(e){let s=h.getTargetObject(e);if(!s)return;if(M(e.x,e.y,s.x,s.y)<40){if(!("isHome"in s)){e.engaged=!0;return}h.returnHome(e);return}e.engaged=!1;let o=h.getSpeed(e),n=0,i=s.y-e.y,a=s.x-e.x;if(i>=0&&a<0||i<0&&a<0)n=Math.PI;let c=Math.atan(i/a)+n;e.x=e.x+o*Math.cos(c),e.y=e.y+o*Math.sin(c),e.direction=c}static attackTarget(e){let s=h.getTargetObject(e);if(s&&!("isHome"in s)&&e.engaged){let o=s;if(e.actionCounter++,e.actionCounter>=h.actionSpeed){if(e.actionCounter=0,u.alive(o))u.takeDamage(o,h.actionRate*e.count);else if(u.workConstruction(o,e.count),u.doneBuilding(o))e.engaged=!1,e.targetIndex=h.findClosestTarget(e.x,e.y)}}}static combineShips(e,s){if(e.count+=s.count,e.energy+=s.energy,e.food+=s.food,s.actionCounter>e.actionCounter)e.actionCounter=s.actionCounter}}class F{isBoss=!1;view;x;y;mines=0;mineTicks=0;ore=0;bots=0;factoryTicks=0;solarTicks=0;solar=0;energy=0;coilgunTicks=0;coilgunCharge=0;id;power=0;atmo=0;maxAtmo=0;health=0;maxHealth=0;dirt=0;maxMines=0;constructor(){this.view={color:Math.floor(Math.random()*360),light:Math.floor(Math.random()*15+40)},this.x=u.xAreaAllowed(),this.y=u.yAreaAllowed(),u.findArea(this)}}class A{planets;ships;sector;allEmpty;constructor(){this.planets=[],this.ships=[],this.sector=0,this.allEmpty=!1}tick(){let e=this.planets[h.globalTargetIndex];if(!e||u.doneBuilding(e))h.updateGlobalTarget();if(!this.allEmpty){let s=!0;for(let o=0;o<this.planets.length;o++)if(u.tick(this.planets[o]),s&&!u.empty(this.planets[o]))s=!1;this.allEmpty=s}if(this.allEmpty&&this.ships.length===0)this.sector++,this.newLevel();for(let s=0;s<this.ships.length;s++)h.tick(this.ships[s])}spawnShip(e,s){e.x=-120,e.y=s,this.ships.push(e)}newLevel(){this.allEmpty=!1,this.planets=[];for(let s=0;s<10;s++){let o=new F;this.planets.push(o)}Ne(this.planets,"x");let e=this.planets[this.planets.length-1];if(e)e.isBoss=!0;for(let s=0;s<this.planets.length;s++)u.calcPower(this.planets[s],this.sector)}}class O{ice;buyable;gain;max;transferred;buyIncome=0;constructor(){this.ice=0,this.buyable=1000,this.gain=10,this.max=1000,this.transferred=0}tick(){if(this.buyIncome=0,this.buyable+=this.gain,this.buyable>this.max)this.buyable=this.max}transferWater(){return this.transferred=this.ice/1000,this.ice-=this.transferred,this.transferred}buyIce(e){if(this.buyable<e)e=this.buyable;return this.buyable-=e,this.ice+=e,this.buyIncome+=e,e}findIceSeller(e){this.max+=e*200,this.gain+=e}}class H{indoor;outdoor;maxIndoor;selling;excess;gain;waterSpending=0;transferred=0;constructor(){this.indoor=0,this.outdoor=0,this.maxIndoor=50,this.selling=0,this.excess=0,this.gain=0}tick(e){if(this.indoor+=e,this.excess=this.indoor-this.maxIndoor,this.excess>0)this.indoor=this.maxIndoor,this.outdoor+=this.excess;else this.excess=0;this.selling=this.indoor/100,this.waterSpending+=this.selling,this.indoor-=this.selling;let s=this.selling*2;if(this.gain+=s,t)t.cash+=s}transferWater(){return this.transferred=this.outdoor/1000,this.outdoor-=this.transferred,this.transferred}sellWater(e){if(this.indoor<e)e=this.indoor;this.indoor-=e,this.waterSpending+=e;let s=this.getPrice(e);if(this.gain+=s,t)t.cash+=s}getPrice(e){return e*2}}class W{water;initialStormTimer;stormTimer;stormRate;storming;initialStormDuration;stormDuration;transferred;lightningChance;lightningStrength;constructor(){this.water=0,this.initialStormTimer=300,this.stormTimer=300,this.stormRate=0,this.storming=0,this.initialStormDuration=60,this.stormDuration=60,this.transferred=0,this.lightningChance=0,this.lightningStrength=0}tick(e){this.water+=e,this.nextStormTimer(),this.tickLightning()}tickLightning(){if(this.lightningChance+=0.01*this.stormRate/100,this.lightningStrength=this.water*0.01,this.stormRate===100&&this.lightningChance>Math.random()*100){if(this.lightningChance=0,t)t.energy.gainEnergy(this.lightningStrength)}}transferWater(){return this.transferred=this.water/500*this.stormRate/100,this.water-=this.transferred,this.transferred}nextStormTimer(){if(this.stormTimer>0)this.stormTimer--;else if(this.stormDuration>0)this.storming=1;if(this.stormRate>=100)if(this.storming=0,this.stormDuration>0)this.storming=0,this.stormDuration--;else this.storming=-1;else if(this.stormRate<=0&&this.storming===-1)this.stormDuration=this.initialStormDuration,this.stormTimer=this.initialStormTimer,this.storming=0;this.stormRate+=this.storming}gainStormDuration(e){this.stormDuration+=e,this.initialStormDuration+=e}}class V{land;baseLand;optimizedLand;water;soil;transferred;convertedLand=0;constructor(e){this.land=e,this.baseLand=e,this.optimizedLand=e,this.water=0,this.soil=0,this.transferred=0}tick(e){this.water+=e,this.turnLandToSoil()}turnLandToSoil(){if(this.convertedLand=this.water/1000,this.land<this.convertedLand)this.convertedLand=this.land;this.land-=this.convertedLand,this.soil+=this.convertedLand,this.water-=this.convertedLand}transferWater(){return this.transferred=this.water/1000,this.water-=this.transferred,this.transferred}improveLand(){let e=(10*this.baseLand-this.optimizedLand)/100;this.optimizedLand+=e,this.land+=e}addLand(e){this.optimizedLand+=e,this.land+=e,this.baseLand+=e}}class _{water;ferns;fernsDelta;fernsWaterUse;smallTrees;smallTreesDelta;smallTreesWaterUse;trees;treesDelta;treesWaterUse;totalPlants;oxygenGain;waterSpending=0;transferred=0;constructor(){this.water=0,this.ferns=0,this.fernsDelta=0,this.fernsWaterUse=0,this.smallTrees=0,this.smallTreesDelta=0,this.smallTreesWaterUse=0,this.trees=0,this.treesDelta=0,this.treesWaterUse=0,this.totalPlants=0,this.oxygenGain=0}tick(e){if(this.waterSpending=0,this.water+=e,this.plantGrowth(),this.oxygenGain=this.ferns/1000+3*this.smallTrees/1000+this.trees/100,t)t.oxygen+=this.oxygenGain}plantGrowth(){if(!t)return;if(this.totalPlants=this.ferns+this.smallTrees+this.trees,this.treesDelta=this.smallTrees/1000,this.smallTreesDelta=this.ferns/1000-this.treesDelta,this.fernsDelta=(t.land.soil-this.totalPlants)/1000-this.ferns/1000,this.fernsWaterUse=(t.land.soil-this.totalPlants)/1000,this.fernsWaterUse=this.fernsWaterUse<0?0:this.fernsWaterUse,this.smallTreesWaterUse=this.ferns/1000,this.treesWaterUse=this.smallTrees/1000,this.fernsDelta<0){let e=0;if(this.ferns+this.fernsDelta<0)e=this.fernsDelta+this.ferns,this.fernsDelta=-1*this.ferns;if(this.smallTreesDelta+=e,e=0,this.smallTrees+this.smallTreesDelta<0)e=this.smallTrees+this.smallTreesDelta,this.smallTreesDelta=-1*this.smallTrees;this.treesDelta+=e}if(this.water<this.treesWaterUse)this.treesDelta=this.treesDelta>0?this.water:this.treesDelta,this.treesWaterUse=this.water;if(this.trees+=this.treesDelta,this.water-=this.treesWaterUse,this.waterSpending+=this.treesWaterUse,this.water<this.smallTreesWaterUse)this.smallTreesDelta=this.smallTreesDelta>0?this.water:this.smallTreesDelta,this.smallTreesWaterUse=this.water;if(this.smallTrees+=this.smallTreesDelta,this.water-=this.smallTreesWaterUse,this.waterSpending+=this.smallTreesWaterUse,this.water<this.fernsWaterUse)this.fernsDelta=this.fernsDelta>0?this.water:this.fernsDelta,this.fernsWaterUse=this.water;this.ferns+=this.fernsDelta,this.water-=this.fernsWaterUse,this.waterSpending+=this.fernsWaterUse}transferWater(){return this.transferred=this.water/1000,this.water-=this.transferred,this.transferred}}class U{water;farms;food;foodCreated;efficiency;farmRatio;waterSpending=0;transferred=0;constructor(){this.water=0,this.farms=0,this.food=0,this.foodCreated=0,this.efficiency=1,this.farmRatio=0}tick(e){this.waterSpending=0,this.water+=e,this.gainFood()}transferWater(){return this.transferred=this.water/1000,this.water-=this.transferred,this.transferred}gainFood(){if(this.foodCreated=this.farms/100*this.efficiency,this.foodCreated>this.water)this.foodCreated=this.water;this.waterSpending+=this.foodCreated,this.water-=this.foodCreated,this.food+=this.foodCreated}addFarm(e){this.farms+=e,t?.events.emit("farms:updated")}updateFarms(e){let s=e+this.farms*50,o=Math.floor(s*this.farmRatio/100/50),n=o-this.farms;if(n!==0)return this.farms=o,t?.events.emit("farms:updated"),n*50;return 0}improve(){this.efficiency+=0.02,t?.events.emit("farms:updated")}}class G{people;foodEaten;popGrowth;starving;scienceRatio;scienceDelta;cashDelta;happiness;houseBonus;happinessFromTrees=0;happinessFromOxygen=0;constructor(){this.people=0,this.foodEaten=0,this.popGrowth=0,this.starving=0,this.scienceRatio=0,this.scienceDelta=0,this.cashDelta=0,this.happiness=1,this.houseBonus=1}tick(){if(!t)return;if(this.foodEaten=this.people/100,this.foodEaten>t.farms.food)this.starving=this.foodEaten-t.farms.food,this.foodEaten=t.farms.food;else this.starving=0;t.farms.food-=this.foodEaten,this.popGrowth=(t.farms.food-this.people)/1000-this.starving/100,this.people+=this.popGrowth,this.updateHappiness(),this.tickRatio()}updateHappiness(){if(!t)return;this.happinessFromTrees=Math.log10(t.trees.trees+1)/10,this.happinessFromOxygen=Math.log10(t.oxygen+1)/20,this.happiness=this.houseBonus*(1+this.happinessFromTrees+this.happinessFromOxygen)}tickRatio(){if(!t)return;this.scienceDelta=this.people/100*(100-this.scienceRatio)/100*this.happiness,this.cashDelta=this.people/100*this.scienceRatio/100*this.happiness,t.science+=this.scienceDelta,t.cash+=this.cashDelta}improveHouse(){this.houseBonus+=0.1}}class g{text;tooltip;workers;currentTicks=0;ticksNeeded;cost;costType;completions=0;isMoving=!1;spendingCategory;finish;showing;done;constructor(e){this.text=e.text||"",this.tooltip=e.tooltip||"",this.workers=e.workers||e.threads||0,this.currentTicks=e.currentTicks||0,this.ticksNeeded=e.ticksNeeded||0,this.cost=e.cost??0,this.costType=e.costType??"",this.spendingCategory=e.spendingCategory,this.finish=e.finish||(()=>{}),this.showing=e.showing||(()=>!0),this.done=e.done}tick(e,s=1,o){if(e===0||this.done&&this.done())return this.isMoving=!1,0;if(this.ticksNeeded===0)return this.finish(),0;if(this.cost&&this.costType){let i=Array.isArray(this.cost)?this.cost:[this.cost],a=Array.isArray(this.costType)?this.costType:[this.costType];for(let c=0;c<i.length;c++){let m=e*i[c]*s,f=a[c];if(f&&t&&t[f]<m)return this.isMoving=!1,0}for(let c=0;c<i.length;c++){let m=e*i[c]*s,f=a[c];if(f&&t){if(t[f]-=m,o)o(f,m)}}}this.currentTicks+=e,this.isMoving=!0;let n=0;while(this.currentTicks>=this.ticksNeeded)this.currentTicks-=this.ticksNeeded,this.completions++,this.finish(),n++;return n}}class ${unlocked;threads;freeThreads;speed;processes;cashSpending=0;scienceSpending=0;metalSpending=0;woodSpending=0;constructor(){this.unlocked=0,this.threads=1,this.freeThreads=1,this.speed=1,this.processes=[new g({text:"Optimize Land",tooltip:"Improve 1% of unimproved land.<br>Max to improve to is ( 10 x base land )<br>Percent Optimized: <div id='landOptimized'></div>",ticksNeeded:600,finish:function(){if(t)t.land.improveLand();if(t)this.ticksNeeded=Math.floor(t.land.baseLand);t?.events.emit("computer:optimize-land:updated")}}),new g({text:"Buy Ice",tooltip:"Buy available ice",ticksNeeded:50,finish:function(){if(t)t.buyIce()}}),new g({text:"Sell Water",tooltip:"Sells up to 50 water",ticksNeeded:50,finish:function(){if(t)t.water.sellWater(50)}}),new g({text:"Improve Farms",tooltip:"Farm efficiency increases by 2%",ticksNeeded:40,finish:function(){if(t)t.farms.improve();this.ticksNeeded=I(20*(this.completions+2)+Math.pow(this.completions,2)/10)}}),new g({text:"Find more Ice Sellers",tooltip:"Gain 200 buyable ice and 1 more per tick",ticksNeeded:2000,cost:0.5,costType:"cash",finish:function(){if(t)t.ice.findIceSeller(1)}}),new g({text:"Bigger Storms",tooltip:"Storms last 5 more ticks. Max 300 duration.",ticksNeeded:600,cost:2,costType:"science",finish:function(){if(t)t.clouds.gainStormDuration(5);this.cost=this.cost+0.5,this.ticksNeeded+=50},done:function(){return t?t.clouds.initialStormDuration>=300:!1},showing:function(){return!this.done?.()}}),new g({text:"Build Robots",tooltip:"Builds a robot",ticksNeeded:1e4,cost:0.01,costType:"metal",finish:function(){if(t)t.robots.gainRobots(1)},showing:function(){return t?t.robots.unlocked!==0:!1},done:function(){return t?t.robots.robots>=t.robots.robotMax:!1}}),new g({text:"More Robot Storage",tooltip:"Can hold 5 more robots",ticksNeeded:20000,cost:0.5,costType:"wood",finish:function(){if(t)t.robots.gainStorage(5);this.ticksNeeded+=2000},showing:function(){return t?t.robots.unlocked!==0:!1}}),new g({text:"Improve House Design",tooltip:"Improves base happiness modifier by .1",ticksNeeded:3000,cost:10,costType:"science",finish:function(){if(t)t.population.improveHouse();this.ticksNeeded+=500},showing:function(){return t?t.robots.unlocked!==0:!1}}),new g({text:"Improve Ship engines",tooltip:"Ship speed increases by 0.1 and empty ship speed by 0.01",ticksNeeded:20000,cost:1e4,costType:"science",finish:function(){if(t)t.spaceDock.improveEngines(0.1,0.01);this.cost=this.cost+5000,this.ticksNeeded+=1000},done:function(){return t?t.spaceDock.defaultSpeed>=1:!1},showing:function(){return!this.done?.()&&(t?t.spaceDock.unlocked!==0:!1)}})]}tick(){this.cashSpending=0,this.scienceSpending=0,this.metalSpending=0,this.woodSpending=0;for(let e=0;e<this.processes.length;e++){let s=this.processes[e];this.tickRow(s,this.speed*s.workers)}}tickRow(e,s){if(!t)return;if(s===0){e.isMoving=!1;return}if(e.done&&e.done()){if(e.isMoving=!1,e.workers>0)this.freeThreads+=e.workers,e.workers=0;t.events.emit("computer:threads:updated");return}e.tick(s,1,(o,n)=>{let i=e.spendingCategory?.[o]||o+"Spending";if(this[i]!==void 0&&typeof this[i]==="number")this[i]+=n})}unlockComputer(){if(!t)return;if(t.science>=1000)t.science-=1000,this.unlocked=1,t.events.emit("computer:unlocked")}buyThread(){if(!t)return;let e=this.getThreadCost();if(t.cash>=e)t.cash-=e,this.threads++,this.freeThreads++,t.events.emit("computer:threads:updated")}getThreadCost(){return fe(Math.pow(2,this.threads)*500)}buySpeed(){if(!t)return;let e=this.getSpeedCost();if(t.science>=e)t.science-=e,this.speed++,t.events.emit("computer:speed:updated")}getSpeedCost(){return fe(Math.pow(2,this.speed)*500)}addThread(e,s){s=Math.min(s,this.freeThreads);let o=this.processes[e];if(o)o.workers+=s,this.freeThreads-=s,t?.events.emit("computer:threads:updated")}removeThread(e,s){let o=this.processes[e];if(o)s=Math.min(s,o.workers),o.workers-=s,this.freeThreads+=s,t?.events.emit("computer:threads:updated")}}class P{robots;robotsFree;robotMax;unlocked;mines;jobs;woodIncome=0;woodSpending=0;metalIncome=0;metalSpending=0;oreIncome=0;oreSpending=0;oreToDirtSpending=0;oxygenSpending=0;constructor(){this.robots=0,this.robotsFree=0,this.robotMax=5,this.unlocked=0,this.mines=0,this.jobs=[new g({text:"Cut Trees",tooltip:"Cut down 2 trees for 1 wood",finish:function(){if(t)t.robots.cutTrees(this.workers)}}),new g({text:"Expand indoor water storage",tooltip:"Gives 50 more max indoor water.<br>Cost increases by 1",ticksNeeded:3000,cost:[0.1],costType:["metal"],finish:function(){if(this.ticksNeeded+=1000,t)t.water.maxIndoor+=50}}),new g({text:"Build Mines",tooltip:"Build mines to get ore. Limit: floor((land/1000)^2 / 10)",ticksNeeded:300,cost:[1],costType:["wood"],finish:function(){if(t)t.robots.mines++;this.ticksNeeded+=200+this.completions*50},done:function(){if(!t)return!1;let e=t.land.optimizedLand/1000,s=Math.floor(Math.pow(e,2)/10);return t.robots.mines>=s}}),new g({text:"Mine Ore",tooltip:"Get (mines / 100) ore per tick",finish:function(){if(t)t.robots.mineOre(this.workers)}}),new g({text:"Smelt Ore",tooltip:"Each tick costs 5 wood, 1 ore, and 1000 oxygen<br>Gain 1 metal",finish:function(){if(t)t.robots.smeltOre(this.workers)}}),new g({text:"Turn ore into dirt",tooltip:"Each tick costs 1 energy and 1000 ore<br>Gain 5 Base Land<br>Total land gained: <span id='totalDirtFromOre'></span>",ticksNeeded:1000,cost:[1,1000],costType:["power","ore"],spendingCategory:{ore:"oreToDirtSpending"},finish:function(){if(t)t.land.addLand(50)},showing:function(){return t?t.energy.unlocked!==0:!1}})]}tick(){this.woodIncome=0,this.woodSpending=0,this.metalIncome=0,this.metalSpending=0,this.oreIncome=0,this.oreSpending=0,this.oreToDirtSpending=0,this.oxygenSpending=0;for(let e=0;e<this.jobs.length;e++)this.tickRow(this.jobs[e],this.jobs[e].workers)}tickRow(e,s){if(!t)return;if(e.tick(s,1,(n,i)=>{let a=e.spendingCategory?.[n]||n+"Spending";if(this[a]!==void 0&&typeof this[a]==="number")this[a]+=i})>0)t.events.emit("robots:count:updated")}gainRobots(e){this.robots+=e,this.robotsFree+=e,t?.events.emit("robots:count:updated")}gainStorage(e){this.robotMax+=e,t?.events.emit("robots:storage:updated")}unlockRobots(){if(!t)return;if(t.cash>=3000)t.cash-=3000,this.unlocked=1,t.events.emit("robots:unlocked"),this.gainRobots(1);t.events.emit("robots:count:updated"),t.events.emit("robots:storage:updated")}addWorker(e,s){let o=this.jobs[e];if(o)s=Math.min(s,this.robotsFree),o.workers+=s,this.robotsFree-=s;t?.events.emit("robots:count:updated")}removeWorker(e,s){let o=this.jobs[e];if(o)s=Math.min(s,o.workers),o.workers-=s,this.robotsFree+=s;t?.events.emit("robots:count:updated")}cutTrees(e){if(t&&t.trees.trees>=2*e)t.trees.trees-=2*e,t.wood+=e,this.woodIncome+=e}mineOre(e){if(t){let s=t.robots.mines/100*e;t.ore+=s,this.oreIncome+=s}}smeltOre(e){if(t&&t.wood>=5*e&&t.ore>=e&&t.oxygen>=e*1000)t.wood-=5*e,t.ore-=e,t.oxygen-=1000*e,t.metal+=e,this.woodSpending+=5*e,this.oreSpending+=e,this.oxygenSpending+=1000*e,this.metalIncome+=e}}class X{unlocked;battery;drain=0;constructor(){this.unlocked=0,this.battery=100}unlockEnergy(){if(t&&t.metal>=500)t.metal-=500,this.unlocked=1,t.events.emit("energy:unlocked");t?.events.emit("energy:battery:updated")}tick(){if(!t)return;let e=t.power-this.battery;if(this.drain=0,e>0)this.drain=e/500,t.power-=this.drain}gainEnergy(e){if(t)t.power+=e}buyBattery(e){this.battery+=e,t?.events.emit("energy:battery:updated")}}class j{unlocked;orbiting;waterIncome=0;constructor(){this.unlocked=0,this.orbiting=[{type:"ice",amount:1e6},{type:"dirt",amount:500}]}unlockSpaceStation(){if(t&&t.metal>=2000&&t.wood>=20000)t.metal-=2000,t.wood-=20000,this.unlocked=1,t.events.emit("spaceStation:unlocked");t?.events.emit("spaceStation:updated")}tick(){if(this.waterIncome=0,!this.unlocked||!t)return;for(let e=0;e<this.orbiting.length;e++){let s=this.orbiting[e],o=s.amount/1e5;s.amount-=o;let n=s.type;if(n==="ice")t.ice.ice+=o,this.waterIncome+=o;else if(n==="dirt")t.land.addLand(o)}}}function D(e,s,o){let n=e*s,i=o*(n*0.4)+n*0.1,a=Math.pow(Math.pow(n,2)-Math.pow(i,2),0.5),c=(0-i)/a;return{startingY:i,endingX:a,slope:c}}class K{unlocked;cometSpotChance;takeAmount;comets;constructor(){this.unlocked=0,this.cometSpotChance=0.006,this.takeAmount=[{type:"ice",amount:0},{type:"dirt",amount:0}],this.comets=[]}tick(){if(!this.unlocked||!t)return;if(this.checkForNewAsteroids(),this.comets.length){let e=t.power/1000;t.power-=this.pullIntoOrbit(e),this.removeAsteroidIfDone()}}unlockTractorBeam(){if(!t)return;if(t.science>=500000&&t.oxygen>=5000000)t.science-=500000,t.oxygen-=2000000,this.unlocked=1,t.events.emit("tractorBeam:unlocked"),t.spaceDock.unlocked=1,t.events.emit("spaceDock:unlocked");t.events.emit("tractorBeam:updated")}pullIntoOrbit(e){if(!t)return 0;let s=e/this.comets.length,o=0;for(let n=0;n<t.spaceStation.orbiting.length;n++){let i=t.spaceStation.orbiting[n],a=0;for(let m=0;m<this.comets.length;m++){let f=this.comets[m];if(f.amountType===i.type){let y=Math.min(s,f.amount);o+=y,f.amount-=y,a+=y}}i.amount+=a;let c=this.takeAmount.find((m)=>m.type===i.type);if(c)c.amount=a;else this.takeAmount.push({type:i.type,amount:a})}return o}checkForNewAsteroids(){if(Math.random()<this.cometSpotChance)this.addComet()}removeAsteroidIfDone(){let e=this.comets.length-1;for(let s=e;s>=0;s--){let o=this.comets[s];if(o.duration--,o.duration<0||o.amount<1){if(o.drawed)t?.events.emit("tractorBeam:removeComet",o);this.comets.splice(s,1)}}}addComet(){if(!t||this.comets.length>20)return;let e=Math.random(),s=Math.random()*100*t.space.sector+200,o=Math.floor(Math.random()*800+400),n=Math.random()*2+1,i={};if(e<0.9)i={name:"Comet",amountType:"ice",amount:s*1000,initialAmount:s*1000,duration:o,initialDuration:o,speed:n};else i={name:"Asteroid",amountType:"dirt",amount:s,initialAmount:s,duration:o*2,initialDuration:o*2,speed:n/2};i.id=Me(),i.drawed=!1;let a=D(i.speed||0,i.duration||0,Math.random());i.startingY=a.startingY,i.endingX=a.endingX,i.slope=a.slope,i.left=0,this.comets.push(i)}}class Y{battleships;unlocked;sended;defaultSpeed=0.5;emptySpeed=0.05;constructor(){this.battleships=0,this.unlocked=0,this.sended=0}addBattleship(e){this.battleships+=e,t?.events.emit("spaceDock:updated")}improveEngines(e,s){this.defaultSpeed+=e,this.emptySpeed+=s,t?.events.emit("spaceDock:updated")}}class J{count;food;actionCounter;energy;x;y;engaged;direction;targetIndex;constructor(e,s,o){this.count=e,this.food=s/o,this.actionCounter=0,this.energy=0,this.x=0,this.y=0,this.engaged=!1,this.direction=0,this.targetIndex=-1}}class q{sendRate;timeRemaining;totalTime;y;maxMines;constructor(){this.sendRate=1,this.timeRemaining=this.totalTime=40,this.y=(t?.canvasHeight||600)*0.5-25,this.maxMines=10}tick(){if(!t)return;if(this.y=t.canvasHeight*0.5-25,this.timeRemaining--,this.timeRemaining<0)if(t.spaceDock.battleships>0&&!t.space.allEmpty){let e=Math.min(this.sendRate,t.spaceDock.battleships),s=t.farms.food*0.05;t.farms.food-=s;let o=new J(e,s,h.foodPerShip);o.targetIndex=h.globalTargetIndex,t.space.spawnShip(o,this.y),t.spaceDock.battleships-=e,t.spaceDock.sended+=e,t.events.emit("spaceDock:updated"),this.timeRemaining=this.totalTime}else this.timeRemaining=0}getTarget(){return{isHome:!0,x:-125,y:this.y}}}class N{aProgress;color;lastPercentage=-1;constructor(e,s){this.aProgress=document.getElementById(e),this.color=s}tick(e,s){if(!this.aProgress||s<=0)return;let o=e/s;if(Math.abs(this.lastPercentage-o)<0.001)return;this.lastPercentage=o,this.reset(this.aProgress),this.drawProgress(this.aProgress,o,this.color)}reset(e){if(!e)return;let s=e.getContext("2d");if(!s)return;s.lineCap="square";let o=e.width/2,n=e.width/2-5;s.beginPath(),s.lineWidth=8,s.fillStyle="#1e1e1e",s.arc(o,o,n,0,2*Math.PI),s.fill()}drawProgress(e,s,o){if(!e)return;let n=e.getContext("2d");if(!n)return;let i=Math.PI/2,a=2*s*0.95*Math.PI-i*0.9,c=0-i*0.9,m=e.width/2,f=e.width/2-10;n.lineCap="square",n.beginPath(),n.lineWidth=8,n.strokeStyle=o,n.arc(m,m,f,c,a),n.stroke()}}var T=document.getElementById("spaceCanvas"),d=T?T.getContext("2d"):null;if(d)d.font="13px Arial";var R=240,ye={x:0,y:0};function Fe(){if(!T||!t)return;if(T.width!==t.canvasWidth||T.height!==t.canvasHeight){if(T.width=t.canvasWidth,T.height=t.canvasHeight,R=T.width/5,d)d.font="13px Arial"}}if(T)window.addEventListener("resize",Fe),Fe(),T.addEventListener("mousemove",function(e){ye={x:e.offsetX-R,y:e.offsetY}});function we(){if(!d||!t||!T)return;d.clearRect(0,0,T.width,T.height),Xe(),Pe(),$e()}function $e(){if(!t)return;for(let e=0;e<t.space.planets.length;e++)Ke(t.space.planets[e])}function Pe(){if(!t)return;for(let e=0;e<t.space.ships.length;e++)je(t.space.ships[e])}function Xe(){if(!t)return;for(let e=0;e<t.space.planets.length;e++){let s=t.space.planets[e];De(s,s.isBoss?"B":(e+1).toString())}}function je(e){if(!d)return;let s=e.x+R,o=h.getTargetObject(e);if(e.engaged&&o&&e.actionCounter<10){let m="isHome"in o,f=Te(!m?o.isBoss:!1);d.save(),d.beginPath(),d.strokeStyle="rgba(255, 50, 50, "+(1-e.actionCounter/10)+")",d.lineWidth=3,d.moveTo(s+25,e.y+25),d.lineTo(o.x+R+f,o.y+f),d.stroke(),d.restore()}d.save(),d.translate(s+25,e.y+25),d.rotate(e.direction);let n={x:-10,y:-10},i={x:10,y:0},a={x:-10,y:10},c={x:-7,y:0};d.beginPath(),d.fillStyle="#008080",d.lineWidth=3,d.moveTo(n.x,n.y),d.lineTo(i.x,i.y),d.lineTo(a.x,a.y),d.lineTo(c.x,c.y),d.fill(),d.restore(),d.save(),d.translate(s+25,e.y+25),d.fillStyle="white",d.fillText(r(e.count),-4,20),d.fillText(r(e.food/e.count/10,1),-4,30),d.restore()}function De(e,s){if(!d)return;let o=Te(e.isBoss),n=e.x+R;d.save(),d.translate(n+o,e.y+o),Ye(e,o),Je(e,o),qe(e,o),d.fillStyle="white",d.fillText(s,-3,4),d.restore()}function Ke(e){if(!d)return;let s=Te(e.isBoss),o=e.x+R;if(!L(ye.x,ye.y,e.x+s,e.y+s,50))return;d.save(),d.translate(o+s,e.y+s),d.fillStyle="#ffffff",d.fillText("Atmosphere: "+r(e.atmo),-15,s),d.fillText("Reduction: "+r(u.getShieldReduction(e)*100)+"%",-15,s+10),d.fillText("Health: "+r(e.health),-15,s+20),d.fillText("Dirt: "+r(e.dirt),-15,s+30),d.fillText("Ore: "+r(e.ore),-15,s+40),d.fillText("C.Bots: "+r(e.bots)+" / "+r(e.maxMines),-15,s+50),d.fillText("Solar: "+r(e.solar),-15,s+60),d.fillText("Build Factory: "+r(e.factoryTicks)+" / "+r(u.FACTORY_TICKS_MAX),-15,s+70),d.fillText("Build Coilgun: "+r(e.coilgunTicks)+" / "+r(u.COILGUN_TICKS_MAX),-15,s+80),d.fillText("Coilgun Charge: "+r(e.coilgunCharge)+" / "+r(u.COILGUN_CHARGE_MAX),-15,s+90),d.fillText("Build Solar: "+r(e.solarTicks)+" / "+r(u.SOLAR_TICKS_MAX),-15,s+100),d.fillText("Mines: "+r(e.mines)+" / "+r(e.maxMines),-15,s+110),d.fillText("Build Mine: "+r(e.mineTicks)+" / "+r(u.MINE_TICKS_MAX),-15,s+120),d.restore()}function Ye(e,s){if(!d)return;let o=s*(e.atmo/e.maxAtmo/2+0.5),n=d.createRadialGradient(0,0,o*1.1,0,0,o/3.3);n.addColorStop(0,"black");let i="hsl("+(e.view.color+120)+",90%,60%)";n.addColorStop(1,i),d.fillStyle=n,d.fillRect(-s,-s,s*2,s*2),d.beginPath(),d.strokeStyle="#008080",d.lineWidth=3,d.arc(0,0,s-4,0,2*Math.PI*(e.atmo/e.maxAtmo)),d.stroke()}function Je(e,s){if(!d)return;d.beginPath();let o=Math.floor(e.health/e.maxHealth*70+10);d.fillStyle="hsl("+e.view.color+","+o+"%,"+e.view.light+"%)",d.arc(0,0,s/2,0,2*Math.PI),d.fill(),d.beginPath(),d.strokeStyle="#b6000b",d.lineWidth=3,d.moveTo(-s*2/3,-s),d.lineTo(-s*2/3+s*4/3*(e.health/e.maxHealth),-s),d.stroke()}function qe(e,s){if(!d||u.empty(e))return;let o=Math.PI/2,n=-o;if(e.factoryTicks>0&&e.factoryTicks<u.FACTORY_TICKS_MAX){let a=2*(e.factoryTicks/u.FACTORY_TICKS_MAX)*Math.PI-o;d.beginPath(),d.strokeStyle="#888888",d.lineWidth=2,d.arc(0,0,s*0.9,n,a),d.stroke()}if(e.coilgunTicks>0&&e.coilgunTicks<u.COILGUN_TICKS_MAX){let a=2*(e.coilgunTicks/u.COILGUN_TICKS_MAX)*Math.PI-o;d.beginPath(),d.strokeStyle="#884400",d.lineWidth=2,d.arc(0,0,s*0.8,n,a),d.stroke()}if(e.coilgunTicks>=u.COILGUN_TICKS_MAX&&e.coilgunCharge>0){let a=2*(e.coilgunCharge/u.COILGUN_CHARGE_MAX)*Math.PI-o;d.beginPath(),d.strokeStyle="#ffcc00",d.lineWidth=2,d.arc(0,0,s*0.8,n,a),d.stroke()}if(e.solar>0||e.solarTicks>0){let a=2*(e.solarTicks/u.SOLAR_TICKS_MAX)*Math.PI-o;d.beginPath(),d.strokeStyle="#4444ff",d.lineWidth=2,d.arc(0,0,s*0.7,n,a),d.stroke()}if(e.mines<e.maxMines&&e.mineTicks>0){let a=2*(e.mineTicks/u.MINE_TICKS_MAX)*Math.PI-o;d.beginPath(),d.strokeStyle="#666666",d.lineWidth=2,d.arc(0,0,s*0.6,n,a),d.stroke()}}function Te(e){return e?40:25}class p{textCache=new Map;elementCache=new Map;clearCache(){this.textCache.clear(),this.elementCache.clear()}getElement(e){let s=this.elementCache.get(e);if(!s){let o=document.getElementById(e);if(!o)throw Error(`Element ${e} not found`);s=o,this.elementCache.set(e,s)}return s}updateElementText(e,s){if(this.textCache.get(e)===s)return;this.getElement(e).textContent=s,this.textCache.set(e,s)}updateElementHTML(e,s){if(this.textCache.get(e)===s)return;this.getElement(e).innerHTML=s,this.textCache.set(e,s)}setVisible(e,s){let o=this.getElement(e);if(s)o.classList.remove("hidden");else o.classList.add("hidden")}}class Q extends p{constructor(){super();if(t)t.events.on("computer:unlocked",()=>this.checkUnlocked()),t.events.on("computer:threads:updated",()=>this.updateThreads()),t.events.on("computer:speed:updated",()=>this.updateSpeed()),t.events.on("computer:optimize-land:updated",()=>this.updateLandOptimized())}checkUnlocked(){if(!t)return;if(t.computer.unlocked)this.setVisible("unlockedComputer",!0),this.setVisible("unlockComputer",!1),this.setVisible("robotsContainer",!0),this.updateThreads(),this.updateSpeed();else this.setVisible("unlockedComputer",!1),this.setVisible("unlockComputer",!0),this.setVisible("robotsContainer",!1)}updateLandOptimized(){if(!t)return;this.updateElementText("landOptimized",Le(t.land.optimizedLand/(t.land.baseLand*10)*100)+"%")}updateThreads(){if(!t)return;this.updateElementText("freeThreads",r(t.computer.freeThreads)),this.updateElementText("threads",r(t.computer.threads)),this.updateElementText("threadCost",r(t.computer.getThreadCost()));for(let e=0;e<t.computer.processes.length;e++){let s=t.computer.processes[e];if(!s)continue;this.updateElementText("computerRow"+e+"Threads",r(s.workers)),this.setVisible("computerRow"+e+"Container",s.showing())}}updateSpeed(){if(!t)return;this.updateElementText("speed",r(t.computer.speed)),this.updateElementText("speedCost",r(t.computer.getSpeedCost()))}update(){this.updateThreads(),this.updateSpeed(),this.updateLandOptimized()}updateRowProgress(e){if(!t||!t.computer.unlocked)return;let s=t.computer.processes[e];if(!s||!s.showing())return;let o="computerRow"+e,n=this.getElement(o+"PB");n.style.width=s.currentTicks/s.ticksNeeded*100+"%",n.style.backgroundColor=s.isMoving?"yellow":"red",this.updateElementText(o+"CurrentTicks",r(s.currentTicks)),this.updateElementText(o+"TicksNeeded",r(s.ticksNeeded));let i=this.getElement(o+"CostContainer");if(s.cost!==0){i.classList.remove("hidden");let a=Array.isArray(s.cost)?s.cost[0]||0:s.cost,c=Array.isArray(s.costType)?s.costType[0]||"":s.costType;this.updateElementText(o+"Cost",r(a)),this.updateElementText(o+"CostType",c)}else i.classList.add("hidden")}addComputerRow(e){let s=this.getElement("computerRows"),o=document.createElement("div");o.className="computerRow";let n="computerRow"+e;o.id=n+"Container";let i=document.createElement("button");i.id=n+"Plus",i.innerHTML="+",i.addEventListener("click",(k)=>t?.computer.addThread(e,S(k)));let a=document.createElement("button");a.id=n+"Minus",a.innerHTML="-",a.addEventListener("click",(k)=>t?.computer.removeThread(e,S(k)));let c=document.createElement("div");c.id=n+"Threads",c.className="small",c.style.marginRight="4px";let m=t?.computer.processes[e]?.text||"",f=document.createElement("div");f.innerHTML=m;let y=document.createElement("div");y.className="rowProgressBarOuter",y.innerHTML="<div class='rowProgressBarInner' id='"+n+"PB'></div>";let l=document.createElement("div");l.className="computerTooltipContainer",l.id=n+"Tooltip";let w=document.createElement("div");w.className="rowTooltip";let C=t?.computer.processes[e]?.tooltip||"";w.innerHTML=`
            <div class="tooltipDescription">${C}</div>
            <div class="tooltipDivider"></div>
            <div class="tooltipStats">
                <div><b>Progress:</b> <span id="${n}CurrentTicks"></span> / <span id="${n}TicksNeeded"></span> ticks</div>
                <div id="${n}CostContainer" class="hidden"><b>Cost:</b> <span id="${n}Cost"></span> <span id="${n}CostType"></span> per tick</div>
            </div>
        `,l.appendChild(w),o.appendChild(i),o.appendChild(c),o.appendChild(a);let x=document.createElement("div");x.className="rowLabel",x.appendChild(f),o.appendChild(x),o.appendChild(y),o.appendChild(l),s.appendChild(o)}}class Z extends p{constructor(){super();if(t)t.events.on("robots:unlocked",()=>{this.checkUnlocked(),this.updateCount(),this.updateStorage()}),t.events.on("robots:count:updated",()=>this.updateCount()),t.events.on("robots:storage:updated",()=>this.updateStorage())}checkUnlocked(){if(!t)return;if(t.robots.unlocked)this.setVisible("unlockedRobots",!0),this.setVisible("unlockRobots",!1),this.setVisible("lightningContainer",!0),this.setVisible("lightningTooltip",!0),this.setVisible("energyContainer",!0),this.setVisible("woodContainer",!0),this.setVisible("oreContainer",!0),this.setVisible("metalContainer",!0),this.updateCount(),this.updateStorage();else this.setVisible("unlockedRobots",!1),this.setVisible("unlockRobots",!0),this.setVisible("lightningContainer",!1),this.setVisible("lightningTooltip",!1),this.setVisible("energyContainer",!1),this.setVisible("woodContainer",!1),this.setVisible("oreContainer",!1),this.setVisible("metalContainer",!1)}update(){if(!t)return}updateCount(){if(!t)return;if(this.updateElementText("robots",r(t.robots.robots)),this.updateElementText("robotsFree",r(t.robots.robotsFree)),t.robots.jobs[5])this.updateElementText("totalDirtFromOre",r(t.robots.jobs[5].completions*5));for(let e=0;e<t.robots.jobs.length;e++){let s=t.robots.jobs[e];if(!s)continue;let o="robotRow"+e;if(this.updateElementText(o+"Workers",r(s.workers)),this.setVisible(o+"Container",s.showing()),s.text.includes("Build Mines")){let n=t.land.optimizedLand/1000,i=Math.floor(Math.pow(n,2)/10);this.updateElementHTML(o+"Description",`Build mines to get ore. Limit: ${i}. Currently: ${t.robots.mines}`)}}this.update()}updateStorage(){if(!t)return;this.updateElementText("robotMax",r(t.robots.robotMax))}updateFull(){this.updateCount(),this.updateStorage()}updateRowProgress(e){if(!t)return;let s=t.robots.jobs[e];if(!s||!s.showing()||s.ticksNeeded===0)return;let o="robotRow"+e,n=this.getElement(o+"PB");n.style.width=s.currentTicks/s.ticksNeeded*100+"%",n.style.backgroundColor=s.isMoving?"yellow":"red",this.updateElementText(o+"CurrentTicks",r(s.currentTicks)),this.updateElementText(o+"TicksNeeded",r(s.ticksNeeded));let i=this.getElement(o+"CostContainer");if(s.cost&&s.costType){i.classList.remove("hidden");let a=Array.isArray(s.cost)?s.cost:[s.cost],c=Array.isArray(s.costType)?s.costType:[s.costType],m=r(a[0]||0)+" "+(c[0]||"");m+=a.length>1?" and "+r(a[1]||0)+" "+(c[1]||""):"",this.updateElementText(o+"Cost",m)}else i.classList.add("hidden")}addRobotRow(e){let s=this.getElement("robotRows"),o=document.createElement("div");o.className="robotRow";let n="robotRow"+e;o.id=n+"Container";let i=document.createElement("button");i.id=n+"Plus",i.innerHTML="+",i.addEventListener("click",(v)=>t?.robots.addWorker(e,S(v)));let a=document.createElement("button");a.id=n+"Minus",a.innerHTML="-",a.addEventListener("click",(v)=>t?.robots.removeWorker(e,S(v)));let c=document.createElement("div");c.id=n+"Workers",c.className="small",c.style.marginRight="4px";let m=t?.robots.jobs[e]?.text||"",f=document.createElement("div");f.id=n+"Text",f.innerHTML=m;let y=document.createElement("div");if(t?.robots.jobs[e]?.ticksNeeded)y.className="rowProgressBarOuter",y.innerHTML="<div class='rowProgressBarInner' id='"+n+"PB'></div>";let l=document.createElement("div");l.className="computerTooltipContainer",l.id=n+"Tooltip";let w=document.createElement("div");w.className="rowTooltip";let C=t?.robots.jobs[e]?.tooltip||"",x="";if(t?.robots.jobs[e]?.ticksNeeded)x=`
                <div class="tooltipDivider"></div>
                <div class="tooltipStats">
                    <div><b>Progress:</b> <span id="${n}CurrentTicks"></span> / <span id="${n}TicksNeeded"></span> ticks</div>
                    <div id="${n}CostContainer" class="hidden"><b>Cost:</b> <span id="${n}Cost"></span> per tick</div>
                </div>
            `;w.innerHTML=`
            <div class="tooltipDescription" id="${n}Description">${C}</div>
            ${x}
        `,l.appendChild(w),o.appendChild(i),o.appendChild(c),o.appendChild(a);let k=document.createElement("div");if(k.className="rowLabel",k.appendChild(f),o.appendChild(k),y.innerHTML)o.appendChild(y);o.appendChild(l),s.appendChild(o)}}class z extends p{update(){if(!t)return;this.updateElementText("totalWater",r(t.ice.ice+t.water.indoor+t.water.outdoor+t.clouds.water+t.land.water+t.trees.water+t.farms.water)),this.updateElementText("waterIncome",r(t.spaceStation.waterIncome,4)),this.updateElementText("waterBought",r(t.ice.buyIncome,4)),this.updateElementText("waterSpending",r(t.water.waterSpending,4)),this.updateElementText("waterFarms",r(t.farms.waterSpending,4)),this.updateElementText("waterTrees",r(t.trees.waterSpending,4)),this.updateElementText("waterNet",E(t.spaceStation.waterIncome+t.ice.buyIncome-t.water.waterSpending-t.farms.waterSpending-t.trees.waterSpending,4)),this.updateElementText("cash",r(t.cash)),this.updateElementText("cashIncome",r(t.population.cashDelta+t.water.gain,4)),this.updateElementText("cashFromPeople",r(t.population.cashDelta,4)),this.updateElementText("cashFromWater",r(t.water.gain,4)),this.updateElementText("cashComputer",r(t.computer.cashSpending,4)),this.updateElementText("cashNet",E(t.population.cashDelta+t.water.gain-t.computer.cashSpending,4)),this.updateElementText("oxygen",r(t.oxygen)),this.updateElementText("oxygenIncome",r(t.trees.oxygenGain,4)),this.updateElementText("oxygenLeak",r(t.oxygenLeak,4)),this.updateElementText("oxygenSmelting",r(t.robots.oxygenSpending,4)),this.updateElementText("oxygenNet",E(t.trees.oxygenGain-t.oxygenLeak-t.robots.oxygenSpending,4)),this.updateElementText("science",r(t.science)),this.updateElementText("scienceIncome",r(t.population.scienceDelta,4)),this.updateElementText("scienceComputer",r(t.computer.scienceSpending,4)),this.updateElementText("scienceNet",E(t.population.scienceDelta-t.computer.scienceSpending,4)),this.updateElementText("wood",r(t.wood)),this.updateElementText("woodIncome",r(t.robots.woodIncome,4)),this.updateElementText("woodSpending",r(t.robots.woodSpending,4)),this.updateElementText("woodComputer",r(t.computer.woodSpending,4)),this.updateElementText("woodNet",E(t.robots.woodIncome-t.robots.woodSpending-t.computer.woodSpending,4)),this.updateElementText("metal",r(t.metal)),this.updateElementText("metalIncome",r(t.robots.metalIncome,4)),this.updateElementText("metalSpending",r(t.robots.metalSpending,4)),this.updateElementText("metalComputer",r(t.computer.metalSpending,4)),this.updateElementText("metalNet",E(t.robots.metalIncome-t.robots.metalSpending-t.computer.metalSpending,4)),this.updateElementText("ore",r(t.ore,4)),this.updateElementText("oreIncome",r(t.robots.oreIncome,4)),this.updateElementText("oreSpending",r(t.robots.oreSpending,4)),this.updateElementText("oreToDirtSpending",r(t.robots.oreToDirtSpending,4)),this.updateElementText("oreNet",E(t.robots.oreIncome-t.robots.oreSpending-t.robots.oreToDirtSpending,4))}}class ee extends p{update(){if(!t)return;this.updateElementText("ice",r(t.ice.ice)),this.updateElementText("buyableIce",r(t.ice.buyable)),this.updateElementText("iceTransferred",r(t.ice.transferred,4)),this.updateElementText("indoorWaterReceived",r(Math.max(0,t.ice.transferred-t.water.excess),4)),this.updateElementText("iceBuyerAmount",r(t.ice.gain)),this.updateElementText("indoorWater",r(t.water.indoor)),this.updateElementText("indoorWaterMax",r(t.water.maxIndoor)),this.updateElementText("indoorWaterSelling",r(t.water.selling)),this.updateElementText("indoorWaterProfits",r(t.water.gain)),this.updateElementText("excessWater",r(t.water.excess,4))}}class te extends p{update(){if(!t)return;this.updateElementText("clouds",r(t.clouds.water)),this.updateElementText("stormTimer",r(t.clouds.stormTimer)),this.updateElementText("stormRate",t.clouds.stormRate+"%"),this.getElement("intensityPB").style.height=t.clouds.stormRate+"%",this.updateElementText("stormDuration",r(t.clouds.stormDuration)),this.updateElementText("rain",r(t.clouds.transferred,4)),this.updateElementText("landReceived",r(t.clouds.transferred,4)),this.updateElementText("lightningChance",r(t.clouds.lightningChance)+"%"),this.getElement("lightningPB").style.height=t.clouds.lightningChance+"%",this.updateElementText("lightningStrength",r(t.clouds.lightningStrength))}}class se extends p{update(){if(!t)return;this.updateElementText("outdoorWater",r(t.water.outdoor)),this.updateElementText("lakeWaterFromStorage",r(t.water.excess,4)),this.updateElementText("waterTransferred",r(t.water.transferred,4)),this.updateElementText("cloudsReceived",r(t.water.transferred,4)),this.updateElementText("landWater",r(t.land.water)),this.updateElementText("optimizedLand",r(t.land.optimizedLand)),this.updateElementText("baseLand",r(t.land.baseLand)),this.updateElementText("land",r(t.land.land)),this.updateElementText("soil",r(t.land.soil)),this.updateElementText("landConverted",r(t.land.convertedLand,4)),this.updateElementText("landWaterToForest",r(t.land.transferred,4)),this.updateElementText("forestReceived",r(t.land.transferred,4)),this.updateElementText("landWaterToFarm",r(t.land.transferred,4)),this.updateElementText("farmReceived",r(t.land.transferred,4)),this.updateElementText("farmsWater",r(t.farms.water)),this.updateElementText("food",r(t.farms.food)),this.updateElementText("foodCreated",r(t.farms.foodCreated,4)),this.updateElementText("farmFoodEaten",r(t.population.foodEaten,4)),this.updateElementText("farmWaterToLake",r(t.farms.transferred,4)),this.updateElementText("lakeWaterFromFarm",r(t.farms.transferred,4)),this.updateElementText("farms",r(t.farms.farms)),this.updateElementText("efficiency",r(t.farms.efficiency*100)),this.updateElementText("farmRatioLabel",t.farms.farmRatio+"% soil to farms")}}class oe extends p{update(){if(!t)return;this.updateElementText("population",r(t.population.people)),this.updateElementText("foodEaten",r(t.population.foodEaten,4)),this.updateElementText("populationGrowth",E(t.population.popGrowth,4)),this.updateElementText("starving",r(t.population.starving,4)),this.updateElementText("scienceDelta",r(t.population.scienceDelta,4)),this.updateElementText("cashDelta",r(t.population.cashDelta,4)),this.updateElementText("scienceRatio",t.population.scienceRatio<50?100-t.population.scienceRatio+"% science":t.population.scienceRatio+"% cash"),this.updateElementText("happiness",r(t.population.happiness,4)),this.updateElementText("happinessFromHouse",r(t.population.houseBonus)),this.updateElementText("happinessFromTrees",r(t.population.happinessFromTrees,4)),this.updateElementText("happinessFromOxygen",r(t.population.happinessFromOxygen,4))}}class re extends p{update(){if(!t)return;this.updateElementText("forestWater",r(t.trees.water)),this.updateElementText("ferns",r(t.trees.ferns)),this.updateElementText("fernsDelta",r(t.trees.fernsDelta,4)),this.updateElementText("smallTrees",r(t.trees.smallTrees)),this.updateElementText("smallTreesDelta",r(t.trees.smallTreesDelta,4)),this.updateElementText("trees",r(t.trees.trees)),this.updateElementText("treesDelta",r(t.trees.treesDelta,4)),this.updateElementText("totalPlants",r(t.trees.totalPlants)),this.updateElementText("oxygenGain",r(t.trees.oxygenGain,4)),this.updateElementText("forestWaterToLake",r(t.trees.transferred,4)),this.updateElementText("lakeWaterFromForest",r(t.trees.transferred,4)),this.updateElementText("fernWater",r(t.trees.fernsWaterUse,4)),this.updateElementText("smallTreesWater",r(t.trees.smallTreesWaterUse,4)),this.updateElementText("treesWater",r(t.trees.treesWaterUse,4))}}class ne extends p{constructor(){super();if(t){t.events.on("energy:unlocked",()=>{this.checkUnlocked(),this.updateFull()}),t.events.on("energy:battery:updated",()=>this.updateFull());let e=document.getElementById("buyBattery");if(e)e.addEventListener("change",()=>this.updateFull())}}checkUnlocked(){if(!t)return;if(t.energy.unlocked){if(this.setVisible("unlockedEnergy",!0),this.setVisible("unlockEnergy",!1),this.getElement("spaceStationContainer").classList.contains("hidden"))this.getElement("spaceStationContainer").classList.remove("hidden");this.updateFull()}else if(this.setVisible("unlockedEnergy",!1),this.setVisible("unlockEnergy",!0),!this.getElement("spaceStationContainer").classList.contains("hidden"))this.getElement("spaceStationContainer").classList.add("hidden")}update(){if(!t)return;this.updateElementText("energy",r(t.power)),this.updateElementText("drain",r(t.energy.drain))}updateFull(){if(!t)return;this.updateElementText("battery",r(t.energy.battery));let e=document.getElementById("buyBattery"),s=e?Number(e.value):1;this.updateElementText("batteryCost",r(s*30000)+" oxygen and "+r(s*20000)+" science"),this.update()}}class ie extends p{constructor(){super();if(t)t.events.on("spaceStation:unlocked",()=>this.checkUnlocked()),t.events.on("spaceStation:updated",()=>this.update())}checkUnlocked(){if(!t)return;if(t.spaceStation.unlocked)this.setVisible("spaceStationContainer",!0),this.setVisible("unlockedSpaceStation",!0),this.setVisible("unlockSpaceStation",!1),this.setVisible("tractorBeamContainer",!0);else this.setVisible("spaceStationContainer",!1),this.setVisible("unlockedSpaceStation",!1),this.setVisible("unlockSpaceStation",!0),this.setVisible("tractorBeamContainer",!1)}update(){if(!t)return;let e="",s="";for(let o=0;o<t.spaceStation.orbiting.length;o++){let n=t.spaceStation.orbiting[o];if(!n)continue;if(e+=r(n.amount)+" "+n.type,s+=r(n.amount/1e4,4)+" "+n.type,o!==t.spaceStation.orbiting.length-1)e+=", ",s+=", "}this.updateElementText("orbitingResources",e),this.updateElementText("orbitSending",s)}}class ae extends p{cometRows=new Map;takeAmountRows=new Map;constructor(){super();let e=document.getElementById("allPassing");if(e)e.innerHTML="";let s=document.getElementById("takeAmountContainer");if(s)s.innerHTML="";if(t)t.events.on("tractorBeam:unlocked",()=>this.checkUnlocked()),t.events.on("tractorBeam:updated",()=>this.update()),t.events.on("tractorBeam:removeComet",(o)=>{if(b)b.removeComet(o)})}checkUnlocked(){if(!t)return;if(t.tractorBeam.unlocked)this.setVisible("unlockedTractorBeam",!0),this.setVisible("unlockTractorBeam",!1);else this.setVisible("unlockedTractorBeam",!1),this.setVisible("unlockTractorBeam",!0)}update(){if(!t||!b)return;let e=this.getElement("allPassing"),s=t.tractorBeam.comets,o=new Set(s.map((n)=>n.id));for(let[n,i]of this.cometRows.entries())if(!o.has(n))i.remove(),this.cometRows.delete(n);for(let n=0;n<s.length;n++){let i=s[n];if(!i)continue;if(!this.cometRows.has(i.id)){let a=document.createElement("div");a.className="comet-row",a.innerHTML=`<span>${i.name}</span> with <span id="comet-amount-${i.id}"></span> ${i.amountType} passing in <span id="comet-duration-${i.id}"></span>`,e.appendChild(a),this.cometRows.set(i.id,a)}this.updateElementText(`comet-amount-${i.id}`,r(i.amount)),this.updateElementText(`comet-duration-${i.id}`,r(i.duration)),b.drawComet(i)}this.updateTakeAmount()}updateTakeAmount(){if(!t)return;let e=this.getElement("takeAmountContainer"),o=t.tractorBeam.takeAmount.filter((a)=>a.amount>0),n=o.map((a)=>a.type).join(","),i=Array.from(this.takeAmountRows.keys()).join(",");if(n!==i){e.innerHTML="",this.takeAmountRows.clear();for(let a=0;a<o.length;a++){let c=o[a],m=document.createElement("span"),f=a===o.length-1;m.innerHTML=`<span id="takeAmountVal-${c.type}"></span> ${c.type}${f?"":", "}`,e.appendChild(m),this.takeAmountRows.set(c.type,m)}}for(let a of o)this.updateElementText(`takeAmountVal-${a.type}`,r(a.amount,3))}}class de extends p{constructor(){super();if(t){t.events.on("spaceDock:unlocked",()=>{this.checkUnlocked(),this.update()}),t.events.on("spaceDock:updated",()=>this.update());let e=document.getElementById("buyBattleshipAmount");if(e)e.addEventListener("change",()=>this.update())}}checkUnlocked(){if(!t)return;if(t.spaceDock.unlocked)this.setVisible("spaceDockContainer",!0),this.setVisible("hangarContainer",!0),this.setVisible("spaceCanvas",!0),this.setVisible("spaceContainer",!0),this.update();else this.setVisible("spaceDockContainer",!1),this.setVisible("hangarContainer",!1),this.setVisible("spaceCanvas",!1),this.setVisible("spaceContainer",!1)}update(){if(!t)return;this.updateElementText("battleships",r(t.spaceDock.battleships)),this.updateElementText("totalBattleships",r(t.spaceDock.battleships+t.spaceDock.sended));let e=document.getElementById("buyBattleshipAmount"),s=e?Number(e.value):1;this.updateElementText("battleshipCost",r(s*30000000)+" oxygen and "+r(s*15000000)+" science")}}class ue extends p{constructor(){super();if(t){t.events.on("hangar:updated",()=>this.updateFull());let e=document.getElementById("buyHangarAmount");if(e)e.addEventListener("change",()=>this.updateFull());let s=document.getElementById("maxMinesInput");if(s)s.addEventListener("change",()=>{if(t)t.hangar.maxMines=Math.max(1,Math.floor(Number(s.value)))})}}update(){if(!t)return;this.updateElementText("hangarSending",t.hangar.sendRate+" in "+Ie(t.hangar.timeRemaining/10)+" seconds.")}updateFull(){if(!t)return;let e=document.getElementById("buyHangarAmount"),s=e?Number(e.value):1;this.updateElementText("hangarCost",r(s*1e6));let o=document.getElementById("maxMinesInput");if(o)o.value=t.hangar.maxMines.toString();this.update()}}class me extends p{progressBar1;progressBar2;computerView;robotsView;resourceView;iceView;cloudsView;landView;populationView;treesView;energyView;spaceStationView;tractorBeamView;spaceDockView;hangarView;cometPool=[];allContainers=[];columns=[];lastVisibleCount=-1;lastWidth=-1;resizeHandler;constructor(){super();this.progressBar1=new N("nextStormProgress","#21276a"),this.progressBar2=new N("stormDurationProgress","#1c7682"),this.computerView=new Q,this.robotsView=new Z,this.resourceView=new z,this.iceView=new ee,this.cloudsView=new te,this.landView=new se,this.populationView=new oe,this.treesView=new re,this.energyView=new ne,this.spaceStationView=new ie,this.tractorBeamView=new ae,this.spaceDockView=new de,this.hangarView=new ue;let e=this.getElement("mainContainer");e.querySelectorAll(".container").forEach((o)=>e.appendChild(o)),e.querySelectorAll(".column").forEach((o)=>o.remove()),this.allContainers=Array.from(e.querySelectorAll(".container"));let s=this.getElement("cometsContainer");if(s)s.innerHTML="";if(this.resizeHandler=()=>this.refreshLayout(),window.addEventListener("resize",this.resizeHandler),t)t.events.on("tick",()=>{if(!document.hidden)this.update()}),t.events.on("computer:unlocked",()=>this.refreshLayout()),t.events.on("robots:unlocked",()=>this.refreshLayout()),t.events.on("energy:unlocked",()=>this.refreshLayout()),t.events.on("spaceStation:unlocked",()=>this.refreshLayout()),t.events.on("tractorBeam:unlocked",()=>this.refreshLayout()),t.events.on("spaceDock:unlocked",()=>this.refreshLayout())}destroy(){window.removeEventListener("resize",this.resizeHandler)}update(){if(!t)return;this.resourceView.update(),this.iceView.update(),this.cloudsView.update(),this.landView.update(),this.treesView.update(),this.populationView.update(),this.updateComputerRowProgress(),this.robotsView.update(),this.updateRobotsRowProgress(),this.energyView.update(),this.spaceStationView.update(),this.tractorBeamView.update(),this.hangarView.update(),this.progressBar1.tick(t.clouds.initialStormTimer-t.clouds.stormTimer,t.clouds.initialStormTimer),this.progressBar2.tick(t.clouds.stormDuration,t.clouds.initialStormDuration),we()}refreshLayout(){let e=this.getElement("mainContainer");if(e.offsetWidth===0)return;let s=window.getComputedStyle(e),o=parseFloat(s.columnGap||s.gap||"0"),n=280,i=e.querySelector(".column");if(i)n=parseFloat(window.getComputedStyle(i).minWidth);else{let l=document.createElement("div");l.className="column",l.style.visibility="hidden",l.style.position="absolute",e.appendChild(l),n=parseFloat(window.getComputedStyle(l).minWidth),e.removeChild(l)}n=Math.max(200,n||0);let a=n+o,c=e.offsetWidth,m=Math.max(1,Math.floor((c+o)/a)),f=this.allContainers.filter((l)=>!l.classList.contains("hidden")),y=f.length;if(this.columns.length===m&&y===this.lastVisibleCount&&c===this.lastWidth)return;f.sort((l,w)=>w.offsetHeight-l.offsetHeight);for(let l of this.allContainers)e.appendChild(l);if(this.columns.length!==m){this.columns.forEach((l)=>l.remove()),this.columns=[];for(let l=0;l<m;l++){let w=document.createElement("div");w.className="column",e.appendChild(w),this.columns.push(w)}}if(this.lastVisibleCount=y,this.lastWidth=c,this.columns.length===0)return;for(let l=0;l<f.length;l++){let w=f[l],C=this.columns[0];if(l<this.columns.length)C=this.columns[l];else{let x=C.offsetHeight;for(let k=1;k<this.columns.length;k++){let v=this.columns[k];if(v.offsetHeight<x)C=v,x=v.offsetHeight}}C.appendChild(w)}}clearComputerRows(){this.getElement("computerRows").innerHTML="",this.computerView.clearCache()}clearRobotRows(){this.getElement("robotRows").innerHTML="",this.robotsView.clearCache()}updateComputerRowProgress(){if(!t||!t.computer.unlocked)return;for(let e=0;e<t.computer.processes.length;e++)this.computerView.updateRowProgress(e)}updateRobotsRowProgress(){if(!t)return;for(let e=0;e<t.robots.jobs.length;e++)this.robotsView.updateRowProgress(e)}drawComet(e){let s,o="comet"+e.id;if(!e.drawed){if(s=this.cometPool.pop()||document.createElement("div"),s.className=e.name.toLowerCase(),s.id=o,s.classList.remove("hidden"),e.startingY===void 0){let n=D(e.speed,e.initialDuration,Math.random());e.startingY=n.startingY,e.endingX=n.endingX,e.slope=n.slope}this.getElement("cometsContainer").appendChild(s),e.drawed=!0}else s=document.getElementById(o);if(s){e.left=(e.initialDuration-e.duration)/e.initialDuration*e.endingX,e.top=e.slope*e.left+e.startingY;let n=e.amountType==="ice"?e.amount/1000:e.amount,a=(e.name==="Comet"?40:20)*Math.sqrt(n/200);s.style.width=Math.round(a)+"px",s.style.height=Math.round(a)+"px",s.style.borderRadius=Math.round(a/2)+"px",s.style.left=Math.round(e.left-a/2)+"px",s.style.top=Math.round(e.top-a/2)+"px"}}removeComet(e){let s="comet"+e.id,o=document.getElementById(s);if(o)o.classList.add("hidden"),o.id="",this.cometPool.push(o);else console.log(s+"not found")}}var Ae=()=>{let e=(i,a)=>{let c=document.getElementById(i);if(c)c.addEventListener("click",a)};e("btnHardReset",Oe),e("btnPause",ke),e("btnBeg",Ve),e("btnSave",le),e("btnExport",He),e("btnImport",We),e("btnBuyIce",()=>t?.buyIce()),e("unlockComputer",()=>t?.computer.unlockComputer()),e("buyThread",()=>t?.computer.buyThread()),e("buySpeed",()=>t?.computer.buySpeed()),e("unlockRobots",()=>t?.robots.unlockRobots()),e("unlockEnergy",()=>t?.energy.unlockEnergy()),e("btnBuyBattery",()=>t?.buyBattery()),e("unlockSpaceStation",()=>t?.spaceStation.unlockSpaceStation()),e("unlockTractorBeam",()=>t?.tractorBeam.unlockTractorBeam()),e("btnBuyBattleship",()=>t?.buyBattleship()),e("btnBuyHangar",()=>t?.buyHangar()),document.getElementById("mainContainer")?.addEventListener("contextmenu",(i)=>i.preventDefault()),document.getElementById("scienceSlider")?.addEventListener("input",function(){if(t)t.population.scienceRatio=Number(this.value)}),document.getElementById("farmSlider")?.addEventListener("input",function(){if(t)t.farms.farmRatio=Number(this.value)}),document.querySelectorAll(".numeric-input-small").forEach((i)=>{i.addEventListener("change",function(){let a=Number(this.value);if(isNaN(a)||a<1)this.value="1";else if(a!==Math.floor(a))this.value=Math.floor(a).toString()})})};if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",Ae);else Ae();var ce=[];function Qe(){if(ce.length===0)return;let e=ce[0]?.key;if(ce.splice(0,1),e===66)t?.buyIce()}document.addEventListener("keydown",function(e){let s={key:e.charCode!==0?e.charCode:e.keyCode,shift:e.shiftKey};ce.push(s),Qe()});class he{events=new Map;on(e,s){if(!this.events.has(e))this.events.set(e,[]);this.events.get(e)?.push(s)}off(e,s){let o=this.events.get(e);if(o)this.events.set(e,o.filter((n)=>n!==s))}emit(e,...s){let o=this.events.get(e);if(o)o.forEach((n)=>n(...s))}}var t=null,b=null,Ue=0,Ee=!1,_e=0;function Ze(){Ue++}function ze(){Ee=!Ee}function Me(){return _e++,_e}class Ge{totalLand;cash;oxygen;science;wood;metal;ore;power;oxygenLeak=0;canvasWidth=1200;canvasHeight=600;space;ice;water;clouds;land;trees;farms;population;computer;robots;energy;spaceStation;tractorBeam;spaceDock;hangar;events;constructor(){this.totalLand=1000,this.cash=100,this.oxygen=0,this.science=0,this.wood=0,this.metal=0,this.ore=0,this.power=0,this.canvasWidth=1200,this.canvasHeight=600,this.events=new he}tick(){this.water.waterSpending=0,this.water.gain=0,this.ice.tick(),this.robots.tick(),this.computer.tick(),this.land.soil-=this.farms.updateFarms(this.land.soil),this.farms.tick(this.land.transferWater()),this.population.tick(),this.water.outdoor+=this.farms.transferWater(),this.trees.tick(this.land.transferWater()),this.water.outdoor+=this.trees.transferWater(),this.land.tick(this.clouds.transferWater()),this.clouds.tick(this.water.transferWater()),this.energy.tick(),this.water.tick(this.ice.transferWater()),this.tractorBeam.tick(),this.spaceStation.tick(),this.space.tick(),this.oxygenLeak=this.oxygen/1e5,this.oxygen-=this.oxygenLeak,this.hangar.tick(),this.events.emit("tick")}initialize(){this.space=new A,this.ice=new O,this.water=new H,this.clouds=new W,this.land=new V(this.totalLand),this.trees=new _,this.farms=new U,this.population=new G,this.computer=new $,this.robots=new P,this.energy=new X,this.spaceStation=new j,this.tractorBeam=new K,this.spaceDock=new Y,this.hangar=new q,b?.clearComputerRows();for(let e=0;e<this.computer.processes.length;e++){b?.computerView.addComputerRow(e);let s=this.computer.processes[e];if(s)s.isMoving=!1,s.completions=0}b?.clearRobotRows();for(let e=0;e<this.robots.jobs.length;e++){b?.robotsView.addRobotRow(e);let s=this.robots.jobs[e];if(s)s.completions=0}}buyIce(){let e=this.cash;if(e<=0)return;this.cash-=this.ice.buyIce(e)}buyBattery(){let e=document.getElementById("buyBattery"),s=Number(e.value);if(s*30000>this.oxygen)s=Math.floor(this.oxygen/30000);if(s*20000>this.science)s=Math.floor(this.science/20000);if(s<=0)return;this.oxygen-=s*30000,this.science-=s*20000,this.energy.buyBattery(s)}buyBattleship(){let e=document.getElementById("buyBattleshipAmount"),s=Number(e.value);if(s*30000000>this.oxygen)s=Math.floor(this.oxygen/30000000);if(s*15000000>this.science)s=Math.floor(this.science/15000000);if(s<=0)return;this.oxygen-=30000000*s,this.science-=15000000*s,this.spaceDock.addBattleship(s)}buyHangar(){let s=document.getElementById("buyHangarAmount"),o=Number(s.value);if(o*1e6>this.metal)o=Math.floor(this.metal/1e6);if(o<=0)return;this.metal-=o*1e6,this.hangar.sendRate+=o,this.events.emit("hangar:updated")}}function et(){if(Ee)return;if(Ze(),t?.tick(),Ue%100===0)le()}function tt(e){xe.postMessage({stop:!0}),xe.postMessage({start:!0,ms:1000/e})}function ke(){ze()}var xe=new Worker(new URL("./workers/interval.js",import.meta.url).href);xe.onmessage=function(e){if(e.data==="interval.start")et()};async function Oe(){window.localStorage.terrafold2="",await Ce()}function st(){if(b)b.destroy();t=new Ge,b=new me,t?.initialize(),window.game=t,window.view=b}function ot(){if(!b)return;b.hangarView.updateFull(),b.spaceDockView.checkUnlocked(),b.tractorBeamView.checkUnlocked(),b.spaceStationView.checkUnlocked(),b.energyView.checkUnlocked(),b.computerView.checkUnlocked(),b.robotsView.checkUnlocked(),b.update()}async function Ce(){if(st(),window.localStorage.terrafold2){let e=await ge(window.localStorage.terrafold2),s=JSON.parse(e);if(t)ve(s,t);let o=document.getElementById("scienceSlider");if(o&&t)o.value=t.population.scienceRatio.toString();let n=document.getElementById("farmSlider");if(n&&t)n.value=t.farms.farmRatio.toString()}ot(),b?.refreshLayout(),tt(10)}var rt=["text","tooltip","events","canvasWidth","canvasHeight","drawed","isMoving","transferred","foodCreated","convertedLand","takeAmount","foodEaten","popGrowth","starving","scienceDelta","cashDelta","happinessFromTrees","happinessFromOxygen","happiness","fernsDelta","fernsWaterUse","smallTreesDelta","smallTreesWaterUse","treesDelta","treesWaterUse","totalPlants","oxygenGain","woodIncome","woodSpending","metalIncome","metalSpending","oreIncome","oreSpending","oreToDirtSpending","oxygenSpending","waterIncome","waterSpending","cashSpending","scienceSpending","waterFarms","waterTrees","buyIncome"];function ve(e,s){for(let o in e)if(Object.prototype.hasOwnProperty.call(e,o)&&!rt.includes(o)){if(typeof e[o]==="object"&&e[o]!==null){if(typeof s[o]>"u")s[o]=Array.isArray(e[o])?[]:{};ve(e[o],s[o])}else if(typeof e[o]!=="function")s[o]=e[o]}}async function le(){let e={};if(t)ve(t,e);window.localStorage.terrafold2=await be(JSON.stringify(e))}async function He(){await le();let e=document.getElementById("exportImportSave");if(e)e.value=await be(window.localStorage.terrafold2||""),e.select(),document.execCommand("copy"),e.value=""}async function We(){let e=document.getElementById("exportImportSave");if(e)window.localStorage.terrafold2=await ge(e.value),await Ce()}function Ve(){if(t)t.cash+=0.1}Ce();window.game=t;window.view=b;window.pauseGame=ke;export{b as view,le as save,ke as pauseGame,Me as incrementCometId,We as importSave,t as game,He as exportSave,Oe as clearSave,Ve as begForMoney};

//# debugId=85830CD586A6EEE664756E2164756E21
//# sourceMappingURL=main.js.map
