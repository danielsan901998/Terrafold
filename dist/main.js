function S(t){let s=1;if(t.ctrlKey)s*=5;if(t.shiftKey)s*=10;return s}function St(t){return Math.floor(t*10)/10}function vt(t){return Math.floor(t*100)/100}function ft(t){return Number(t.toPrecision(2))}function v(t){return Number(t.toPrecision(3))}function w(t,s,i,r,n){return B(t,s,i,r)<n}function B(t,s,i,r){return Math.sqrt(Math.pow(Math.abs(t-i),2)+Math.pow(Math.abs(s-r),2))}function wt(t,s){let i=1;if(t<0)i=-1,t*=-1;if(t>=1e4)return(i===1?"+":"-")+Lt(t,3);else{let r=3;if(s!==void 0)r=s;return(i===1?"+":"-")+t.toFixed(r-1)}}function o(t,s){if(t>=1e4)return Lt(t,3);else{let i=3;if(s!==void 0)i=s;return t.toFixed(i-1)}}var kt=[{value:1000000000000000000000000000000000000000000000000000000000000000,symbol:"V"},{value:1000000000000000000000000000000000000000000000000000000000000,symbol:"Nd"},{value:1000000000000000000000000000000000000000000000000000000000,symbol:"Od"},{value:1000000000000000000000000000000000000000000000000000000,symbol:"Sd"},{value:1000000000000000000000000000000000000000000000000000,symbol:"sd"},{value:1000000000000000000000000000000000000000000000000,symbol:"Qd"},{value:1000000000000000000000000000000000000000000000,symbol:"qd"},{value:1000000000000000000000000000000000000000000,symbol:"Td"},{value:1000000000000000000000000000000000000000,symbol:"Dd"},{value:1000000000000000000000000000000000000,symbol:"Ud"},{value:1000000000000000000000000000000000,symbol:"Dc"},{value:1000000000000000000000000000000,symbol:"N"},{value:1000000000000000000000000000,symbol:"O"},{value:1000000000000000000000000,symbol:"Sp"},{value:1000000000000000000000,symbol:"Sx"},{value:1000000000000000000,symbol:"Qi"},{value:1000000000000000,symbol:"Qa"},{value:1000000000000,symbol:"T"},{value:1e9,symbol:"B"},{value:1e6,symbol:"M"},{value:1000,symbol:"K"}],Ct=/\.0+$|(\.[0-9]*[1-9])0+$/,L=new Map;function Lt(t,s){let i=t+"|"+s,r=L.get(i);if(r!==void 0)return r;let n,a=!1;for(let l=0;l<kt.length;l++){let m=kt[l];if(m&&t>=m.value/1.000501){n=(t/m.value).toPrecision(s).replace(Ct,"$1")+m.symbol,a=!0;break}}if(!a)n=t.toPrecision(s).replace(Ct,"$1");if(L.size>1000){let l=L.keys().next().value;if(l!==void 0)L.delete(l)}return L.set(i,n),n}function Bt(t,s){t.sort((i,r)=>i[s]-r[s])}async function mt(t){let s=new Blob([t]).stream().pipeThrough(new CompressionStream("gzip")),r=await new Response(s).arrayBuffer(),n=new Uint8Array(r),a="";for(let l=0;l<n.byteLength;l++)a+=String.fromCharCode(n[l]);return btoa(a)}async function pt(t){if(!t)return"";let s=t.trim();if(s.startsWith("{")&&s.endsWith("}"))return s;try{let i=atob(t),r=Uint8Array.from(i,(a)=>a.codePointAt(0)),n=new Blob([r]).stream().pipeThrough(new DecompressionStream("gzip"));return new Response(n).text()}catch(i){return t}}var b=document.getElementById("spaceCanvas"),c=b?b.getContext("2d"):null;if(c)c.font="11px Arial";var R=200,bt={x:0,y:0};function Rt(){if(!b)return;if(b.width!==1000||b.height!==500){if(b.width=1000,b.height=500,R=b.width/5,c)c.font="11px Arial"}}if(b)window.addEventListener("resize",Rt),Rt(),b.addEventListener("mousemove",function(t){bt={x:t.offsetX-R,y:t.offsetY}});function xt(){if(!c||!e||!b)return;c.clearRect(0,0,b.width,b.height),Jt(),jt(),Xt(),qt()}function qt(){if(!e)return;for(let t=0;t<e.space.planets.length;t++)Yt(e.space.planets[t])}function Xt(){if(!e)return;for(let t=0;t<e.space.ships.length;t++)_t(e.space.ships[t])}function jt(){if(!e)return;for(let t=0;t<e.space.planets.length;t++){let s=e.space.planets[t];zt(s,s.isBoss?"B":(t+1).toString())}}function Jt(){if(!c||!b)return;c.fillStyle="yellow",c.fillRect(b.width*0.1,b.height*0.8,b.width*0.8,1)}function _t(t){if(!c)return;let s=t.x+R;c.save(),c.translate(s+25,t.y+25),c.rotate(t.direction);let i={x:-10,y:-10},r={x:10,y:0},n={x:-10,y:10},a={x:-7,y:0};c.beginPath(),c.fillStyle="#008080",c.lineWidth=3,c.moveTo(i.x,i.y),c.lineTo(r.x,r.y),c.lineTo(n.x,n.y),c.lineTo(a.x,a.y),c.fill(),c.restore(),c.save(),c.translate(s+25,t.y+25),c.strokeStyle="white",c.lineWidth=1,c.strokeText(t.amount.toString(),-4,20),c.strokeText(o(t.foodAmount/t.amount/10,1),-4,30),c.restore()}function zt(t,s){if(!c)return;let i=Vt(t.isBoss),r=t.x+R;c.save(),c.translate(r+i,t.y+i),Qt(t,i),Zt(t,i),Gt(t,i),c.strokeStyle="white",c.lineWidth=1,c.strokeText(s,-3,4),c.restore()}function Yt(t){if(!c)return;let s=Vt(t.isBoss),i=t.x+R;if(t.showTooltip=w(bt.x,bt.y,t.x+s,t.y+s,50),!t.showTooltip)return;c.save(),c.translate(i+s,t.y+s),c.fillStyle="#ffffff",c.fillText("Atmosphere: "+o(t.atmo,2),-15,s),c.fillText("Reduction: "+o(d.getShieldReduction(t)*100,1)+"%",-15,s+10),c.fillText("Health: "+o(t.health,1),-15,s+20),c.fillText("Dirt: "+o(t.dirt,1),-15,s+30),c.fillText("Ore: "+o(t.ore,1),-15,s+40),c.fillText("C.Bots: "+t.bots+" / "+t.maxMines,-15,s+50),c.fillText("Solar: "+t.solar,-15,s+60),c.fillText("Build Factory: "+t.factoryTicks+" / "+t.factoryTicksMax,-15,s+70),c.fillText("Build Coilgun: "+t.coilgunTicks+" / "+t.coilgunTicksMax,-15,s+80),c.fillText("Coilgun Charge: "+o(t.coilgunCharge,1)+" / "+t.coilgunChargeMax,-15,s+90),c.fillText("Build Solar: "+o(t.solarTicks,1)+" / "+t.solarTicksMax,-15,s+100),c.fillText("Mines: "+t.mines+" / "+t.maxMines,-15,s+110),c.fillText("Build Mine: "+t.mineTicks+" / "+t.mineTicksMax,-15,s+120),c.restore()}function Qt(t,s){if(!c)return;let i=s*(t.atmo/t.maxAtmo/2+0.5),r=c.createRadialGradient(0,0,i*1.1,0,0,i/3.3);r.addColorStop(0,"black");let n="hsl("+(t.view.color+120)+",90%,60%)";r.addColorStop(1,n),c.fillStyle=r,c.fillRect(-s,-s,s*2,s*2),c.beginPath(),c.strokeStyle="#008080",c.lineWidth=3,c.arc(0,0,s-4,0,2*Math.PI*(t.atmo/t.maxAtmo)),c.stroke()}function Zt(t,s){if(!c)return;c.beginPath();let i=Math.floor(t.health/t.maxHealth*70+10);c.fillStyle="hsl("+t.view.color+","+i+"%,"+t.view.light+"%)",c.arc(0,0,s/2,0,2*Math.PI),c.fill(),c.beginPath(),c.strokeStyle="#b6000b",c.lineWidth=3,c.moveTo(-s*2/3,-s),c.lineTo(-s*2/3+s*4/3*(t.health/t.maxHealth),-s),c.stroke()}function Gt(t,s){if(!c)return;c.rotate(t.view.rotation),c.rotate(-1*t.view.rotation)}function It(t){if(t.view.rotation+=t.view.rotationSpeed/10+0.01,t.view.rotation>=Math.PI*2)t.view.rotation-=Math.PI*2}function Vt(t){return t?40:25}class d{static findArea(t){if(!e)return;for(let s=0;s<e.space.planets.length;s++){if(e.space.planets[s]===t)continue;let r=0;while(d.isWithinDistanceOfAny(t,t.x,t.y,75)){if(r++,r>40){console.log("too many planets");return}t.x=d.xAreaAllowed(),t.y=d.yAreaAllowed()}}}static xAreaAllowed(){return Math.random()*620}static yAreaAllowed(){return Math.random()*330+5}static isWithinDistanceOfAny(t,s,i,r){if(!e)return!1;for(let n=0;n<e.space.planets.length;n++){let a=e.space.planets[n];if(a===t)continue;if(w(s,i,a.x,a.y,r))return!0}return!1}static tick(t){d.regenShields(t),d.tickResources(t),It(t)}static empty(t){return t.dirt<=0}static alive(t){return t.health>0}static regenShields(t){if(!d.alive(t)){t.atmo=0;return}if(t.atmo+=(t.maxAtmo-t.atmo)/100,t.atmo>t.maxAtmo)t.atmo=t.maxAtmo}static getShieldReduction(t){return t.atmo/t.maxAtmo}static takeDamage(t,s){let i=s*(1-d.getShieldReduction(t));t.atmo-=s*d.getShieldReduction(t);let r=0;if(t.atmo<0)r=t.atmo*-1,t.atmo=0;if(t.health-=i+r,t.health<0)t.health=0}static calcPower(t,s){t.power=s*(t.isBoss?1.5:1),t.atmo=t.maxAtmo=Math.min(200,v(t.power*2+100)),t.health=t.maxHealth=v(t.power*20+1000),t.dirt=v(t.power*200+2000),t.mineTicksMax=2000,t.factoryTicksMax=8000,t.maxMines=Math.floor((t.dirt+0.1)/1000),t.solarTicksMax=1000,t.coilgunTicksMax=1000}static workConstruction(t,s){if(!d.doneFactory(t)){d.workOnFactory(t,s);return}if(!d.doneCoilgun(t)){d.workOnCoilgun(t,s);return}d.workOnMine(t,s)}static tickResources(t){if(d.empty(t))return;d.tickMines(t),d.tickBots(t),d.tickFactory(t),d.tickSolar(t),d.tickCoilgun(t)}static doneBuilding(t){return t.mines>=t.maxMines}static workOnMine(t,s){if(t.mineTicks+=s,t.mineTicks>=t.mineTicksMax){let i=Math.floor(t.mineTicks/t.mineTicksMax);i=Math.min(i,t.maxMines-t.mines),t.mines+=i,t.mineTicks-=i*t.mineTicksMax}}static tickMines(t){t.ore+=t.mines}static tickBots(t){let s=t.bots;t.ore-=s,d.workOnSolar(t,s)}static doneFactory(t){return t.factoryTicks>=t.factoryTicksMax}static workOnFactory(t,s){t.factoryTicks+=s}static tickFactory(t){if(t.ore>=200){let s=Math.floor(t.ore/200);t.bots+=s,t.ore-=s*200}}static workOnSolar(t,s){if(t.solarTicks+=s,t.solarTicks>=t.solarTicksMax){let i=Math.floor(t.solarTicks/t.solarTicksMax);t.solar+=i,t.solarTicks-=i*t.solarTicksMax}}static tickSolar(t){t.coilgunCharge+=t.solar}static doneCoilgun(t){return t.coilgunTicks>=t.coilgunTicksMax}static workOnCoilgun(t,s){t.coilgunTicks+=s}static tickCoilgun(t){if(t.coilgunCharge>=t.coilgunChargeMax){let s=Math.floor(t.coilgunCharge/t.coilgunChargeMax);t.coilgunCharge-=s*t.coilgunChargeMax;let i=500*s;if(t.dirt<=i)i=t.dirt;if(t.dirt-=i,e&&e.spaceStation.orbiting[1])e.spaceStation.orbiting[1].amount+=i}}}class p{static foodPerShip=20;static tick(t){p.checkEmpty(t),p.moveToNearestTarget(t),p.checkJoinFleet(t),p.attackTarget(t)}static checkJoinFleet(t){if(!e||!t.engaged)return;for(let s=e.space.ships.length-1;s>=0;s--){let i=e.space.ships[s];if(i===t||p.isEmpty(i))continue;if(w(t.x,t.y,i.x,i.y,20))p.combineShips(t,i),e.space.ships.splice(s,1)}}static findClosestTarget(t){if(!e)return null;let s=0,i=null;for(let r=0;r<e.space.planets.length;r++){let n=e.space.planets[r];if(d.doneBuilding(n))continue;if(!i){i=n;continue}if(B(t.x,t.y,n.x,n.y)<B(t.x,t.y,i.x,i.y))s=r,i=e.space.planets[s]}return i?i:p.targetHome(t)}static checkEmpty(t){if(t.foodAmount-=t.amount,!p.isEmpty(t))return;t.foodAmount=0,t.speed=0.05,t.target=p.targetHome(t),t.engaged=!1}static targetHome(t){return e?.hangar.getTarget()}static returnHome(t){if(!e)return;e.spaceDock.battleships+=t.amount,e.spaceDock.sended-=t.amount,e.farms.food+=t.foodAmount*p.foodPerShip;for(let s=e.space.ships.length-1;s>=0;s--)if(e.space.ships[s]===t){e.space.ships.splice(s,1);break}}static isEmpty(t){return t.foodAmount<=0}static moveToNearestTarget(t){if(!t.target||!t.target.isHome&&d.doneBuilding(t.target))t.target=p.findClosestTarget(t),t.engaged=!1;if(B(t.x,t.y,t.target.x,t.target.y)<40){if(!t.target.isHome){t.engaged=!0;return}p.returnHome(t)}let s=t.speed,i=0,r=t.target.y-t.y,n=t.target.x-t.x;if(r>=0&&n<0||r<0&&n<0)i=Math.PI;let a=Math.atan(r/n)+i;t.x=t.x+s*Math.cos(a),t.y=t.y+s*Math.sin(a),t.direction=a}static attackTarget(t){if(t.target&&!t.target.isHome&&t.engaged){if(t.actionCounter++,t.actionCounter>=t.actionSpeed){if(t.actionCounter=0,d.alive(t.target))d.takeDamage(t.target,t.actionRate*t.amount);else if(d.workConstruction(t.target,t.amount),d.doneBuilding(t.target))t.engaged=!1,t.target=p.findClosestTarget(t)}}}static combineShips(t,s){if(t.amount+=s.amount,t.energy+=s.energy,t.foodAmount+=s.foodAmount,s.actionCounter>t.actionCounter)t.actionCounter=s.actionCounter}}class V{isBoss;view;x;y;mines;mineTicks;ore;bots;factoryTicks;solarTicks;solar;energy;coilgunTicks;coilgunCharge;coilgunChargeMax;id;power;initialPower;shield;initialShield;atmosphere;initialAtmosphere;constructor(){this.isBoss=0,this.view={rotation:0,rotationSpeed:Math.random(),color:Math.floor(Math.random()*360),light:Math.floor(Math.random()*15+40)},this.x=d.xAreaAllowed(),this.y=d.yAreaAllowed(),d.findArea(this),this.mines=0,this.mineTicks=0,this.ore=0,this.bots=0,this.factoryTicks=0,this.solarTicks=0,this.solar=0,this.energy=0,this.coilgunTicks=0,this.coilgunCharge=0,this.coilgunChargeMax=1000}}class H{planets;ships;sector;constructor(){this.planets=[],this.ships=[],this.sector=0}tick(){let t=!0;for(let s=0;s<this.planets.length;s++){let i=this.planets[s];if(d.tick(i),d.empty(i)===!1)t=!1}if(t&&this.ships.length===0)this.planets=[],this.sector++,this.newLevel();for(let s=0;s<this.ships.length;s++)p.tick(this.ships[s])}spawnShip(t,s){t.x=-120,t.y=s,this.ships.push(t)}newLevel(){for(let s=0;s<10;s++){let i=new V;this.planets.push(i)}Bt(this.planets,"x");let t=this.planets[this.planets.length-1];if(t)t.isBoss=!0;for(let s=0;s<this.planets.length;s++)d.calcPower(this.planets[s],this.sector)}}class M{ice;buyable;gain;max;transferred;constructor(){this.ice=0,this.buyable=1000,this.gain=10,this.max=1000,this.transferred=0}tick(){if(this.buyable+=this.gain,this.buyable>this.max)this.buyable=this.max}transferWater(){return this.transferred=this.ice/1000,this.ice-=this.transferred,this.transferred}buyIce(t){if(this.buyable<t)t=this.buyable;return this.buyable-=t,this.ice+=t,t}findIceSeller(t){this.max+=t*200,this.gain+=t}}class N{indoor;outdoor;maxIndoor;selling;excess;gain;transferred=0;constructor(){this.indoor=0,this.outdoor=0,this.maxIndoor=50,this.selling=0,this.excess=0,this.gain=0}tick(t){if(this.indoor+=t,this.excess=this.indoor-this.maxIndoor,this.excess>0)this.indoor=this.maxIndoor,this.outdoor+=this.excess;else this.excess=0;if(this.selling=this.indoor/100,this.indoor-=this.selling,this.gain=this.selling*2,e)e.cash+=this.gain}transferWater(){return this.transferred=this.outdoor/1000,this.outdoor-=this.transferred,this.transferred}sellWater(t){if(this.indoor<t)t=this.indoor;if(this.indoor-=t,e)e.cash+=this.getPrice(t)}getPrice(t){return t*2}}class W{water;initialStormTimer;stormTimer;stormRate;storming;initialStormDuration;stormDuration;transferred;lightningChance;lightningStrength;constructor(){this.water=0,this.initialStormTimer=300,this.stormTimer=300,this.stormRate=0,this.storming=0,this.initialStormDuration=60,this.stormDuration=60,this.transferred=0,this.lightningChance=0,this.lightningStrength=0}tick(t){this.water+=t,this.nextStormTimer(),this.tickLightning()}tickLightning(){if(this.lightningChance+=0.01*this.stormRate/100,this.lightningStrength=this.water*0.01,this.stormRate===100&&this.lightningChance>Math.random()*100){if(this.lightningChance=0,e)e.energy.gainEnergy(this.lightningStrength)}}transferWater(){return this.transferred=this.water/500*this.stormRate/100,this.water-=this.transferred,this.transferred}nextStormTimer(){if(this.stormTimer>0)this.stormTimer--;else if(this.stormDuration>0)this.storming=1;if(this.stormRate>=100)if(this.storming=0,this.stormDuration>0)this.storming=0,this.stormDuration--;else this.storming=-1;else if(this.stormRate<=0&&this.storming===-1)this.stormDuration=this.initialStormDuration,this.stormTimer=this.initialStormTimer,this.storming=0;this.stormRate+=this.storming}gainStormDuration(t){this.stormDuration+=t,this.initialStormDuration+=t}}class F{land;baseLand;optimizedLand;water;soil;transferred;convertedLand=0;constructor(t){this.land=t,this.baseLand=t,this.optimizedLand=t,this.water=0,this.soil=0,this.transferred=0}tick(t){this.water+=t,this.turnLandToSoil()}turnLandToSoil(){if(this.convertedLand=this.water/1000,this.land<this.convertedLand)this.convertedLand=this.land;this.land-=this.convertedLand,this.soil+=this.convertedLand,this.water-=this.convertedLand}transferWater(){return this.transferred=this.water/1000,this.water-=this.transferred,this.transferred}improveLand(){let t=(10*this.baseLand-this.optimizedLand)/100;this.optimizedLand+=t,this.land+=t}addLand(t){this.optimizedLand+=t,this.land+=t,this.baseLand+=t}}class O{water;ferns;fernsDelta;fernsWaterUse;smallTrees;smallTreesDelta;smallTreesWaterUse;trees;treesDelta;treesWaterUse;totalPlants;oxygenGain;transferred=0;constructor(){this.water=0,this.ferns=0,this.fernsDelta=0,this.fernsWaterUse=0,this.smallTrees=0,this.smallTreesDelta=0,this.smallTreesWaterUse=0,this.trees=0,this.treesDelta=0,this.treesWaterUse=0,this.totalPlants=0,this.oxygenGain=0}tick(t){if(this.water+=t,this.plantGrowth(),this.oxygenGain=this.ferns/1000+3*this.smallTrees/1000+this.trees/100,e)e.oxygen+=this.oxygenGain}plantGrowth(){if(!e)return;if(this.totalPlants=this.ferns+this.smallTrees+this.trees,this.treesDelta=this.smallTrees/1000,this.smallTreesDelta=this.ferns/1000-this.treesDelta,this.fernsDelta=(e.land.soil-this.totalPlants)/1000-this.ferns/1000,this.fernsWaterUse=(e.land.soil-this.totalPlants)/1000,this.fernsWaterUse=this.fernsWaterUse<0?0:this.fernsWaterUse,this.smallTreesWaterUse=this.ferns/1000,this.treesWaterUse=this.smallTrees/1000,this.fernsDelta<0){let t=0;if(this.ferns+this.fernsDelta<0)t=this.fernsDelta+this.ferns,this.fernsDelta=-1*this.ferns;if(this.smallTreesDelta+=t,t=0,this.smallTrees+this.smallTreesDelta<0)t=this.smallTrees+this.smallTreesDelta,this.smallTreesDelta=-1*this.smallTrees;this.treesDelta+=t}if(this.water<this.treesWaterUse)this.treesDelta=this.treesDelta>0?this.water:this.treesDelta,this.treesWaterUse=this.water;if(this.trees+=this.treesDelta,this.water-=this.treesWaterUse,this.water<this.smallTreesWaterUse)this.smallTreesDelta=this.smallTreesDelta>0?this.water:this.smallTreesDelta,this.smallTreesWaterUse=this.water;if(this.smallTrees+=this.smallTreesDelta,this.water-=this.smallTreesWaterUse,this.water<this.fernsWaterUse)this.fernsDelta=this.fernsDelta>0?this.water:this.fernsDelta,this.fernsWaterUse=this.water;this.ferns+=this.fernsDelta,this.water-=this.fernsWaterUse}transferWater(){return this.transferred=this.water/1000,this.water-=this.transferred,this.transferred}}class U{water;farms;food;foodCreated;efficiency;transferred=0;constructor(){this.water=0,this.farms=0,this.food=0,this.foodCreated=0,this.efficiency=1}tick(t){this.water+=t,this.gainFood()}transferWater(){return this.transferred=this.water/1000,this.water-=this.transferred,this.transferred}gainFood(){if(this.foodCreated=this.farms/100*this.efficiency,this.foodCreated>this.water)this.foodCreated=this.water;this.water-=this.foodCreated,this.food+=this.foodCreated}addFarm(t){this.farms+=t}improve(){this.efficiency+=0.02}}class A{people;foodEaten;popGrowth;starving;scienceRatio;scienceDelta;cashDelta;happiness;houseBonus;happinessFromTrees=0;happinessFromOxygen=0;constructor(){this.people=0,this.foodEaten=0,this.popGrowth=0,this.starving=0,this.scienceRatio=0,this.scienceDelta=0,this.cashDelta=0,this.happiness=1,this.houseBonus=1}tick(){if(!e)return;if(this.foodEaten=this.people/100,this.foodEaten>e.farms.food)this.starving=this.foodEaten-e.farms.food,this.foodEaten=e.farms.food;else this.starving=0;e.farms.food-=this.foodEaten,this.popGrowth=(e.farms.food-this.people)/1000-this.starving/100,this.people+=this.popGrowth,this.updateHappiness(),this.tickRatio()}updateHappiness(){if(!e)return;this.happinessFromTrees=Math.log10(e.trees.trees+1)/10,this.happinessFromOxygen=Math.log10(e.oxygen+1)/20,this.happiness=this.houseBonus*(1+this.happinessFromTrees+this.happinessFromOxygen)}tickRatio(){if(!e)return;this.scienceDelta=this.people/100*(100-this.scienceRatio)/100*this.happiness,this.cashDelta=this.people/100*this.scienceRatio/100*this.happiness,e.science+=this.scienceDelta,e.cash+=this.cashDelta}improveHouse(){this.houseBonus+=0.1}}class ${unlocked;threads;freeThreads;speed;processes;constructor(){this.unlocked=0,this.threads=1,this.freeThreads=1,this.speed=1,this.processes=[{text:"Optimize Land",tooltip:"Improve 1% of unimproved land.<br>Max to improve to is ( 10 x base land )<br>Percent Optimized: <div id='landOptimized'></div>",currentTicks:0,ticksNeeded:600,threads:0,cost:0,costType:"",finish:function(){if(e)e.land.improveLand();if(e)this.ticksNeeded=Math.floor(e.land.baseLand)},showing:function(){return!0}},{text:"Buy Ice",tooltip:"Buy available ice",currentTicks:0,ticksNeeded:50,threads:0,cost:0,costType:"",finish:function(){if(e)e.buyIce()},showing:function(){return!0}},{text:"Sell Water",tooltip:"Sells up to 50 water",currentTicks:0,ticksNeeded:50,threads:0,cost:0,costType:"",finish:function(){if(e)e.water.sellWater(50)},showing:function(){return!0}},{text:"Improve Farms",tooltip:"Farm efficiency increases by 2%",currentTicks:0,ticksNeeded:40,threads:0,cost:0,costType:"",finish:function(){if(e)e.farms.improve();this.ticksNeeded=v(20*((this.completions||0)+2)+Math.pow(this.completions||0,2)/10)},showing:function(){return!0}},{text:"Find more Ice Sellers",tooltip:"Gain 200 buyable ice and 1 more per tick",currentTicks:0,ticksNeeded:2000,threads:0,cost:0.5,costType:"cash",finish:function(){if(e)e.ice.findIceSeller(1)},showing:function(){return!0}},{text:"Bigger Storms",tooltip:"Storms last 5 more ticks. Max 300 duration.",currentTicks:0,ticksNeeded:600,threads:0,cost:2,costType:"science",finish:function(){if(e)e.clouds.gainStormDuration(5);this.cost+=0.5,this.ticksNeeded+=50},done:function(){return e?e.clouds.initialStormDuration>=300:!1},showing:function(){return!this.done?.()}},{text:"Build Robots",tooltip:"Builds a robot",currentTicks:0,ticksNeeded:1e4,threads:0,cost:0.01,costType:"metal",finish:function(){if(e)e.robots.gainRobots(1)},showing:function(){return e?e.robots.unlocked!==0:!1},done:function(){return e?e.robots.robots>=e.robots.robotMax:!1}},{text:"More Robot Storage",tooltip:"Can hold 5 more robots",currentTicks:0,ticksNeeded:20000,threads:0,cost:0.5,costType:"wood",finish:function(){if(e)e.robots.gainStorage(5);this.ticksNeeded+=2000},showing:function(){return e?e.robots.unlocked!==0:!1}},{text:"Improve House Design",tooltip:"Improves base happiness modifier by .1",currentTicks:0,ticksNeeded:3000,threads:0,cost:10,costType:"science",finish:function(){if(e)e.population.improveHouse();this.ticksNeeded+=500},showing:function(){return e?e.robots.unlocked!==0:!1}}]}tick(){for(let t=0;t<this.processes.length;t++){let s=this.processes[t];this.tickRow(s,this.speed*s.threads)}}tickRow(t,s){if(s===0){t.isMoving=0;return}if(t.done&&t.done()){if(t.isMoving=0,t.threads>0)this.freeThreads+=t.threads,t.threads=0;return}t.isMoving=1;let i=s*t.cost;if(t.costType){if(e&&e[t.costType]<i){t.isMoving=0;return}if(e)e[t.costType]-=i}t.currentTicks+=s,t.isMoving=1;while(t.currentTicks>=t.ticksNeeded){let r=t.currentTicks-t.ticksNeeded;t.currentTicks=0,t.completions=(t.completions||0)+1,t.finish(),t.currentTicks=r}}unlockComputer(){if(!e)return;if(e.science>=1000)e.science-=1000,this.unlocked=1,e.events.emit("computer:unlocked")}buyThread(){if(!e)return;let t=this.getThreadCost();if(e.cash>=t)e.cash-=t,this.threads++,this.freeThreads++}getThreadCost(){return ft(Math.pow(2,this.threads)*500)}buySpeed(){if(!e)return;let t=this.getSpeedCost();if(e.science>=t)e.science-=t,this.speed++}getSpeedCost(){return ft(Math.pow(2,this.speed)*500)}addThread(t,s){s=Math.min(s,this.freeThreads);let i=this.processes[t];if(i)i.threads+=s,this.freeThreads-=s}removeThread(t,s){let i=this.processes[t];if(i)s=Math.min(s,i.threads),i.threads-=s,this.freeThreads+=s}}class P{robots;robotsFree;robotMax;unlocked;ore;mines;failed;jobs;constructor(){this.robots=0,this.robotsFree=0,this.robotMax=5,this.unlocked=0,this.ore=0,this.mines=0,this.failed=0,this.jobs=[{text:"Cut Trees",tooltip:"Cut down 2 trees for 1 wood",workers:0,finish:function(){if(e)e.robots.cutTrees(this.workers)},showing:function(){return!0}},{text:"Expand indoor water storage",tooltip:"Gives 50 more max indoor water.<br>Cost increases by 1",currentTicks:0,ticksNeeded:3000,workers:0,cost:[0.1],costType:["metal"],finish:function(){if(this.ticksNeeded!==void 0)this.ticksNeeded+=1000;if(e)e.water.maxIndoor+=50},showing:function(){return!0}},{text:"Build Mines",tooltip:"Build up to (total land / 1000) mines",currentTicks:0,ticksNeeded:300,workers:0,cost:[1],costType:["wood"],finish:function(){if(e)e.robots.mines++;if(this.ticksNeeded!==void 0)this.ticksNeeded+=100},done:function(){return e?e.robots.mines*1000>=e.land.optimizedLand:!1},showing:function(){return!0}},{text:"Mine Ore",tooltip:"Get (mines / 100) ore per tick",workers:0,finish:function(){if(e)e.robots.mineOre(this.workers)},showing:function(){return!0}},{text:"Smelt Ore",tooltip:"Each tick costs 5 wood, 1 ore, and 1000 oxygen<br>Gain 1 metal",workers:0,finish:function(){if(e)e.robots.smeltOre(this.workers)},showing:function(){return!0}},{text:"Turn ore into dirt",tooltip:"Each tick costs 1 energy and 1000 ore<br>Gain 5 Base Land<br>Total land gained: <div id='totalDirtFromOre'></div>",currentTicks:0,ticksNeeded:1000,workers:0,during:function(){if(e&&e.power>=1*this.workers&&e.robots.ore>=this.workers*1000)return e.power-=1*this.workers,e.robots.ore-=this.workers*1000,!0;return!1},finish:function(){if(e)e.land.addLand(50)},showing:function(){return e?e.energy.unlocked!==0:!1}}]}tick(){for(let t=0;t<this.jobs.length;t++)this.tickRow(this.jobs[t],this.jobs[t].workers)}tickRow(t,s){if(s===0||t.done&&t.done()){t.isMoving=0;return}if(t.ticksNeeded===void 0){t.finish();return}if(t.during&&!t.during()){t.isMoving=0;return}if(t.cost&&t.costType){for(let i=0;i<t.cost.length;i++){let r=s*t.cost[i],n=t.costType[i];if(n){if(e&&e[n]<r){t.isMoving=0;return}}}for(let i=0;i<t.cost.length;i++){let r=t.costType[i];if(e)e[r]-=s*t.cost[i]}}if(t.currentTicks=(t.currentTicks||0)+s,t.isMoving=1,t.currentTicks>=t.ticksNeeded){let i=t.currentTicks-t.ticksNeeded;t.currentTicks=0,t.completions=(t.completions||0)+1,t.finish(),this.tickRow(t,i)}}gainRobots(t){this.robots+=t,this.robotsFree+=t}gainStorage(t){this.robotMax+=t}unlockRobots(){if(!e)return;if(e.cash>=3000)e.cash-=3000,this.unlocked=1,e.events.emit("robots:unlocked"),this.gainRobots(1);e.events.emit("robots:updated")}failedRobots(){if(!e)return;if(e.cash>=1e6)e.cash-=1e6,this.failed=0,e.events.emit("robots:unlocked"),this.gainRobots(1);e.events.emit("robots:updated")}addWorker(t,s){let i=this.jobs[t];if(i)s=Math.min(s,this.robotsFree),i.workers+=s,this.robotsFree-=s;e?.events.emit("robots:updated")}removeWorker(t,s){let i=this.jobs[t];if(i)s=Math.min(s,i.workers),i.workers-=s,this.robotsFree+=s;e?.events.emit("robots:updated")}cutTrees(t){if(e&&e.trees.trees>=2*t)e.trees.trees-=2*t,e.wood+=t}mineOre(t){if(e)e.robots.ore+=e.robots.mines/100*t}smeltOre(t){if(e&&e.wood>=5*t&&this.ore>=t&&e.oxygen>=t*1000)e.wood-=5*t,this.ore-=t,e.oxygen-=1000*t,e.metal+=t}}class q{unlocked;battery;drain=0;constructor(){this.unlocked=0,this.battery=100}unlockEnergy(){if(e&&e.metal>=500)e.metal-=500,this.unlocked=1,e.events.emit("energy:unlocked");e?.events.emit("energy:updated")}tick(){if(!e)return;let t=e.power-this.battery;if(this.drain=0,t>0)this.drain=t/500,e.power-=this.drain}gainEnergy(t){if(e)e.power+=t}buyBattery(t){this.battery+=t}}class X{unlocked;orbiting;constructor(){this.unlocked=0,this.orbiting=[{type:"ice",amount:1e6},{type:"dirt",amount:500}]}unlockSpaceStation(){if(e&&e.metal>=2000&&e.wood>=20000)e.metal-=2000,e.wood-=20000,this.unlocked=1,e.events.emit("spaceStation:unlocked");e?.events.emit("spaceStation:updated")}tick(){if(!this.unlocked||!e)return;for(let t=0;t<this.orbiting.length;t++){let s=this.orbiting[t],i=s.amount/1e5;s.amount-=i;let r=s.type;if(r==="ice")e.ice.ice+=i;else if(r==="dirt")e.land.addLand(i)}}}class j{unlocked;cometSpotChance;takeAmount;comets;constructor(){this.unlocked=0,this.cometSpotChance=0.006,this.takeAmount="",this.comets=[]}tick(){if(!this.unlocked||!e)return;if(this.checkForNewAsteroids(),this.comets.length){let t=e.power/1000;e.power-=this.pullIntoOrbit(t),this.removeAsteroidIfDone()}}unlockTractorBeam(){if(!e)return;if(e.science>=500000&&e.oxygen>=5000000)e.science-=500000,e.oxygen-=2000000,this.unlocked=1,e.events.emit("tractorBeam:unlocked"),e.spaceDock.unlocked=1,e.events.emit("spaceDock:unlocked");e.events.emit("tractorBeam:updated")}pullIntoOrbit(t){if(!e)return 0;let s=t/this.comets.length,i=0;this.takeAmount="";for(let r=0;r<e.spaceStation.orbiting.length;r++){let n=e.spaceStation.orbiting[r],a=0;for(let l=0;l<this.comets.length;l++){let m=this.comets[l];if(m.amountType===n.type){let x=Math.min(s,m.amount);i+=x,m.amount-=x,a+=x}}if(n.amount+=a,this.takeAmount+=o(a,3)+" "+n.type,r<e.spaceStation.orbiting.length-1)this.takeAmount+=", "}return i}checkForNewAsteroids(){if(Math.random()<this.cometSpotChance)this.addComet()}removeAsteroidIfDone(){let t=this.comets.length-1;for(let s=t;s>=0;s--){let i=this.comets[s];if(i.duration--,i.duration<0||i.amount<1){if(i.drawed)e?.events.emit("tractorBeam:removeComet",i);this.comets.splice(s,1)}}}addComet(){if(!e||this.comets.length>20)return;let t=Math.random(),s=Math.random()*100*e.space.sector+200,i=Math.floor(Math.random()*750+250),r=Math.random()*2+1,n={};if(t<0.9)n={name:"Comet",amountType:"ice",amount:s*1000,initialAmount:s*1000,duration:i,initialDuration:i,speed:r};else n={name:"Asteroid",amountType:"dirt",amount:s,initialAmount:s,duration:i*2,initialDuration:i*2,speed:r/2};n.id=Ht(),n.drawed=!1,this.comets.push(n)}}class J{battleships;unlocked;sended;constructor(){this.battleships=0,this.unlocked=0,this.sended=0}addBattleship(t){this.battleships+=t,e?.events.emit("spaceDock:updated")}}class _{amount;foodAmount;actionRate;actionSpeed;actionCounter;energy;speed;x;y;engaged;direction;target;constructor(t,s){this.amount=t,this.foodAmount=s/p.foodPerShip,this.actionRate=1,this.actionSpeed=40,this.actionCounter=0,this.energy=0,this.speed=0.5,this.x=0,this.y=0,this.engaged=!1,this.direction=0,this.target=null}}class z{sendRate;timeRemaining;totalTime;y;constructor(){this.sendRate=1,this.timeRemaining=this.totalTime=40,this.y=350}tick(){if(!e)return;if(this.timeRemaining--,this.timeRemaining<0)if(e.spaceDock.battleships>0){let t=Math.min(this.sendRate,e.spaceDock.battleships),s=e.farms.food*0.05;e.farms.food-=s,e.space.spawnShip(new _(t,s),this.y),e.spaceDock.battleships-=t,e.spaceDock.sended+=t,this.timeRemaining=this.totalTime}else this.timeRemaining=0}getTarget(){return{isHome:!0,x:-125,y:this.y}}}class I{aProgress;color;lastPercentage=-1;constructor(t,s){this.aProgress=document.getElementById(t),this.color=s}tick(t,s){if(!this.aProgress)return;let i=t/s;if(Math.abs(this.lastPercentage-i)<0.001)return;this.lastPercentage=i,this.reset(this.aProgress),this.drawProgress(this.aProgress,i,this.color)}reset(t){if(!t)return;let s=t.getContext("2d");if(!s)return;s.lineCap="square";let i=t.width/2,r=t.width/2-5;s.beginPath(),s.lineWidth=8,s.fillStyle="#1e1e1e",s.arc(i,i,r,0,2*Math.PI),s.fill()}drawProgress(t,s,i){if(!t)return;let r=t.getContext("2d");if(!r)return;let n=Math.PI/2,a=2*s*0.95*Math.PI-n*0.9,l=0-n*0.9,m=t.width/2,x=t.width/2-10;r.lineCap="square",r.beginPath(),r.lineWidth=8,r.strokeStyle=i,r.arc(m,m,x,l,a),r.stroke()}}class u{textCache=new Map;elementCache=new Map;clearCache(){this.textCache.clear(),this.elementCache.clear()}getElement(t){let s=this.elementCache.get(t);if(!s){let i=document.getElementById(t);if(!i)throw Error(`Element ${t} not found`);s=i,this.elementCache.set(t,s)}return s}updateElementText(t,s){if(this.textCache.get(t)===s)return;this.getElement(t).textContent=s,this.textCache.set(t,s)}setVisible(t,s){let i=this.getElement(t);if(s)i.classList.remove("hidden");else i.classList.add("hidden")}}class Y extends u{constructor(){super();if(e)e.events.on("computer:unlocked",()=>this.checkUnlocked())}checkUnlocked(){if(!e)return;if(e.computer.unlocked)this.setVisible("unlockedComputer",!0),this.setVisible("unlockComputer",!1),this.setVisible("robotsContainer",!0);else this.setVisible("unlockedComputer",!1),this.setVisible("unlockComputer",!0),this.setVisible("robotsContainer",!1)}update(){if(!e)return;this.updateElementText("freeThreads",String(e.computer.freeThreads)),this.updateElementText("threads",String(e.computer.threads)),this.updateElementText("speed",String(e.computer.speed)),this.updateElementText("threadCost",o(e.computer.getThreadCost(),1)),this.updateElementText("speedCost",o(e.computer.getSpeedCost(),1)),this.updateElementText("landOptimized",vt(e.land.optimizedLand/(e.land.baseLand*10)*100)+"%");for(let t=0;t<e.computer.processes.length;t++){let s=e.computer.processes[t];if(!s)continue;this.updateElementText("computerRow"+t+"Threads",String(s.threads)),this.setVisible("computerRow"+t+"Container",s.showing())}}updateRowProgress(t){if(!e||!e.computer.unlocked)return;let s=e.computer.processes[t];if(!s)return;let i="computerRow"+t;this.getElement(i+"PB").style.width=s.currentTicks/s.ticksNeeded*100+"%",this.getElement(i+"PB").style.backgroundColor=s.isMoving?"yellow":"red",this.updateElementText(i+"CurrentTicks",String(s.currentTicks)),this.updateElementText(i+"TicksNeeded",String(s.ticksNeeded));let r=this.getElement(i+"CostContainer");if(s.cost!==0)r.classList.remove("hidden"),this.updateElementText(i+"Cost",o(s.cost)),this.updateElementText(i+"CostType",s.costType);else r.classList.add("hidden")}addComputerRow(t){let s=this.getElement("computerRows"),i=document.createElement("div");i.className="computerRow";let r="computerRow"+t;i.id=r+"Container";let n=document.createElement("div");n.id=r+"Plus",n.className="button",n.innerHTML="+",n.addEventListener("click",(E)=>e?.computer.addThread(t,S(E)));let a=document.createElement("div");a.id=r+"Minus",a.className="button",a.innerHTML="-",a.addEventListener("click",(E)=>e?.computer.removeThread(t,S(E)));let l=document.createElement("div");l.id=r+"Threads",l.className="small",l.style.marginRight="4px";let m=e?.computer.processes[t]?.text||"",x=document.createElement("div");x.innerHTML=m;let y=document.createElement("div");y.className="rowProgressBarOuter",y.innerHTML="<div class='rowProgressBarInner' id='"+r+"PB'></div>";let h=document.createElement("div");h.className="computerTooltipContainer",h.id=r+"Tooltip";let T=document.createElement("div");T.className="rowTooltip";let k=e?.computer.processes[t]?.tooltip||"";T.innerHTML=`
            <div class="tooltipDescription">${k}</div>
            <div class="tooltipDivider"></div>
            <div class="tooltipStats">
                <div><b>Progress:</b> <span id="${r}CurrentTicks"></span> / <span id="${r}TicksNeeded"></span> ticks</div>
                <div id="${r}CostContainer" class="hidden"><b>Cost:</b> <span id="${r}Cost"></span> <span id="${r}CostType"></span> per tick</div>
            </div>
        `,h.appendChild(T),i.appendChild(n),i.appendChild(l),i.appendChild(a);let g=document.createElement("div");g.className="rowLabel",g.appendChild(x),i.appendChild(g),i.appendChild(y),i.appendChild(h),s.appendChild(i)}}class Q extends u{constructor(){super();if(e)e.events.on("robots:unlocked",()=>this.checkUnlocked()),e.events.on("robots:updated",()=>this.update())}checkUnlocked(){if(!e)return;if(e.robots.unlocked)if(e.robots.failed)this.setVisible("unlockedRobots",!1),this.setVisible("failRobots",!0);else this.setVisible("unlockedRobots",!0),this.setVisible("unlockRobots",!1),this.setVisible("failRobots",!1),this.setVisible("lightningContainer",!0),this.setVisible("lightningTooltip",!0),this.setVisible("energyContainer",!0),this.setVisible("woodContainer",!0),this.setVisible("metalContainer",!0);else this.setVisible("unlockedRobots",!1),this.setVisible("unlockRobots",!0),this.setVisible("lightningContainer",!1),this.setVisible("lightningTooltip",!1),this.setVisible("energyContainer",!1),this.setVisible("woodContainer",!1),this.setVisible("metalContainer",!1)}update(){if(!e)return;if(this.updateElementText("robots",String(e.robots.robots)),this.updateElementText("robotsFree",String(e.robots.robotsFree)),this.updateElementText("robotMax",String(e.robots.robotMax)),this.updateElementText("ore",o(e.robots.ore)),e.robots.jobs[5])this.updateElementText("totalDirtFromOre",o((e.robots.jobs[5].completions||0)*5));for(let t=0;t<e.robots.jobs.length;t++){let s=e.robots.jobs[t];if(!s)continue;this.updateElementText("robotRow"+t+"Workers",String(s.workers)),this.setVisible("robotRow"+t+"Container",s.showing())}}updateRowProgress(t){if(!e)return;let s=e.robots.jobs[t];if(!s)return;let i="robotRow"+t;if(s.ticksNeeded===void 0)return;this.getElement(i+"PB").style.width=(s.currentTicks||0)/s.ticksNeeded*100+"%",this.getElement(i+"PB").style.backgroundColor=s.isMoving?"yellow":"red",this.updateElementText(i+"CurrentTicks",String(s.currentTicks||0)),this.updateElementText(i+"TicksNeeded",o(s.ticksNeeded,1));let r=this.getElement(i+"CostContainer");if(s.cost&&s.costType){r.classList.remove("hidden");let n=o(s.cost[0]||0)+" "+(s.costType[0]||"");n+=s.cost.length>1?" and "+o(s.cost[1]||0)+" "+(s.costType[1]||""):"",this.updateElementText(i+"Cost",n)}else r.classList.add("hidden")}addRobotRow(t){let s=this.getElement("robotRows"),i=document.createElement("div");i.className="robotRow";let r="robotRow"+t;i.id=r+"Container";let n=document.createElement("div");n.id=r+"Plus",n.className="button",n.innerHTML="+",n.addEventListener("click",(C)=>e?.robots.addWorker(t,S(C)));let a=document.createElement("div");a.id=r+"Minus",a.className="button",a.innerHTML="-",a.addEventListener("click",(C)=>e?.robots.removeWorker(t,S(C)));let l=document.createElement("div");l.id=r+"Workers",l.className="small",l.style.marginRight="4px";let m=e?.robots.jobs[t]?.text||"",x=document.createElement("div");x.innerHTML=m;let y=document.createElement("div");if(e?.robots.jobs[t]?.ticksNeeded)y.className="rowProgressBarOuter",y.innerHTML="<div class='rowProgressBarInner' id='"+r+"PB'></div>";let h=document.createElement("div");h.className="computerTooltipContainer",h.id=r+"Tooltip";let T=document.createElement("div");T.className="rowTooltip";let k=e?.robots.jobs[t]?.tooltip||"",g="";if(e?.robots.jobs[t]?.ticksNeeded)g=`
                <div class="tooltipDivider"></div>
                <div class="tooltipStats">
                    <div><b>Progress:</b> <span id="${r}CurrentTicks"></span> / <span id="${r}TicksNeeded"></span> ticks</div>
                    <div id="${r}CostContainer" class="hidden"><b>Cost:</b> <span id="${r}Cost"></span> per tick</div>
                </div>
            `;T.innerHTML=`
            <div class="tooltipDescription">${k}</div>
            ${g}
        `,h.appendChild(T),i.appendChild(n),i.appendChild(l),i.appendChild(a);let E=document.createElement("div");if(E.className="rowLabel",E.appendChild(x),i.appendChild(E),y.innerHTML)i.appendChild(y);i.appendChild(h),s.appendChild(i)}}class Z extends u{update(){if(!e)return;this.updateElementText("totalWater",o(e.ice.ice+e.water.indoor+e.water.outdoor+e.clouds.water+e.land.water+e.trees.water+e.farms.water)),this.updateElementText("cash",o(e.cash)),this.updateElementText("oxygen",o(e.oxygen)),this.updateElementText("science",o(e.science)),this.updateElementText("wood",o(e.wood)),this.updateElementText("metal",o(e.metal)),this.updateElementText("oxygenLeak",o(e.oxygenLeak,4))}}class G extends u{update(){if(!e)return;this.updateElementText("ice",o(e.ice.ice)),this.updateElementText("buyableIce",o(e.ice.buyable)),this.updateElementText("iceTransferred",o(e.ice.transferred,4)),this.updateElementText("indoorWaterReceived",o(e.ice.transferred,4)),this.updateElementText("iceBuyerAmount",String(e.ice.gain))}}class K extends u{update(){if(!e)return;this.updateElementText("indoorWater",o(e.water.indoor)),this.updateElementText("indoorWaterMax",o(e.water.maxIndoor)),this.updateElementText("indoorWaterSelling",o(e.water.selling)),this.updateElementText("indoorWaterProfits",o(e.water.gain)),this.updateElementText("excessWater",o(e.water.excess,4)),this.updateElementText("lakeWaterFromStorage",o(e.water.excess,4)),this.updateElementText("outdoorWater",o(e.water.outdoor)),this.updateElementText("waterTransferred",o(e.water.transferred,4)),this.updateElementText("cloudsReceived",o(e.water.transferred,4))}}class D extends u{update(){if(!e)return;this.updateElementText("clouds",o(e.clouds.water)),this.updateElementText("stormTimer",String(e.clouds.stormTimer)),this.updateElementText("stormRate",e.clouds.stormRate+"%"),this.getElement("intensityPB").style.height=e.clouds.stormRate+"%",this.updateElementText("stormDuration",String(e.clouds.stormDuration)),this.updateElementText("rain",o(e.clouds.transferred,4)),this.updateElementText("landReceived",o(e.clouds.transferred,4)),this.updateElementText("lightningChance",o(e.clouds.lightningChance)+"%"),this.getElement("lightningPB").style.height=e.clouds.lightningChance+"%",this.updateElementText("lightningStrength",o(e.clouds.lightningStrength))}}class tt extends u{update(){if(!e)return;this.updateElementText("landWater",o(e.land.water)),this.updateElementText("optimizedLand",o(e.land.optimizedLand)),this.updateElementText("baseLand",o(e.land.baseLand)),this.updateElementText("land",o(e.land.land)),this.updateElementText("soil",o(e.land.soil)),this.updateElementText("landConverted",o(e.land.convertedLand,4)),this.updateElementText("landWaterToForest",o(e.land.transferred,4)),this.updateElementText("forestReceived",o(e.land.transferred,4)),this.updateElementText("landWaterToFarm",o(e.land.transferred,4)),this.updateElementText("farmReceived",o(e.land.transferred,4))}}class et extends u{update(){if(!e)return;this.updateElementText("population",o(e.population.people)),this.updateElementText("foodEaten",o(e.population.foodEaten,4)),this.updateElementText("populationGrowth",wt(e.population.popGrowth,4)),this.updateElementText("starving",o(e.population.starving,4)),this.updateElementText("scienceDelta",o(e.population.scienceDelta,4)),this.updateElementText("cashDelta",o(e.population.cashDelta,4)),this.updateElementText("scienceRatio",e.population.scienceRatio<50?100-e.population.scienceRatio+"% science":e.population.scienceRatio+"% cash"),this.updateElementText("happiness",o(e.population.happiness,4)),this.updateElementText("happinessFromHouse",o(e.population.houseBonus)),this.updateElementText("happinessFromTrees",o(e.population.happinessFromTrees,4)),this.updateElementText("happinessFromOxygen",o(e.population.happinessFromOxygen,4))}}class st extends u{update(){if(!e)return;this.updateElementText("forestWater",o(e.trees.water)),this.updateElementText("ferns",o(e.trees.ferns)),this.updateElementText("fernsDelta",o(e.trees.fernsDelta,4)),this.updateElementText("smallTrees",o(e.trees.smallTrees)),this.updateElementText("smallTreesDelta",o(e.trees.smallTreesDelta,4)),this.updateElementText("trees",o(e.trees.trees)),this.updateElementText("treesDelta",o(e.trees.treesDelta,4)),this.updateElementText("totalPlants",o(e.trees.totalPlants)),this.updateElementText("oxygenGain",o(e.trees.oxygenGain,4)),this.updateElementText("forestWaterToLake",o(e.trees.transferred,4)),this.updateElementText("lakeWaterFromForest",o(e.trees.transferred,4)),this.updateElementText("fernWater",o(e.trees.fernsWaterUse,4)),this.updateElementText("smallTreesWater",o(e.trees.smallTreesWaterUse,4)),this.updateElementText("treesWater",o(e.trees.treesWaterUse,4))}}class it extends u{update(){if(!e)return;this.updateElementText("farmsWater",o(e.farms.water)),this.updateElementText("farms",o(e.farms.farms)),this.updateElementText("food",o(e.farms.food)),this.updateElementText("foodCreated",o(e.farms.foodCreated,4)),this.updateElementText("farmFoodEaten",o(e.population.foodEaten,4)),this.updateElementText("efficiency",o(e.farms.efficiency*100,1)),this.updateElementText("farmWaterToLake",o(e.farms.transferred,4)),this.updateElementText("lakeWaterFromFarm",o(e.farms.transferred,4));let t=document.getElementById("buyFarmAmount"),s=t?Number(t.value):1;this.updateElementText("farmCost",o(s*50,1))}}class rt extends u{constructor(){super();if(e)e.events.on("energy:unlocked",()=>this.checkUnlocked()),e.events.on("energy:updated",()=>this.update())}checkUnlocked(){if(!e)return;if(e.energy.unlocked){if(this.setVisible("unlockedEnergy",!0),this.setVisible("unlockEnergy",!1),this.getElement("spaceStationContainer").classList.contains("hidden"))this.getElement("spaceStationContainer").classList.remove("hidden")}else if(this.setVisible("unlockedEnergy",!1),this.setVisible("unlockEnergy",!0),!this.getElement("spaceStationContainer").classList.contains("hidden"))this.getElement("spaceStationContainer").classList.add("hidden")}update(){if(!e)return;this.updateElementText("energy",o(e.power)),this.updateElementText("battery",o(e.energy.battery,1)),this.updateElementText("drain",o(e.energy.drain));let t=document.getElementById("buyBattery"),s=t?Number(t.value):1;this.updateElementText("batteryCost",o(s*30000)+" oxygen and "+o(s*20000)+" science")}}class ot extends u{constructor(){super();if(e)e.events.on("spaceStation:unlocked",()=>this.checkUnlocked()),e.events.on("spaceStation:updated",()=>this.update())}checkUnlocked(){if(!e)return;if(e.spaceStation.unlocked)this.setVisible("spaceStationContainer",!0),this.setVisible("unlockedSpaceStation",!0),this.setVisible("unlockSpaceStation",!1),this.setVisible("tractorBeamContainer",!0);else this.setVisible("spaceStationContainer",!1),this.setVisible("unlockedSpaceStation",!1),this.setVisible("unlockSpaceStation",!0),this.setVisible("tractorBeamContainer",!1)}update(){if(!e)return;let t="",s="";for(let i=0;i<e.spaceStation.orbiting.length;i++){let r=e.spaceStation.orbiting[i];if(!r)continue;if(t+=o(r.amount)+" "+r.type,s+=o(r.amount/1e4,4)+" "+r.type,i!==e.spaceStation.orbiting.length-1)t+=", ",s+=", "}this.updateElementText("orbitingResources",t),this.updateElementText("orbitSending",s)}}class nt extends u{cometRows=new Map;constructor(){super();if(e)e.events.on("tractorBeam:unlocked",()=>this.checkUnlocked()),e.events.on("tractorBeam:updated",()=>this.update()),e.events.on("tractorBeam:removeComet",(t)=>{if(f)f.removeComet(t)})}checkUnlocked(){if(!e)return;if(e.tractorBeam.unlocked)this.setVisible("unlockedTractorBeam",!0),this.setVisible("unlockTractorBeam",!1);else this.setVisible("unlockedTractorBeam",!1),this.setVisible("unlockTractorBeam",!0)}update(){if(!e||!f)return;let t=this.getElement("allPassing"),s=e.tractorBeam.comets,i=new Set(s.map((r)=>r.id));for(let[r,n]of this.cometRows.entries())if(!i.has(r))n.remove(),this.cometRows.delete(r);for(let r=0;r<s.length;r++){let n=s[r];if(!n)continue;if(!this.cometRows.has(n.id)){let a=document.createElement("div");a.className="comet-row",a.innerHTML=`<span>${n.name}</span> with <span id="comet-amount-${n.id}"></span> ${n.amountType} passing in <span id="comet-duration-${n.id}"></span>`,t.appendChild(a),this.cometRows.set(n.id,a)}this.updateElementText(`comet-amount-${n.id}`,o(n.amount,1)),this.updateElementText(`comet-duration-${n.id}`,String(n.duration)),f.drawComet(n)}this.updateElementText("takeAmount",String(e.tractorBeam.takeAmount))}}class ct extends u{constructor(){super();if(e)e.events.on("spaceDock:unlocked",()=>this.checkUnlocked()),e.events.on("spaceDock:updated",()=>this.update())}checkUnlocked(){if(!e)return;if(e.spaceDock.unlocked)this.setVisible("spaceDockContainer",!0),this.setVisible("hangarContainer",!0),this.setVisible("spaceCanvas",!0),this.setVisible("spaceContainer",!0);else this.setVisible("spaceDockContainer",!1),this.setVisible("hangarContainer",!1),this.setVisible("spaceCanvas",!1),this.setVisible("spaceContainer",!1)}update(){if(!e)return;this.updateElementText("battleships",String(e.spaceDock.battleships));let t=document.getElementById("buyBattleshipAmount"),s=t?Number(t.value):1;this.updateElementText("battleshipCost",o(s*30000000)+" oxygen and "+o(s*15000000)+" science")}}class at extends u{update(){if(!e)return;this.updateElementText("hangarSending",e.hangar.sendRate+" in "+St(e.hangar.timeRemaining/10)+" seconds.");let t=document.getElementById("buyHangarAmount"),s=t?Number(t.value):1;this.updateElementText("hangarCost",o(s*1e6,1))}}class ut extends u{progressBar1;progressBar2;computerView;robotsView;resourceView;iceView;waterView;cloudsView;landView;populationView;treesView;farmsView;energyView;spaceStationView;tractorBeamView;spaceDockView;hangarView;cometPool=[];allContainers=[];columns=[];lastVisibleCount=-1;lastWidth=-1;constructor(){super();this.progressBar1=new I("nextStormProgress","#21276a"),this.progressBar2=new I("stormDurationProgress","#1c7682"),this.computerView=new Y,this.robotsView=new Q,this.resourceView=new Z,this.iceView=new G,this.waterView=new K,this.cloudsView=new D,this.landView=new tt,this.populationView=new et,this.treesView=new st,this.farmsView=new it,this.energyView=new rt,this.spaceStationView=new ot,this.tractorBeamView=new nt,this.spaceDockView=new ct,this.hangarView=new at;let t=this.getElement("mainContainer");if(this.allContainers=Array.from(t.querySelectorAll(".container")),window.addEventListener("resize",()=>this.refreshLayout()),e)e.events.on("tick",()=>{if(!document.hidden)this.update()}),e.events.on("computer:unlocked",()=>this.refreshLayout()),e.events.on("robots:unlocked",()=>this.refreshLayout()),e.events.on("energy:unlocked",()=>this.refreshLayout()),e.events.on("spaceStation:unlocked",()=>this.refreshLayout()),e.events.on("tractorBeam:unlocked",()=>this.refreshLayout()),e.events.on("spaceDock:unlocked",()=>this.refreshLayout())}update(){if(!e)return;this.resourceView.update(),this.iceView.update(),this.waterView.update(),this.cloudsView.update(),this.landView.update(),this.treesView.update(),this.farmsView.update(),this.populationView.update(),this.updateComputerRowProgress(),this.computerView.update(),this.robotsView.update(),this.updateRobotsRowProgress(),this.energyView.update(),this.spaceStationView.update(),this.tractorBeamView.update(),this.spaceDockView.update(),this.hangarView.update(),this.progressBar1.tick(e.clouds.initialStormTimer-e.clouds.stormTimer,e.clouds.initialStormTimer),this.progressBar2.tick(e.clouds.stormDuration,e.clouds.initialStormDuration),xt()}refreshLayout(){let t=this.getElement("mainContainer"),s=window.getComputedStyle(t),i=parseFloat(s.columnGap||s.gap||"0"),r=280,n=t.querySelector(".column");if(n)r=parseFloat(window.getComputedStyle(n).minWidth);else{let h=document.createElement("div");h.className="column",h.style.visibility="hidden",h.style.position="absolute",t.appendChild(h),r=parseFloat(window.getComputedStyle(h).minWidth),t.removeChild(h)}let a=r+i,l=t.offsetWidth,m=Math.max(1,Math.floor((l+i)/a)),x=this.allContainers.filter((h)=>!h.classList.contains("hidden")),y=x.length;if(this.columns.length===m&&y===this.lastVisibleCount&&l===this.lastWidth)return;for(let h of this.allContainers)t.appendChild(h);if(this.columns.length!==m){this.columns.forEach((h)=>h.remove()),this.columns=[];for(let h=0;h<m;h++){let T=document.createElement("div");T.className="column",t.appendChild(T),this.columns.push(T)}}if(this.lastVisibleCount=y,this.lastWidth=l,this.columns.length===0)return;for(let h=0;h<x.length;h++){let T=x[h],k=this.columns[0];if(h<this.columns.length)k=this.columns[h];else{let g=k.offsetHeight;for(let E=1;E<this.columns.length;E++){let C=this.columns[E];if(C.offsetHeight<g)k=C,g=C.offsetHeight}}k.appendChild(T)}}clearComputerRows(){this.getElement("computerRows").innerHTML="",this.computerView.clearCache()}clearRobotRows(){this.getElement("robotRows").innerHTML="",this.robotsView.clearCache()}updateComputerRowProgress(){if(!e||!e.computer.unlocked)return;for(let t=0;t<e.computer.processes.length;t++)this.computerView.updateRowProgress(t)}updateRobotsRowProgress(){if(!e)return;for(let t=0;t<e.robots.jobs.length;t++)this.robotsView.updateRowProgress(t)}drawComet(t){let s,i="comet"+t.id;if(!t.drawed){s=this.cometPool.pop()||document.createElement("div"),s.className=t.name.toLowerCase(),s.id=i,s.classList.remove("hidden");let r=t.speed*t.duration;t.startingY=Math.random()*(r*0.4)+r*0.1,t.left=0,t.top=t.endingX=Math.pow(Math.pow(r,2)-Math.pow(t.startingY,2),0.5),t.slope=(0-t.startingY)/t.endingX,this.getElement("cometsContainer").appendChild(s),t.drawed=!0}else s=document.getElementById(i);if(s){t.left=(t.initialDuration-t.duration)/t.initialDuration*t.endingX,t.top=t.slope*t.left+t.startingY;let r=t.amountType==="ice"?t.amount/1000:t.amount,a=(t.name==="Comet"?40:20)*Math.sqrt(r/200);s.style.width=Math.round(a)+"px",s.style.height=Math.round(a)+"px",s.style.borderRadius=Math.round(a/2)+"px",s.style.left=Math.round(t.left-a/2)+"px",s.style.top=Math.round(t.top-a/2)+"px"}}removeComet(t){let s="comet"+t.id,i=document.getElementById(s);if(i)i.classList.add("hidden"),i.id="",this.cometPool.push(i);else console.log(s+"not found")}}var Mt=()=>{let t=(r,n)=>{let a=document.getElementById(r);if(a)a.addEventListener("click",n)};t("btnHardReset",Wt),t("btnPause",Nt),t("btnBeg",Ut),t("btnSave",ht),t("btnExport",Ft),t("btnImport",Ot),t("btnBuyIce",()=>e?.buyIce()),t("btnBuyFarms",()=>e?.buyFarms()),t("unlockComputer",()=>e?.computer.unlockComputer()),t("buyThread",()=>e?.computer.buyThread()),t("buySpeed",()=>e?.computer.buySpeed()),t("unlockRobots",()=>e?.robots.unlockRobots()),t("failRobots",()=>e?.robots.failedRobots()),t("unlockEnergy",()=>e?.energy.unlockEnergy()),t("btnBuyBattery",()=>e?.buyBattery()),t("unlockSpaceStation",()=>e?.spaceStation.unlockSpaceStation()),t("unlockTractorBeam",()=>e?.tractorBeam.unlockTractorBeam()),t("btnBuyBattleship",()=>e?.buyBattleship()),t("btnBuyHangar",()=>e?.buyHangar()),document.getElementById("mainContainer")?.addEventListener("contextmenu",(r)=>r.preventDefault()),document.getElementById("scienceSlider")?.addEventListener("input",function(){if(e)e.population.scienceRatio=Number(this.value)}),document.querySelectorAll(".numeric-input-small").forEach((r)=>{r.addEventListener("change",function(){let n=Number(this.value);if(isNaN(n)||n<1)n=1;this.value=Math.floor(n).toString(),this.dispatchEvent(new Event("input"))})})};if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",Mt);else Mt();var dt=[];function Kt(){if(dt.length===0)return;let t=dt[0]?.key;if(dt.splice(0,1),t===66)e?.buyIce()}document.addEventListener("keydown",function(t){let s={key:t.charCode!==0?t.charCode:t.keyCode,shift:t.shiftKey};dt.push(s),Kt()});class lt{events=new Map;on(t,s){if(!this.events.has(t))this.events.set(t,[]);this.events.get(t)?.push(s)}off(t,s){let i=this.events.get(t);if(i)this.events.set(t,i.filter((r)=>r!==s))}emit(t,...s){let i=this.events.get(t);if(i)i.forEach((r)=>r(...s))}}var e=null,f=null,$t=0,Tt=!1,At=0;function Dt(){$t++}function te(){Tt=!Tt}function Ht(){return At++,At}class Pt{totalLand;cash;oxygen;science;wood;metal;power;oxygenLeak=0;space;ice;water;clouds;land;trees;farms;population;computer;robots;energy;spaceStation;tractorBeam;spaceDock;hangar;events;constructor(){this.totalLand=1000,this.cash=100,this.oxygen=0,this.science=0,this.wood=0,this.metal=0,this.power=0,this.events=new lt}tick(){this.ice.tick(),this.robots.tick(),this.computer.tick(),this.farms.tick(this.land.transferWater()),this.population.tick(),this.water.outdoor+=this.farms.transferWater(),this.trees.tick(this.land.transferWater()),this.water.outdoor+=this.trees.transferWater(),this.land.tick(this.clouds.transferWater()),this.clouds.tick(this.water.transferWater()),this.energy.tick(),this.water.tick(this.ice.transferWater()),this.tractorBeam.tick(),this.spaceStation.tick(),this.space.tick(),this.oxygenLeak=this.oxygen/1e5,this.oxygen-=this.oxygenLeak,this.hangar.tick(),this.events.emit("tick")}initialize(){this.space=new H,this.ice=new M,this.water=new N,this.clouds=new W,this.land=new F(this.totalLand),this.trees=new O,this.farms=new U,this.population=new A,this.computer=new $,this.robots=new P,this.energy=new q,this.spaceStation=new X,this.tractorBeam=new j,this.spaceDock=new J,this.hangar=new z,f?.clearComputerRows();for(let t=0;t<this.computer.processes.length;t++){f?.computerView.addComputerRow(t);let s=this.computer.processes[t];if(s)s.isMoving=0,s.completions=0}f?.clearRobotRows();for(let t=0;t<this.robots.jobs.length;t++){f?.robotsView.addRobotRow(t);let s=this.robots.jobs[t];if(s)s.completions=0}}buyIce(){let t=this.cash;if(t<=0)return;this.cash-=this.ice.buyIce(t)}buyFarms(){let t=document.getElementById("buyFarmAmount"),s=Number(t.value);if(s*50>this.land.soil)s=Math.floor(this.land.soil/50);if(s<=0)return;this.land.soil-=s*50,this.farms.addFarm(s)}buyBattery(){let t=document.getElementById("buyBattery"),s=Number(t.value);if(s*30000>this.oxygen)s=Math.floor(this.oxygen/30000);if(s*20000>this.science)s=Math.floor(this.science/20000);if(s<=0)return;this.oxygen-=s*30000,this.science-=s*20000,this.energy.buyBattery(s)}buyBattleship(){let t=document.getElementById("buyBattleshipAmount"),s=Number(t.value);if(s*30000000>this.oxygen)s=Math.floor(this.oxygen/30000000);if(s*15000000>this.science)s=Math.floor(this.science/15000000);if(s<=0)return;this.oxygen-=30000000*s,this.science-=15000000*s,this.spaceDock.addBattleship(s)}buyHangar(){let s=document.getElementById("buyHangarAmount"),i=Number(s.value);if(i*1e6>this.land.soil)i=Math.floor(this.land.soil/1e6);if(i<=0)return;this.land.soil-=i*1e6,this.hangar.sendRate+=i}}function ee(){if(Tt)return;if(Dt(),e?.tick(),$t%100===0)ht()}function se(t){yt.postMessage({stop:!0}),yt.postMessage({start:!0,ms:1000/t})}function Nt(){te()}var yt=new Worker(new URL("./workers/interval.js",import.meta.url).href);yt.onmessage=function(t){if(t.data==="interval.start")ee()};async function Wt(){window.localStorage.terrafold2="",await Et()}function ie(){e=new Pt,f=new ut,e?.initialize()}function re(){if(!f)return;f.spaceDockView.checkUnlocked(),f.tractorBeamView.checkUnlocked(),f.spaceStationView.checkUnlocked(),f.energyView.checkUnlocked(),f.computerView.checkUnlocked(),f.robotsView.checkUnlocked(),f.update()}async function Et(){if(ie(),window.localStorage.terrafold2){let t=await pt(window.localStorage.terrafold2),s=JSON.parse(t);if(e)gt(s,e);if(e)for(let r of e.tractorBeam.comets)r.drawed=!1;let i=document.getElementById("scienceSlider");if(i&&e)i.value=e.population.scienceRatio.toString()}re(),f?.refreshLayout(),se(10)}function gt(t,s){for(let i in t)if(typeof t[i]==="object"&&t[i]!==null){if(typeof s[i]>"u")s[i]={};gt(t[i],s[i])}else if(typeof t[i]!=="function")s[i]=t[i]}async function ht(){let t={};if(e)gt(e,t);window.localStorage.terrafold2=await mt(JSON.stringify(t))}async function Ft(){await ht();let t=document.getElementById("exportImportSave");if(t)t.value=await mt(window.localStorage.terrafold2||""),t.select(),document.execCommand("copy"),t.value=""}async function Ot(){let t=document.getElementById("exportImportSave");if(t)window.localStorage.terrafold2=await pt(t.value),await Et()}function Ut(){if(e)e.cash+=0.1}Et();window.game=e;window.view=f;export{f as view,ht as save,Nt as pauseGame,Ht as incrementCometId,Ot as importSave,e as game,Ft as exportSave,Wt as clearSave,Ut as begForMoney};

//# debugId=191C5AC39977252E64756E2164756E21
//# sourceMappingURL=main.js.map
