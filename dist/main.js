function v(e){let s=1;if(e.ctrlKey)s*=5;if(e.shiftKey)s*=10;return s}function ge(e){return Math.floor(e*10)/10}function Be(e){return Math.floor(e*100)/100}function be(e){return Number(e.toPrecision(2))}function g(e){return Number(e.toPrecision(3))}function B(e,s,r,o,d){return V(e,s,r,o)<d}function V(e,s,r,o){return Math.sqrt(Math.pow(Math.abs(e-r),2)+Math.pow(Math.abs(s-o),2))}function C(e,s){let r=1;if(e<0)r=-1,e*=-1;if(e>=1e4)return(r===1?"+":"-")+Fe(e,3);else return(r===1?"+":"-")+Re(e,s)}function n(e,s){if(e>=1e4)return Fe(e,3);else return Re(e,s)}function Re(e,s){if(Number.isInteger(e))return e.toString();let r=3;if(s!==void 0)r=s;return e.toFixed(r-1).replace(pe,"$1")}var ve=[{value:1000000000000000000000000000000000000000000000000000000000000000,symbol:"V"},{value:1000000000000000000000000000000000000000000000000000000000000,symbol:"Nd"},{value:1000000000000000000000000000000000000000000000000000000000,symbol:"Od"},{value:1000000000000000000000000000000000000000000000000000000,symbol:"Sd"},{value:1000000000000000000000000000000000000000000000000000,symbol:"sd"},{value:1000000000000000000000000000000000000000000000000,symbol:"Qd"},{value:1000000000000000000000000000000000000000000000,symbol:"qd"},{value:1000000000000000000000000000000000000000000,symbol:"Td"},{value:1000000000000000000000000000000000000000,symbol:"Dd"},{value:1000000000000000000000000000000000000,symbol:"Ud"},{value:1000000000000000000000000000000000,symbol:"Dc"},{value:1000000000000000000000000000000,symbol:"N"},{value:1000000000000000000000000000,symbol:"O"},{value:1000000000000000000000000,symbol:"Sp"},{value:1000000000000000000000,symbol:"Sx"},{value:1000000000000000000,symbol:"Qi"},{value:1000000000000000,symbol:"Qa"},{value:1000000000000,symbol:"T"},{value:1e9,symbol:"B"},{value:1e6,symbol:"M"},{value:1000,symbol:"K"}],pe=/\.0+$|(\.[0-9]*[1-9])0+$/,F=new Map;function Fe(e,s){let r=e+"|"+s,o=F.get(r);if(o!==void 0)return o;let d,u=!1;for(let l=0;l<ve.length;l++){let f=ve[l];if(f&&e>=f.value/1.000501){d=(e/f.value).toPrecision(s).replace(pe,"$1")+f.symbol,u=!0;break}}if(!u)d=e.toPrecision(s).replace(pe,"$1");if(F.size>1000){let l=F.keys().next().value;if(l!==void 0)F.delete(l)}return F.set(r,d),d}function Ne(e,s){e.sort((r,o)=>r[s]-o[s])}async function Ee(e){let s=new Blob([e]).stream().pipeThrough(new CompressionStream("gzip")),o=await new Response(s).arrayBuffer(),d=new Uint8Array(o),u="";for(let l=0;l<d.byteLength;l++)u+=String.fromCharCode(d[l]);return btoa(u)}async function Te(e){if(!e)return"";let s=e.trim();if(s.startsWith("{")&&s.endsWith("}"))return s;try{let r=atob(e),o=Uint8Array.from(r,(u)=>u.codePointAt(0)),d=new Blob([o]).stream().pipeThrough(new DecompressionStream("gzip"));return new Response(d).text()}catch(r){return e}}class m{static foodPerShip=20;static actionRate=1;static actionSpeed=40;static globalTargetIndex=-1;static tick(e){m.checkEmpty(e),m.moveToNearestTarget(e),m.checkJoinFleet(e),m.attackTarget(e)}static updateGlobalTarget(){if(!t)return;let e=t.hangar.getTarget();m.globalTargetIndex=m.findClosestTarget(e.x,e.y)}static findClosestTarget(e,s){if(!t)return-1;let r=-1,o=1/0;for(let d=0;d<t.space.planets.length;d++){let u=t.space.planets[d];if(!a.doneBuilding(u)){let l=V(e,s,u.x,u.y);if(r===-1||l<o)r=d,o=l}}return r}static checkJoinFleet(e){if(!t||!e.engaged)return;for(let s=t.space.ships.length-1;s>=0;s--){let r=t.space.ships[s];if(r===e||m.isEmpty(r))continue;if(B(e.x,e.y,r.x,r.y,20))m.combineShips(e,r),t.space.ships.splice(s,1)}}static checkEmpty(e){if(e.food-=e.count,!m.isEmpty(e))return;e.food=0,e.engaged=!1,e.targetIndex=-1}static getTargetObject(e){if(!t)return null;if(e.targetIndex===-1)return t.hangar.getTarget();if(e.targetIndex>=0&&e.targetIndex<t.space.planets.length){let s=t.space.planets[e.targetIndex];if(!a.doneBuilding(s))return s}return e.targetIndex=m.findClosestTarget(e.x,e.y),e.targetIndex===-1?t.hangar.getTarget():t.space.planets[e.targetIndex]}static returnHome(e){if(!t)return;t.spaceDock.battleships+=e.count,t.spaceDock.sended-=e.count,t.farms.food+=e.food*m.foodPerShip,t.events.emit("spaceDock:updated");for(let s=t.space.ships.length-1;s>=0;s--)if(t.space.ships[s]===e){t.space.ships.splice(s,1);break}}static isEmpty(e){return e.food<=0}static getSpeed(e){if(t)return m.isEmpty(e)?t.spaceDock.emptySpeed:t.spaceDock.defaultSpeed;return m.isEmpty(e)?0.05:0.5}static moveToNearestTarget(e){let s=m.getTargetObject(e);if(!s)return;if(V(e.x,e.y,s.x,s.y)<40){if(!("isHome"in s)){e.engaged=!0;return}m.returnHome(e);return}e.engaged=!1;let r=m.getSpeed(e),o=0,d=s.y-e.y,u=s.x-e.x;if(d>=0&&u<0||d<0&&u<0)o=Math.PI;let l=Math.atan(d/u)+o;e.x=e.x+r*Math.cos(l),e.y=e.y+r*Math.sin(l),e.direction=l}static attackTarget(e){let s=m.getTargetObject(e);if(s&&!("isHome"in s)&&e.engaged){let r=s;if(e.actionCounter++,e.actionCounter>=m.actionSpeed){if(e.actionCounter=0,a.alive(r))a.takeDamage(r,m.actionRate*e.count);else if(a.workConstruction(r,e.count),a.doneBuilding(r))e.engaged=!1,e.targetIndex=m.findClosestTarget(e.x,e.y)}}}static combineShips(e,s){if(e.count+=s.count,e.energy+=s.energy,e.food+=s.food,s.actionCounter>e.actionCounter)e.actionCounter=s.actionCounter}}var y=document.getElementById("spaceCanvas"),i=y?y.getContext("2d"):null;if(i)i.font="13px Arial";var R=240,ye={x:0,y:0};function Ve(){if(!y||!t)return;if(y.width!==t.canvasWidth||y.height!==t.canvasHeight){if(y.width=t.canvasWidth,y.height=t.canvasHeight,R=y.width/5,i)i.font="13px Arial"}}if(y)window.addEventListener("resize",Ve),Ve(),y.addEventListener("mousemove",function(e){ye={x:e.offsetX-R,y:e.offsetY}});function ke(){if(!i||!t||!y)return;i.clearRect(0,0,y.width,y.height),Ye(),je(),Ke()}function Ke(){if(!t)return;for(let e=0;e<t.space.planets.length;e++)Ze(t.space.planets[e])}function je(){if(!t)return;for(let e=0;e<t.space.ships.length;e++)qe(t.space.ships[e])}function Ye(){if(!t)return;for(let e=0;e<t.space.planets.length;e++){let s=t.space.planets[e];Qe(s,s.isBoss?"B":(e+1).toString())}}function qe(e){if(!i)return;let s=e.x+R,r=m.getTargetObject(e);if(e.engaged&&r&&e.actionCounter<10){let f="isHome"in r,b=xe(!f?r.isBoss:!1);i.save(),i.beginPath(),i.strokeStyle="rgba(255, 50, 50, "+(1-e.actionCounter/10)+")",i.lineWidth=3,i.moveTo(s+25,e.y+25),i.lineTo(r.x+R+b,r.y+b),i.stroke(),i.restore()}i.save(),i.translate(s+25,e.y+25),i.rotate(e.direction);let o={x:-10,y:-10},d={x:10,y:0},u={x:-10,y:10},l={x:-7,y:0};i.beginPath(),i.fillStyle="#008080",i.lineWidth=3,i.moveTo(o.x,o.y),i.lineTo(d.x,d.y),i.lineTo(u.x,u.y),i.lineTo(l.x,l.y),i.fill(),i.restore(),i.save(),i.translate(s+25,e.y+25),i.fillStyle="white",i.fillText(n(e.count),-4,20),i.fillText(n(e.food/e.count/10,1),-4,30),i.restore()}function Qe(e,s){if(!i)return;let r=xe(e.isBoss),o=e.x+R;i.save(),i.translate(o+r,e.y+r),Je(e,r),De(e,r),Pe(e,r),i.fillStyle="white",i.fillText(s,-3,4),i.restore()}function Ze(e){if(!i)return;let s=xe(e.isBoss),r=e.x+R;if(!B(ye.x,ye.y,e.x+s,e.y+s,50))return;i.save(),i.translate(r+s,e.y+s),i.fillStyle="#ffffff",i.fillText("Atmosphere: "+n(e.atmo),-15,s),i.fillText("Reduction: "+n(a.getShieldReduction(e)*100)+"%",-15,s+10),i.fillText("Health: "+n(e.health),-15,s+20),i.fillText("Dirt: "+n(e.dirt),-15,s+30),i.fillText("Ore: "+n(e.ore),-15,s+40),i.fillText("C.Bots: "+n(e.bots)+" / "+n(e.maxMines),-15,s+50),i.fillText("Solar: "+n(e.solar),-15,s+60),i.fillText("Build Factory: "+n(e.factoryTicks)+" / "+n(a.FACTORY_TICKS_MAX),-15,s+70),i.fillText("Build Coilgun: "+n(e.coilgunTicks)+" / "+n(a.COILGUN_TICKS_MAX),-15,s+80),i.fillText("Coilgun Charge: "+n(e.coilgunCharge)+" / "+n(a.COILGUN_CHARGE_MAX),-15,s+90),i.fillText("Build Solar: "+n(e.solarTicks)+" / "+n(a.SOLAR_TICKS_MAX),-15,s+100),i.fillText("Mines: "+n(e.mines)+" / "+n(e.maxMines),-15,s+110),i.fillText("Build Mine: "+n(e.mineTicks)+" / "+n(a.MINE_TICKS_MAX),-15,s+120),i.restore()}function Je(e,s){if(!i)return;let r=s*(e.atmo/e.maxAtmo/2+0.5),o=i.createRadialGradient(0,0,r*1.1,0,0,r/3.3);o.addColorStop(0,"black");let d="hsl("+(e.view.color+120)+",90%,60%)";o.addColorStop(1,d),i.fillStyle=o,i.fillRect(-s,-s,s*2,s*2),i.beginPath(),i.strokeStyle="#008080",i.lineWidth=3,i.arc(0,0,s-4,0,2*Math.PI*(e.atmo/e.maxAtmo)),i.stroke()}function De(e,s){if(!i)return;i.beginPath();let r=Math.floor(e.health/e.maxHealth*70+10);i.fillStyle="hsl("+e.view.color+","+r+"%,"+e.view.light+"%)",i.arc(0,0,s/2,0,2*Math.PI),i.fill(),i.beginPath(),i.strokeStyle="#b6000b",i.lineWidth=3,i.moveTo(-s*2/3,-s),i.lineTo(-s*2/3+s*4/3*(e.health/e.maxHealth),-s),i.stroke()}function Pe(e,s){if(!i||a.empty(e))return;let r=Math.PI/2,o=-r;if(e.factoryTicks>0&&e.factoryTicks<a.FACTORY_TICKS_MAX){let u=2*(e.factoryTicks/a.FACTORY_TICKS_MAX)*Math.PI-r;i.beginPath(),i.strokeStyle="#888888",i.lineWidth=2,i.arc(0,0,s*0.9,o,u),i.stroke()}if(e.coilgunTicks>0&&e.coilgunTicks<a.COILGUN_TICKS_MAX){let u=2*(e.coilgunTicks/a.COILGUN_TICKS_MAX)*Math.PI-r;i.beginPath(),i.strokeStyle="#884400",i.lineWidth=2,i.arc(0,0,s*0.8,o,u),i.stroke()}if(e.coilgunTicks>=a.COILGUN_TICKS_MAX&&e.coilgunCharge>0){let u=2*(e.coilgunCharge/a.COILGUN_CHARGE_MAX)*Math.PI-r;i.beginPath(),i.strokeStyle="#ffcc00",i.lineWidth=2,i.arc(0,0,s*0.8,o,u),i.stroke()}if(e.solar>0||e.solarTicks>0){let u=2*(e.solarTicks/a.SOLAR_TICKS_MAX)*Math.PI-r;i.beginPath(),i.strokeStyle="#4444ff",i.lineWidth=2,i.arc(0,0,s*0.7,o,u),i.stroke()}if(e.mines<e.maxMines&&e.mineTicks>0){let u=2*(e.mineTicks/a.MINE_TICKS_MAX)*Math.PI-r;i.beginPath(),i.strokeStyle="#666666",i.lineWidth=2,i.arc(0,0,s*0.6,o,u),i.stroke()}}function We(e){if(e.view.rotation+=e.view.rotationSpeed/10+0.01,e.view.rotation>=Math.PI*2)e.view.rotation-=Math.PI*2}function xe(e){return e?40:25}class a{static MINE_TICKS_MAX=2000;static FACTORY_TICKS_MAX=8000;static SOLAR_TICKS_MAX=1000;static COILGUN_TICKS_MAX=1000;static COILGUN_CHARGE_MAX=1000;static findArea(e){if(!t)return;let s=0;while(a.isWithinDistanceOfAny(e,e.x,e.y,75)){if(s++,s>40){console.log("too many planets");return}e.x=a.xAreaAllowed(),e.y=a.yAreaAllowed()}}static xAreaAllowed(){if(!t)return 0;let e=t.canvasWidth*0.8;return Math.random()*(e-200)}static yAreaAllowed(){if(!t)return 0;let e=t.canvasHeight*0.8;return Math.random()*(e-55)+10}static isWithinDistanceOfAny(e,s,r,o){if(!t)return!1;for(let d=0;d<t.space.planets.length;d++){let u=t.space.planets[d];if(!u||u===e)continue;if(B(s,r,u.x,u.y,o))return!0}return!1}static tick(e){a.regenShields(e),a.tickResources(e),We(e)}static empty(e){return e.dirt<=0}static alive(e){return e.health>0}static regenShields(e){if(!a.alive(e)){e.atmo=0;return}if(e.atmo+=(e.maxAtmo-e.atmo)/100,e.atmo>e.maxAtmo)e.atmo=e.maxAtmo}static getShieldReduction(e){return e.atmo/e.maxAtmo}static takeDamage(e,s){let r=a.getShieldReduction(e),o=s*(1-r);e.atmo-=s*r;let d=0;if(e.atmo<0)d=e.atmo*-1,e.atmo=0;if(e.health-=o+d,e.health<0)e.health=0}static calcPower(e,s){e.power=s*(e.isBoss?1.5:1),e.atmo=e.maxAtmo=Math.min(200,g(e.power*2+100)),e.health=e.maxHealth=g(e.power*20+1000),e.dirt=g(e.power*200+2000),e.maxMines=Math.floor((e.dirt+0.1)/1000)}static workConstruction(e,s){if(!a.doneFactory(e)){a.workOnFactory(e,s);return}if(!a.doneCoilgun(e)){a.workOnCoilgun(e,s);return}a.workOnMine(e,s)}static tickResources(e){if(a.empty(e))return;a.tickMines(e),a.tickBots(e),a.tickFactory(e),a.tickSolar(e),a.tickCoilgun(e)}static doneBuilding(e){return e.mines>=e.maxMines||a.empty(e)}static workOnMine(e,s){if(e.mineTicks+=s,e.mineTicks>=a.MINE_TICKS_MAX){let r=Math.floor(e.mineTicks/a.MINE_TICKS_MAX);r=Math.min(r,e.maxMines-e.mines),e.mines+=r,e.mineTicks-=r*a.MINE_TICKS_MAX}}static tickMines(e){e.ore+=e.mines}static tickBots(e){let s=Math.min(e.bots,e.ore);e.ore-=s,a.workOnSolar(e,s)}static doneFactory(e){return e.factoryTicks>=a.FACTORY_TICKS_MAX}static workOnFactory(e,s){e.factoryTicks+=s}static tickFactory(e){if(e.ore>=200){let s=Math.floor(e.ore/200);e.bots+=s,e.ore-=s*200}}static workOnSolar(e,s){if(e.solarTicks+=s,e.solarTicks>=a.SOLAR_TICKS_MAX){let r=Math.floor(e.solarTicks/a.SOLAR_TICKS_MAX);e.solar+=r,e.solarTicks-=r*a.SOLAR_TICKS_MAX}}static tickSolar(e){e.coilgunCharge+=e.solar}static doneCoilgun(e){return e.coilgunTicks>=a.COILGUN_TICKS_MAX}static workOnCoilgun(e,s){e.coilgunTicks+=s}static tickCoilgun(e){if(e.coilgunCharge>=a.COILGUN_CHARGE_MAX){let s=Math.floor(e.coilgunCharge/a.COILGUN_CHARGE_MAX);e.coilgunCharge-=s*a.COILGUN_CHARGE_MAX;let r=500*s;if(e.dirt<=r)r=e.dirt;if(e.dirt-=r,t&&t.spaceStation.orbiting[1])t.spaceStation.orbiting[1].amount+=r}}}class W{isBoss=!1;view;x;y;mines=0;mineTicks=0;ore=0;bots=0;factoryTicks=0;solarTicks=0;solar=0;energy=0;coilgunTicks=0;coilgunCharge=0;id;power=0;atmo=0;maxAtmo=0;health=0;maxHealth=0;dirt=0;maxMines=0;constructor(){this.view={rotation:0,rotationSpeed:Math.random(),color:Math.floor(Math.random()*360),light:Math.floor(Math.random()*15+40)},this.x=a.xAreaAllowed(),this.y=a.yAreaAllowed(),a.findArea(this)}}class H{planets;ships;sector;allEmpty;constructor(){this.planets=[],this.ships=[],this.sector=0,this.allEmpty=!1}tick(){let e=this.planets[m.globalTargetIndex];if(!e||a.doneBuilding(e))m.updateGlobalTarget();if(!this.allEmpty){let s=!0;for(let r=0;r<this.planets.length;r++)if(a.tick(this.planets[r]),s&&!a.empty(this.planets[r]))s=!1;this.allEmpty=s}if(this.allEmpty&&this.ships.length===0)this.sector++,this.newLevel();for(let s=0;s<this.ships.length;s++)m.tick(this.ships[s])}spawnShip(e,s){e.x=-120,e.y=s,this.ships.push(e)}newLevel(){this.allEmpty=!1,this.planets=[];for(let s=0;s<10;s++){let r=new W;this.planets.push(r)}Ne(this.planets,"x");let e=this.planets[this.planets.length-1];if(e)e.isBoss=!0;for(let s=0;s<this.planets.length;s++)a.calcPower(this.planets[s],this.sector)}}class O{ice;buyable;gain;max;transferred;buyIncome=0;constructor(){this.ice=0,this.buyable=1000,this.gain=10,this.max=1000,this.transferred=0}tick(){if(this.buyIncome=0,this.buyable+=this.gain,this.buyable>this.max)this.buyable=this.max}transferWater(){return this.transferred=this.ice/1000,this.ice-=this.transferred,this.transferred}buyIce(e){if(this.buyable<e)e=this.buyable;return this.buyable-=e,this.ice+=e,this.buyIncome+=e,e}findIceSeller(e){this.max+=e*200,this.gain+=e}}class _{indoor;outdoor;maxIndoor;selling;excess;gain;waterSpending=0;transferred=0;constructor(){this.indoor=0,this.outdoor=0,this.maxIndoor=50,this.selling=0,this.excess=0,this.gain=0}tick(e){if(this.indoor+=e,this.excess=this.indoor-this.maxIndoor,this.excess>0)this.indoor=this.maxIndoor,this.outdoor+=this.excess;else this.excess=0;this.selling=this.indoor/100,this.waterSpending+=this.selling,this.indoor-=this.selling;let s=this.selling*2;if(this.gain+=s,t)t.cash+=s}transferWater(){return this.transferred=this.outdoor/1000,this.outdoor-=this.transferred,this.transferred}sellWater(e){if(this.indoor<e)e=this.indoor;this.indoor-=e,this.waterSpending+=e;let s=this.getPrice(e);if(this.gain+=s,t)t.cash+=s}getPrice(e){return e*2}}class U{water;initialStormTimer;stormTimer;stormRate;storming;initialStormDuration;stormDuration;transferred;lightningChance;lightningStrength;constructor(){this.water=0,this.initialStormTimer=300,this.stormTimer=300,this.stormRate=0,this.storming=0,this.initialStormDuration=60,this.stormDuration=60,this.transferred=0,this.lightningChance=0,this.lightningStrength=0}tick(e){this.water+=e,this.nextStormTimer(),this.tickLightning()}tickLightning(){if(this.lightningChance+=0.01*this.stormRate/100,this.lightningStrength=this.water*0.01,this.stormRate===100&&this.lightningChance>Math.random()*100){if(this.lightningChance=0,t)t.energy.gainEnergy(this.lightningStrength)}}transferWater(){return this.transferred=this.water/500*this.stormRate/100,this.water-=this.transferred,this.transferred}nextStormTimer(){if(this.stormTimer>0)this.stormTimer--;else if(this.stormDuration>0)this.storming=1;if(this.stormRate>=100)if(this.storming=0,this.stormDuration>0)this.storming=0,this.stormDuration--;else this.storming=-1;else if(this.stormRate<=0&&this.storming===-1)this.stormDuration=this.initialStormDuration,this.stormTimer=this.initialStormTimer,this.storming=0;this.stormRate+=this.storming}gainStormDuration(e){this.stormDuration+=e,this.initialStormDuration+=e}}class M{land;baseLand;optimizedLand;water;soil;transferred;convertedLand=0;constructor(e){this.land=e,this.baseLand=e,this.optimizedLand=e,this.water=0,this.soil=0,this.transferred=0}tick(e){this.water+=e,this.turnLandToSoil()}turnLandToSoil(){if(this.convertedLand=this.water/1000,this.land<this.convertedLand)this.convertedLand=this.land;this.land-=this.convertedLand,this.soil+=this.convertedLand,this.water-=this.convertedLand}transferWater(){return this.transferred=this.water/1000,this.water-=this.transferred,this.transferred}improveLand(){let e=(10*this.baseLand-this.optimizedLand)/100;this.optimizedLand+=e,this.land+=e}addLand(e){this.optimizedLand+=e,this.land+=e,this.baseLand+=e}}class ${water;ferns;fernsDelta;fernsWaterUse;smallTrees;smallTreesDelta;smallTreesWaterUse;trees;treesDelta;treesWaterUse;totalPlants;oxygenGain;waterSpending=0;transferred=0;constructor(){this.water=0,this.ferns=0,this.fernsDelta=0,this.fernsWaterUse=0,this.smallTrees=0,this.smallTreesDelta=0,this.smallTreesWaterUse=0,this.trees=0,this.treesDelta=0,this.treesWaterUse=0,this.totalPlants=0,this.oxygenGain=0}tick(e){if(this.waterSpending=0,this.water+=e,this.plantGrowth(),this.oxygenGain=this.ferns/1000+3*this.smallTrees/1000+this.trees/100,t)t.oxygen+=this.oxygenGain}plantGrowth(){if(!t)return;if(this.totalPlants=this.ferns+this.smallTrees+this.trees,this.treesDelta=this.smallTrees/1000,this.smallTreesDelta=this.ferns/1000-this.treesDelta,this.fernsDelta=(t.land.soil-this.totalPlants)/1000-this.ferns/1000,this.fernsWaterUse=(t.land.soil-this.totalPlants)/1000,this.fernsWaterUse=this.fernsWaterUse<0?0:this.fernsWaterUse,this.smallTreesWaterUse=this.ferns/1000,this.treesWaterUse=this.smallTrees/1000,this.fernsDelta<0){let e=0;if(this.ferns+this.fernsDelta<0)e=this.fernsDelta+this.ferns,this.fernsDelta=-1*this.ferns;if(this.smallTreesDelta+=e,e=0,this.smallTrees+this.smallTreesDelta<0)e=this.smallTrees+this.smallTreesDelta,this.smallTreesDelta=-1*this.smallTrees;this.treesDelta+=e}if(this.water<this.treesWaterUse)this.treesDelta=this.treesDelta>0?this.water:this.treesDelta,this.treesWaterUse=this.water;if(this.trees+=this.treesDelta,this.water-=this.treesWaterUse,this.waterSpending+=this.treesWaterUse,this.water<this.smallTreesWaterUse)this.smallTreesDelta=this.smallTreesDelta>0?this.water:this.smallTreesDelta,this.smallTreesWaterUse=this.water;if(this.smallTrees+=this.smallTreesDelta,this.water-=this.smallTreesWaterUse,this.waterSpending+=this.smallTreesWaterUse,this.water<this.fernsWaterUse)this.fernsDelta=this.fernsDelta>0?this.water:this.fernsDelta,this.fernsWaterUse=this.water;this.ferns+=this.fernsDelta,this.water-=this.fernsWaterUse,this.waterSpending+=this.fernsWaterUse}transferWater(){return this.transferred=this.water/1000,this.water-=this.transferred,this.transferred}}class A{water;farms;food;foodCreated;efficiency;farmRatio;waterSpending=0;transferred=0;constructor(){this.water=0,this.farms=0,this.food=0,this.foodCreated=0,this.efficiency=1,this.farmRatio=0}tick(e){this.waterSpending=0,this.water+=e,this.gainFood()}transferWater(){return this.transferred=this.water/1000,this.water-=this.transferred,this.transferred}gainFood(){if(this.foodCreated=this.farms/100*this.efficiency,this.foodCreated>this.water)this.foodCreated=this.water;this.waterSpending+=this.foodCreated,this.water-=this.foodCreated,this.food+=this.foodCreated}addFarm(e){this.farms+=e,t?.events.emit("farms:updated")}updateFarms(e){let s=e+this.farms*50,r=Math.floor(s*this.farmRatio/100/50),o=r-this.farms;if(o!==0)return this.farms=r,t?.events.emit("farms:updated"),o*50;return 0}improve(){this.efficiency+=0.02,t?.events.emit("farms:updated")}}class G{people;foodEaten;popGrowth;starving;scienceRatio;scienceDelta;cashDelta;happiness;houseBonus;happinessFromTrees=0;happinessFromOxygen=0;constructor(){this.people=0,this.foodEaten=0,this.popGrowth=0,this.starving=0,this.scienceRatio=0,this.scienceDelta=0,this.cashDelta=0,this.happiness=1,this.houseBonus=1}tick(){if(!t)return;if(this.foodEaten=this.people/100,this.foodEaten>t.farms.food)this.starving=this.foodEaten-t.farms.food,this.foodEaten=t.farms.food;else this.starving=0;t.farms.food-=this.foodEaten,this.popGrowth=(t.farms.food-this.people)/1000-this.starving/100,this.people+=this.popGrowth,this.updateHappiness(),this.tickRatio()}updateHappiness(){if(!t)return;this.happinessFromTrees=Math.log10(t.trees.trees+1)/10,this.happinessFromOxygen=Math.log10(t.oxygen+1)/20,this.happiness=this.houseBonus*(1+this.happinessFromTrees+this.happinessFromOxygen)}tickRatio(){if(!t)return;this.scienceDelta=this.people/100*(100-this.scienceRatio)/100*this.happiness,this.cashDelta=this.people/100*this.scienceRatio/100*this.happiness,t.science+=this.scienceDelta,t.cash+=this.cashDelta}improveHouse(){this.houseBonus+=0.1}}class x{text;tooltip;currentTicks=0;ticksNeeded;threads;cost;costType;completions=0;isMoving=!1;finish;showing;done;constructor(e){this.text=e.text||"",this.tooltip=e.tooltip||"",this.currentTicks=e.currentTicks||0,this.ticksNeeded=e.ticksNeeded||0,this.threads=e.threads||0,this.cost=e.cost||0,this.costType=e.costType||"",this.finish=e.finish||(()=>{}),this.showing=e.showing||(()=>!0),this.done=e.done}}class X{unlocked;threads;freeThreads;speed;processes;cashSpending=0;scienceSpending=0;metalSpending=0;woodSpending=0;constructor(){this.unlocked=0,this.threads=1,this.freeThreads=1,this.speed=1,this.processes=[new x({text:"Optimize Land",tooltip:"Improve 1% of unimproved land.<br>Max to improve to is ( 10 x base land )<br>Percent Optimized: <div id='landOptimized'></div>",ticksNeeded:600,finish:function(){if(t)t.land.improveLand();if(t)this.ticksNeeded=Math.floor(t.land.baseLand);t?.events.emit("computer:optimize-land:updated")}}),new x({text:"Buy Ice",tooltip:"Buy available ice",ticksNeeded:50,finish:function(){if(t)t.buyIce()}}),new x({text:"Sell Water",tooltip:"Sells up to 50 water",ticksNeeded:50,finish:function(){if(t)t.water.sellWater(50)}}),new x({text:"Improve Farms",tooltip:"Farm efficiency increases by 2%",ticksNeeded:40,finish:function(){if(t)t.farms.improve();this.ticksNeeded=g(20*(this.completions+2)+Math.pow(this.completions,2)/10)}}),new x({text:"Find more Ice Sellers",tooltip:"Gain 200 buyable ice and 1 more per tick",ticksNeeded:2000,cost:0.5,costType:"cash",finish:function(){if(t)t.ice.findIceSeller(1)}}),new x({text:"Bigger Storms",tooltip:"Storms last 5 more ticks. Max 300 duration.",ticksNeeded:600,cost:2,costType:"science",finish:function(){if(t)t.clouds.gainStormDuration(5);this.cost+=0.5,this.ticksNeeded+=50},done:function(){return t?t.clouds.initialStormDuration>=300:!1},showing:function(){return!this.done?.()}}),new x({text:"Build Robots",tooltip:"Builds a robot",ticksNeeded:1e4,cost:0.01,costType:"metal",finish:function(){if(t)t.robots.gainRobots(1)},showing:function(){return t?t.robots.unlocked!==0:!1},done:function(){return t?t.robots.robots>=t.robots.robotMax:!1}}),new x({text:"More Robot Storage",tooltip:"Can hold 5 more robots",ticksNeeded:20000,cost:0.5,costType:"wood",finish:function(){if(t)t.robots.gainStorage(5);this.ticksNeeded+=2000},showing:function(){return t?t.robots.unlocked!==0:!1}}),new x({text:"Improve House Design",tooltip:"Improves base happiness modifier by .1",ticksNeeded:3000,cost:10,costType:"science",finish:function(){if(t)t.population.improveHouse();this.ticksNeeded+=500},showing:function(){return t?t.robots.unlocked!==0:!1}}),new x({text:"Improve Ship engines",tooltip:"Ship speed increases by 0.1 and empty ship speed by 0.01",ticksNeeded:20000,cost:1e4,costType:"science",finish:function(){if(t)t.spaceDock.improveEngines(0.1,0.01);this.cost+=5000,this.ticksNeeded+=1000},done:function(){return t?t.spaceDock.defaultSpeed>=1:!1},showing:function(){return!this.done?.()&&(t?t.spaceDock.unlocked!==0:!1)}})]}tick(){this.cashSpending=0,this.scienceSpending=0,this.metalSpending=0,this.woodSpending=0;for(let e=0;e<this.processes.length;e++){let s=this.processes[e];this.tickRow(s,this.speed*s.threads)}}tickRow(e,s){if(!t)return;if(s===0){e.isMoving=!1;return}if(e.done&&e.done()){if(e.isMoving=!1,e.threads>0)this.freeThreads+=e.threads,e.threads=0;t.events.emit("computer:threads:updated");return}e.isMoving=!0;let r=s*e.cost;if(e.costType){if(t&&t[e.costType]<r){e.isMoving=!1;return}if(t)t[e.costType]-=r;if(e.costType==="cash")this.cashSpending+=r;if(e.costType==="science")this.scienceSpending+=r;if(e.costType==="metal")this.metalSpending+=r;if(e.costType==="wood")this.woodSpending+=r}e.currentTicks+=s;while(e.currentTicks>=e.ticksNeeded){let o=e.currentTicks-e.ticksNeeded;e.currentTicks=0,e.completions++,e.finish(),e.currentTicks=o}}unlockComputer(){if(!t)return;if(t.science>=1000)t.science-=1000,this.unlocked=1,t.events.emit("computer:unlocked")}buyThread(){if(!t)return;let e=this.getThreadCost();if(t.cash>=e)t.cash-=e,this.threads++,this.freeThreads++,t.events.emit("computer:threads:updated")}getThreadCost(){return be(Math.pow(2,this.threads)*500)}buySpeed(){if(!t)return;let e=this.getSpeedCost();if(t.science>=e)t.science-=e,this.speed++,t.events.emit("computer:speed:updated")}getSpeedCost(){return be(Math.pow(2,this.speed)*500)}addThread(e,s){s=Math.min(s,this.freeThreads);let r=this.processes[e];if(r)r.threads+=s,this.freeThreads-=s,t?.events.emit("computer:threads:updated")}removeThread(e,s){let r=this.processes[e];if(r)s=Math.min(s,r.threads),r.threads-=s,this.freeThreads+=s,t?.events.emit("computer:threads:updated")}}class L{text;tooltip;workers;currentTicks=0;ticksNeeded=0;cost;costType;isMoving=!1;completions=0;finish;showing;done;during;constructor(e){this.text=e.text||"",this.tooltip=e.tooltip||"",this.workers=e.workers||0,this.ticksNeeded=e.ticksNeeded||0,this.cost=e.cost,this.costType=e.costType,this.finish=e.finish||(()=>{}),this.showing=e.showing||(()=>!0),this.done=e.done,this.during=e.during}}class K{robots;robotsFree;robotMax;unlocked;mines;jobs;woodIncome=0;woodSpending=0;metalIncome=0;metalSpending=0;oreIncome=0;oreSpending=0;oxygenSpending=0;constructor(){this.robots=0,this.robotsFree=0,this.robotMax=5,this.unlocked=0,this.mines=0,this.jobs=[new L({text:"Cut Trees",tooltip:"Cut down 2 trees for 1 wood",finish:function(){if(t)t.robots.cutTrees(this.workers)}}),new L({text:"Expand indoor water storage",tooltip:"Gives 50 more max indoor water.<br>Cost increases by 1",ticksNeeded:3000,cost:[0.1],costType:["metal"],finish:function(){if(this.ticksNeeded+=1000,t)t.water.maxIndoor+=50}}),new L({text:"Build Mines",tooltip:"Build up to (total land / 1000) mines",ticksNeeded:300,cost:[1],costType:["wood"],finish:function(){if(t)t.robots.mines++;this.ticksNeeded+=100},done:function(){return t?t.robots.mines*1000>=t.land.optimizedLand:!1}}),new L({text:"Mine Ore",tooltip:"Get (mines / 100) ore per tick",finish:function(){if(t)t.robots.mineOre(this.workers)}}),new L({text:"Smelt Ore",tooltip:"Each tick costs 5 wood, 1 ore, and 1000 oxygen<br>Gain 1 metal",finish:function(){if(t)t.robots.smeltOre(this.workers)}}),new L({text:"Turn ore into dirt",tooltip:"Each tick costs 1 energy and 1000 ore<br>Gain 5 Base Land<br>Total land gained: <span id='totalDirtFromOre'></span>",ticksNeeded:1000,during:function(){if(t&&t.power>=1*this.workers&&t.ore>=this.workers*1000)return t.power-=1*this.workers,t.ore-=this.workers*1000,t.robots.oreSpending+=this.workers*1000,!0;return!1},finish:function(){if(t)t.land.addLand(50)},showing:function(){return t?t.energy.unlocked!==0:!1}})]}tick(){this.woodIncome=0,this.woodSpending=0,this.metalIncome=0,this.metalSpending=0,this.oreIncome=0,this.oreSpending=0,this.oxygenSpending=0;for(let e=0;e<this.jobs.length;e++)this.tickRow(this.jobs[e],this.jobs[e].workers)}tickRow(e,s){if(s===0||e.done&&e.done()){e.isMoving=!1;return}if(e.ticksNeeded===0){e.finish();return}if(e.during&&!e.during()){e.isMoving=!1;return}if(e.cost&&e.costType){for(let r=0;r<e.cost.length;r++){let o=s*e.cost[r],d=e.costType[r];if(d){if(t&&t[d]<o){e.isMoving=!1;return}}}for(let r=0;r<e.cost.length;r++){let o=e.costType[r],d=s*e.cost[r];if(t)t[o]-=d;if(o==="wood")this.woodSpending+=d;if(o==="metal")this.metalSpending+=d}}if(e.currentTicks+=s,e.isMoving=!0,e.currentTicks>=e.ticksNeeded){let r=e.currentTicks-e.ticksNeeded;e.currentTicks=0,e.completions++,e.finish(),t?.events.emit("robots:count:updated"),this.tickRow(e,r)}}gainRobots(e){this.robots+=e,this.robotsFree+=e,t?.events.emit("robots:count:updated")}gainStorage(e){this.robotMax+=e,t?.events.emit("robots:storage:updated")}unlockRobots(){if(!t)return;if(t.cash>=3000)t.cash-=3000,this.unlocked=1,t.events.emit("robots:unlocked"),this.gainRobots(1);t.events.emit("robots:count:updated"),t.events.emit("robots:storage:updated")}addWorker(e,s){let r=this.jobs[e];if(r)s=Math.min(s,this.robotsFree),r.workers+=s,this.robotsFree-=s;t?.events.emit("robots:count:updated")}removeWorker(e,s){let r=this.jobs[e];if(r)s=Math.min(s,r.workers),r.workers-=s,this.robotsFree+=s;t?.events.emit("robots:count:updated")}cutTrees(e){if(t&&t.trees.trees>=2*e)t.trees.trees-=2*e,t.wood+=e,this.woodIncome+=e}mineOre(e){if(t){let s=t.robots.mines/100*e;t.ore+=s,this.oreIncome+=s}}smeltOre(e){if(t&&t.wood>=5*e&&t.ore>=e&&t.oxygen>=e*1000)t.wood-=5*e,t.ore-=e,t.oxygen-=1000*e,t.metal+=e,this.woodSpending+=5*e,this.oreSpending+=e,this.oxygenSpending+=1000*e,this.metalIncome+=e}}class j{unlocked;battery;drain=0;constructor(){this.unlocked=0,this.battery=100}unlockEnergy(){if(t&&t.metal>=500)t.metal-=500,this.unlocked=1,t.events.emit("energy:unlocked");t?.events.emit("energy:battery:updated")}tick(){if(!t)return;let e=t.power-this.battery;if(this.drain=0,e>0)this.drain=e/500,t.power-=this.drain}gainEnergy(e){if(t)t.power+=e}buyBattery(e){this.battery+=e,t?.events.emit("energy:battery:updated")}}class Y{unlocked;orbiting;waterIncome=0;constructor(){this.unlocked=0,this.orbiting=[{type:"ice",amount:1e6},{type:"dirt",amount:500}]}unlockSpaceStation(){if(t&&t.metal>=2000&&t.wood>=20000)t.metal-=2000,t.wood-=20000,this.unlocked=1,t.events.emit("spaceStation:unlocked");t?.events.emit("spaceStation:updated")}tick(){if(this.waterIncome=0,!this.unlocked||!t)return;for(let e=0;e<this.orbiting.length;e++){let s=this.orbiting[e],r=s.amount/1e5;s.amount-=r;let o=s.type;if(o==="ice")t.ice.ice+=r,this.waterIncome+=r;else if(o==="dirt")t.land.addLand(r)}}}class q{unlocked;cometSpotChance;takeAmount;comets;constructor(){this.unlocked=0,this.cometSpotChance=0.006,this.takeAmount=[{type:"ice",amount:0},{type:"dirt",amount:0}],this.comets=[]}tick(){if(!this.unlocked||!t)return;if(this.checkForNewAsteroids(),this.comets.length){let e=t.power/1000;t.power-=this.pullIntoOrbit(e),this.removeAsteroidIfDone()}}unlockTractorBeam(){if(!t)return;if(t.science>=500000&&t.oxygen>=5000000)t.science-=500000,t.oxygen-=2000000,this.unlocked=1,t.events.emit("tractorBeam:unlocked"),t.spaceDock.unlocked=1,t.events.emit("spaceDock:unlocked");t.events.emit("tractorBeam:updated")}pullIntoOrbit(e){if(!t)return 0;let s=e/this.comets.length,r=0;for(let o=0;o<t.spaceStation.orbiting.length;o++){let d=t.spaceStation.orbiting[o],u=0;for(let f=0;f<this.comets.length;f++){let b=this.comets[f];if(b.amountType===d.type){let E=Math.min(s,b.amount);r+=E,b.amount-=E,u+=E}}d.amount+=u;let l=this.takeAmount.find((f)=>f.type===d.type);if(l)l.amount=u;else this.takeAmount.push({type:d.type,amount:u})}return r}checkForNewAsteroids(){if(Math.random()<this.cometSpotChance)this.addComet()}removeAsteroidIfDone(){let e=this.comets.length-1;for(let s=e;s>=0;s--){let r=this.comets[s];if(r.duration--,r.duration<0||r.amount<1){if(r.drawed)t?.events.emit("tractorBeam:removeComet",r);this.comets.splice(s,1)}}}addComet(){if(!t||this.comets.length>20)return;let e=Math.random(),s=Math.random()*100*t.space.sector+200,r=Math.floor(Math.random()*800+400),o=Math.random()*2+1,d={};if(e<0.9)d={name:"Comet",amountType:"ice",amount:s*1000,initialAmount:s*1000,duration:r,initialDuration:r,speed:o};else d={name:"Asteroid",amountType:"dirt",amount:s,initialAmount:s,duration:r*2,initialDuration:r*2,speed:o/2};d.id=He(),d.drawed=!1,this.comets.push(d)}}class Q{battleships;unlocked;sended;defaultSpeed=0.5;emptySpeed=0.05;constructor(){this.battleships=0,this.unlocked=0,this.sended=0}addBattleship(e){this.battleships+=e,t?.events.emit("spaceDock:updated")}improveEngines(e,s){this.defaultSpeed+=e,this.emptySpeed+=s,t?.events.emit("spaceDock:updated")}}class Z{count;food;actionCounter;energy;x;y;engaged;direction;targetIndex;constructor(e,s,r){this.count=e,this.food=s/r,this.actionCounter=0,this.energy=0,this.x=0,this.y=0,this.engaged=!1,this.direction=0,this.targetIndex=-1}}class J{sendRate;timeRemaining;totalTime;y;constructor(){this.sendRate=1,this.timeRemaining=this.totalTime=40,this.y=(t?.canvasHeight||600)*0.5-25}tick(){if(!t)return;if(this.y=t.canvasHeight*0.5-25,this.timeRemaining--,this.timeRemaining<0)if(t.spaceDock.battleships>0&&!t.space.allEmpty){let e=Math.min(this.sendRate,t.spaceDock.battleships),s=t.farms.food*0.05;t.farms.food-=s;let r=new Z(e,s,m.foodPerShip);r.targetIndex=m.globalTargetIndex,t.space.spawnShip(r,this.y),t.spaceDock.battleships-=e,t.spaceDock.sended+=e,t.events.emit("spaceDock:updated"),this.timeRemaining=this.totalTime}else this.timeRemaining=0}getTarget(){return{isHome:!0,x:-125,y:this.y}}}class N{aProgress;color;lastPercentage=-1;constructor(e,s){this.aProgress=document.getElementById(e),this.color=s}tick(e,s){if(!this.aProgress||s<=0)return;let r=e/s;if(Math.abs(this.lastPercentage-r)<0.001)return;this.lastPercentage=r,this.reset(this.aProgress),this.drawProgress(this.aProgress,r,this.color)}reset(e){if(!e)return;let s=e.getContext("2d");if(!s)return;s.lineCap="square";let r=e.width/2,o=e.width/2-5;s.beginPath(),s.lineWidth=8,s.fillStyle="#1e1e1e",s.arc(r,r,o,0,2*Math.PI),s.fill()}drawProgress(e,s,r){if(!e)return;let o=e.getContext("2d");if(!o)return;let d=Math.PI/2,u=2*s*0.95*Math.PI-d*0.9,l=0-d*0.9,f=e.width/2,b=e.width/2-10;o.lineCap="square",o.beginPath(),o.lineWidth=8,o.strokeStyle=r,o.arc(f,f,b,l,u),o.stroke()}}class h{textCache=new Map;elementCache=new Map;clearCache(){this.textCache.clear(),this.elementCache.clear()}getElement(e){let s=this.elementCache.get(e);if(!s){let r=document.getElementById(e);if(!r)throw Error(`Element ${e} not found`);s=r,this.elementCache.set(e,s)}return s}updateElementText(e,s){if(this.textCache.get(e)===s)return;this.getElement(e).textContent=s,this.textCache.set(e,s)}setVisible(e,s){let r=this.getElement(e);if(s)r.classList.remove("hidden");else r.classList.add("hidden")}}class D extends h{constructor(){super();if(t)t.events.on("computer:unlocked",()=>this.checkUnlocked()),t.events.on("computer:threads:updated",()=>this.updateThreads()),t.events.on("computer:speed:updated",()=>this.updateSpeed()),t.events.on("computer:optimize-land:updated",()=>this.updateLandOptimized())}checkUnlocked(){if(!t)return;if(t.computer.unlocked)this.setVisible("unlockedComputer",!0),this.setVisible("unlockComputer",!1),this.setVisible("robotsContainer",!0),this.updateThreads(),this.updateSpeed();else this.setVisible("unlockedComputer",!1),this.setVisible("unlockComputer",!0),this.setVisible("robotsContainer",!1)}updateLandOptimized(){if(!t)return;this.updateElementText("landOptimized",Be(t.land.optimizedLand/(t.land.baseLand*10)*100)+"%")}updateThreads(){if(!t)return;this.updateElementText("freeThreads",n(t.computer.freeThreads)),this.updateElementText("threads",n(t.computer.threads)),this.updateElementText("threadCost",n(t.computer.getThreadCost()));for(let e=0;e<t.computer.processes.length;e++){let s=t.computer.processes[e];if(!s)continue;this.updateElementText("computerRow"+e+"Threads",n(s.threads)),this.setVisible("computerRow"+e+"Container",s.showing())}}updateSpeed(){if(!t)return;this.updateElementText("speed",n(t.computer.speed)),this.updateElementText("speedCost",n(t.computer.getSpeedCost()))}update(){this.updateThreads(),this.updateSpeed(),this.updateLandOptimized()}updateRowProgress(e){if(!t||!t.computer.unlocked)return;let s=t.computer.processes[e];if(!s||!s.showing())return;let r="computerRow"+e,o=this.getElement(r+"PB");o.style.width=s.currentTicks/s.ticksNeeded*100+"%",o.style.backgroundColor=s.isMoving?"yellow":"red",this.updateElementText(r+"CurrentTicks",n(s.currentTicks)),this.updateElementText(r+"TicksNeeded",n(s.ticksNeeded));let d=this.getElement(r+"CostContainer");if(s.cost!==0)d.classList.remove("hidden"),this.updateElementText(r+"Cost",n(s.cost)),this.updateElementText(r+"CostType",s.costType);else d.classList.add("hidden")}addComputerRow(e){let s=this.getElement("computerRows"),r=document.createElement("div");r.className="computerRow";let o="computerRow"+e;r.id=o+"Container";let d=document.createElement("button");d.id=o+"Plus",d.innerHTML="+",d.addEventListener("click",(k)=>t?.computer.addThread(e,v(k)));let u=document.createElement("button");u.id=o+"Minus",u.innerHTML="-",u.addEventListener("click",(k)=>t?.computer.removeThread(e,v(k)));let l=document.createElement("div");l.id=o+"Threads",l.className="small",l.style.marginRight="4px";let f=t?.computer.processes[e]?.text||"",b=document.createElement("div");b.innerHTML=f;let E=document.createElement("div");E.className="rowProgressBarOuter",E.innerHTML="<div class='rowProgressBarInner' id='"+o+"PB'></div>";let c=document.createElement("div");c.className="computerTooltipContainer",c.id=o+"Tooltip";let T=document.createElement("div");T.className="rowTooltip";let I=t?.computer.processes[e]?.tooltip||"";T.innerHTML=`
            <div class="tooltipDescription">${I}</div>
            <div class="tooltipDivider"></div>
            <div class="tooltipStats">
                <div><b>Progress:</b> <span id="${o}CurrentTicks"></span> / <span id="${o}TicksNeeded"></span> ticks</div>
                <div id="${o}CostContainer" class="hidden"><b>Cost:</b> <span id="${o}Cost"></span> <span id="${o}CostType"></span> per tick</div>
            </div>
        `,c.appendChild(T),r.appendChild(d),r.appendChild(l),r.appendChild(u);let w=document.createElement("div");w.className="rowLabel",w.appendChild(b),r.appendChild(w),r.appendChild(E),r.appendChild(c),s.appendChild(r)}}class P extends h{constructor(){super();if(t)t.events.on("robots:unlocked",()=>{this.checkUnlocked(),this.updateCount(),this.updateStorage()}),t.events.on("robots:count:updated",()=>this.updateCount()),t.events.on("robots:storage:updated",()=>this.updateStorage())}checkUnlocked(){if(!t)return;if(t.robots.unlocked)this.setVisible("unlockedRobots",!0),this.setVisible("unlockRobots",!1),this.setVisible("lightningContainer",!0),this.setVisible("lightningTooltip",!0),this.setVisible("energyContainer",!0),this.setVisible("woodContainer",!0),this.setVisible("oreContainer",!0),this.setVisible("metalContainer",!0),this.updateCount(),this.updateStorage();else this.setVisible("unlockedRobots",!1),this.setVisible("unlockRobots",!0),this.setVisible("lightningContainer",!1),this.setVisible("lightningTooltip",!1),this.setVisible("energyContainer",!1),this.setVisible("woodContainer",!1),this.setVisible("oreContainer",!1),this.setVisible("metalContainer",!1)}update(){if(!t)return}updateCount(){if(!t)return;if(this.updateElementText("robots",n(t.robots.robots)),this.updateElementText("robotsFree",n(t.robots.robotsFree)),t.robots.jobs[5])this.updateElementText("totalDirtFromOre",n(t.robots.jobs[5].completions*5));for(let e=0;e<t.robots.jobs.length;e++){let s=t.robots.jobs[e];if(!s)continue;this.updateElementText("robotRow"+e+"Workers",n(s.workers)),this.setVisible("robotRow"+e+"Container",s.showing())}this.update()}updateStorage(){if(!t)return;this.updateElementText("robotMax",n(t.robots.robotMax))}updateFull(){this.updateCount(),this.updateStorage()}updateRowProgress(e){if(!t)return;let s=t.robots.jobs[e];if(!s||!s.showing()||s.ticksNeeded===0)return;let r="robotRow"+e,o=this.getElement(r+"PB");o.style.width=s.currentTicks/s.ticksNeeded*100+"%",o.style.backgroundColor=s.isMoving?"yellow":"red",this.updateElementText(r+"CurrentTicks",n(s.currentTicks)),this.updateElementText(r+"TicksNeeded",n(s.ticksNeeded));let d=this.getElement(r+"CostContainer");if(s.cost&&s.costType){d.classList.remove("hidden");let u=n(s.cost[0]||0)+" "+(s.costType[0]||"");u+=s.cost.length>1?" and "+n(s.cost[1]||0)+" "+(s.costType[1]||""):"",this.updateElementText(r+"Cost",u)}else d.classList.add("hidden")}addRobotRow(e){let s=this.getElement("robotRows"),r=document.createElement("div");r.className="robotRow";let o="robotRow"+e;r.id=o+"Container";let d=document.createElement("button");d.id=o+"Plus",d.innerHTML="+",d.addEventListener("click",(S)=>t?.robots.addWorker(e,v(S)));let u=document.createElement("button");u.id=o+"Minus",u.innerHTML="-",u.addEventListener("click",(S)=>t?.robots.removeWorker(e,v(S)));let l=document.createElement("div");l.id=o+"Workers",l.className="small",l.style.marginRight="4px";let f=t?.robots.jobs[e]?.text||"",b=document.createElement("div");b.innerHTML=f;let E=document.createElement("div");if(t?.robots.jobs[e]?.ticksNeeded)E.className="rowProgressBarOuter",E.innerHTML="<div class='rowProgressBarInner' id='"+o+"PB'></div>";let c=document.createElement("div");c.className="computerTooltipContainer",c.id=o+"Tooltip";let T=document.createElement("div");T.className="rowTooltip";let I=t?.robots.jobs[e]?.tooltip||"",w="";if(t?.robots.jobs[e]?.ticksNeeded)w=`
                <div class="tooltipDivider"></div>
                <div class="tooltipStats">
                    <div><b>Progress:</b> <span id="${o}CurrentTicks"></span> / <span id="${o}TicksNeeded"></span> ticks</div>
                    <div id="${o}CostContainer" class="hidden"><b>Cost:</b> <span id="${o}Cost"></span> per tick</div>
                </div>
            `;T.innerHTML=`
            <div class="tooltipDescription">${I}</div>
            ${w}
        `,c.appendChild(T),r.appendChild(d),r.appendChild(l),r.appendChild(u);let k=document.createElement("div");if(k.className="rowLabel",k.appendChild(b),r.appendChild(k),E.innerHTML)r.appendChild(E);r.appendChild(c),s.appendChild(r)}}class z extends h{update(){if(!t)return;this.updateElementText("totalWater",n(t.ice.ice+t.water.indoor+t.water.outdoor+t.clouds.water+t.land.water+t.trees.water+t.farms.water)),this.updateElementText("waterIncome",n(t.spaceStation.waterIncome,4)),this.updateElementText("waterBought",n(t.ice.buyIncome,4)),this.updateElementText("waterSpending",n(t.water.waterSpending,4)),this.updateElementText("waterFarms",n(t.farms.waterSpending,4)),this.updateElementText("waterTrees",n(t.trees.waterSpending,4)),this.updateElementText("waterNet",C(t.spaceStation.waterIncome+t.ice.buyIncome-t.water.waterSpending-t.farms.waterSpending-t.trees.waterSpending,4)),this.updateElementText("cash",n(t.cash)),this.updateElementText("cashIncome",n(t.population.cashDelta+t.water.gain,4)),this.updateElementText("cashFromPeople",n(t.population.cashDelta,4)),this.updateElementText("cashFromWater",n(t.water.gain,4)),this.updateElementText("cashComputer",n(t.computer.cashSpending,4)),this.updateElementText("cashNet",C(t.population.cashDelta+t.water.gain-t.computer.cashSpending,4)),this.updateElementText("oxygen",n(t.oxygen)),this.updateElementText("oxygenIncome",n(t.trees.oxygenGain,4)),this.updateElementText("oxygenLeak",n(t.oxygenLeak,4)),this.updateElementText("oxygenSmelting",n(t.robots.oxygenSpending,4)),this.updateElementText("oxygenNet",C(t.trees.oxygenGain-t.oxygenLeak-t.robots.oxygenSpending,4)),this.updateElementText("science",n(t.science)),this.updateElementText("scienceIncome",n(t.population.scienceDelta,4)),this.updateElementText("scienceComputer",n(t.computer.scienceSpending,4)),this.updateElementText("scienceNet",C(t.population.scienceDelta-t.computer.scienceSpending,4)),this.updateElementText("wood",n(t.wood)),this.updateElementText("woodIncome",n(t.robots.woodIncome,4)),this.updateElementText("woodSpending",n(t.robots.woodSpending,4)),this.updateElementText("woodComputer",n(t.computer.woodSpending,4)),this.updateElementText("woodNet",C(t.robots.woodIncome-t.robots.woodSpending-t.computer.woodSpending,4)),this.updateElementText("metal",n(t.metal)),this.updateElementText("metalIncome",n(t.robots.metalIncome,4)),this.updateElementText("metalSpending",n(t.robots.metalSpending,4)),this.updateElementText("metalComputer",n(t.computer.metalSpending,4)),this.updateElementText("metalNet",C(t.robots.metalIncome-t.robots.metalSpending-t.computer.metalSpending,4)),this.updateElementText("ore",n(t.ore)),this.updateElementText("oreIncome",n(t.robots.oreIncome,4)),this.updateElementText("oreSpending",n(t.robots.oreSpending,4)),this.updateElementText("oreNet",C(t.robots.oreIncome-t.robots.oreSpending,4))}}class ee extends h{update(){if(!t)return;this.updateElementText("ice",n(t.ice.ice)),this.updateElementText("buyableIce",n(t.ice.buyable)),this.updateElementText("iceTransferred",n(t.ice.transferred,4)),this.updateElementText("indoorWaterReceived",n(t.ice.transferred,4)),this.updateElementText("iceBuyerAmount",n(t.ice.gain))}}class te extends h{update(){if(!t)return;this.updateElementText("indoorWater",n(t.water.indoor)),this.updateElementText("indoorWaterMax",n(t.water.maxIndoor)),this.updateElementText("indoorWaterSelling",n(t.water.selling)),this.updateElementText("indoorWaterProfits",n(t.water.gain)),this.updateElementText("excessWater",n(t.water.excess,4))}}class se extends h{update(){if(!t)return;this.updateElementText("clouds",n(t.clouds.water)),this.updateElementText("stormTimer",n(t.clouds.stormTimer)),this.updateElementText("stormRate",t.clouds.stormRate+"%"),this.getElement("intensityPB").style.height=t.clouds.stormRate+"%",this.updateElementText("stormDuration",n(t.clouds.stormDuration)),this.updateElementText("rain",n(t.clouds.transferred,4)),this.updateElementText("landReceived",n(t.clouds.transferred,4)),this.updateElementText("lightningChance",n(t.clouds.lightningChance)+"%"),this.getElement("lightningPB").style.height=t.clouds.lightningChance+"%",this.updateElementText("lightningStrength",n(t.clouds.lightningStrength))}}class re extends h{update(){if(!t)return;this.updateElementText("outdoorWater",n(t.water.outdoor)),this.updateElementText("lakeWaterFromStorage",n(t.water.excess,4)),this.updateElementText("waterTransferred",n(t.water.transferred,4)),this.updateElementText("cloudsReceived",n(t.water.transferred,4)),this.updateElementText("landWater",n(t.land.water)),this.updateElementText("optimizedLand",n(t.land.optimizedLand)),this.updateElementText("baseLand",n(t.land.baseLand)),this.updateElementText("land",n(t.land.land)),this.updateElementText("soil",n(t.land.soil)),this.updateElementText("landConverted",n(t.land.convertedLand,4)),this.updateElementText("landWaterToForest",n(t.land.transferred,4)),this.updateElementText("forestReceived",n(t.land.transferred,4)),this.updateElementText("landWaterToFarm",n(t.land.transferred,4)),this.updateElementText("farmReceived",n(t.land.transferred,4)),this.updateElementText("farmsWater",n(t.farms.water)),this.updateElementText("food",n(t.farms.food)),this.updateElementText("foodCreated",n(t.farms.foodCreated,4)),this.updateElementText("farmFoodEaten",n(t.population.foodEaten,4)),this.updateElementText("farmWaterToLake",n(t.farms.transferred,4)),this.updateElementText("lakeWaterFromFarm",n(t.farms.transferred,4)),this.updateElementText("farms",n(t.farms.farms)),this.updateElementText("efficiency",n(t.farms.efficiency*100)),this.updateElementText("farmRatioLabel",t.farms.farmRatio+"% soil to farms")}}class ne extends h{update(){if(!t)return;this.updateElementText("population",n(t.population.people)),this.updateElementText("foodEaten",n(t.population.foodEaten,4)),this.updateElementText("populationGrowth",C(t.population.popGrowth,4)),this.updateElementText("starving",n(t.population.starving,4)),this.updateElementText("scienceDelta",n(t.population.scienceDelta,4)),this.updateElementText("cashDelta",n(t.population.cashDelta,4)),this.updateElementText("scienceRatio",t.population.scienceRatio<50?100-t.population.scienceRatio+"% science":t.population.scienceRatio+"% cash"),this.updateElementText("happiness",n(t.population.happiness,4)),this.updateElementText("happinessFromHouse",n(t.population.houseBonus)),this.updateElementText("happinessFromTrees",n(t.population.happinessFromTrees,4)),this.updateElementText("happinessFromOxygen",n(t.population.happinessFromOxygen,4))}}class oe extends h{update(){if(!t)return;this.updateElementText("forestWater",n(t.trees.water)),this.updateElementText("ferns",n(t.trees.ferns)),this.updateElementText("fernsDelta",n(t.trees.fernsDelta,4)),this.updateElementText("smallTrees",n(t.trees.smallTrees)),this.updateElementText("smallTreesDelta",n(t.trees.smallTreesDelta,4)),this.updateElementText("trees",n(t.trees.trees)),this.updateElementText("treesDelta",n(t.trees.treesDelta,4)),this.updateElementText("totalPlants",n(t.trees.totalPlants)),this.updateElementText("oxygenGain",n(t.trees.oxygenGain,4)),this.updateElementText("forestWaterToLake",n(t.trees.transferred,4)),this.updateElementText("lakeWaterFromForest",n(t.trees.transferred,4)),this.updateElementText("fernWater",n(t.trees.fernsWaterUse,4)),this.updateElementText("smallTreesWater",n(t.trees.smallTreesWaterUse,4)),this.updateElementText("treesWater",n(t.trees.treesWaterUse,4))}}class ie extends h{constructor(){super();if(t){t.events.on("energy:unlocked",()=>{this.checkUnlocked(),this.updateFull()}),t.events.on("energy:battery:updated",()=>this.updateFull());let e=document.getElementById("buyBattery");if(e)e.addEventListener("change",()=>this.updateFull())}}checkUnlocked(){if(!t)return;if(t.energy.unlocked){if(this.setVisible("unlockedEnergy",!0),this.setVisible("unlockEnergy",!1),this.getElement("spaceStationContainer").classList.contains("hidden"))this.getElement("spaceStationContainer").classList.remove("hidden");this.updateFull()}else if(this.setVisible("unlockedEnergy",!1),this.setVisible("unlockEnergy",!0),!this.getElement("spaceStationContainer").classList.contains("hidden"))this.getElement("spaceStationContainer").classList.add("hidden")}update(){if(!t)return;this.updateElementText("energy",n(t.power)),this.updateElementText("drain",n(t.energy.drain))}updateFull(){if(!t)return;this.updateElementText("battery",n(t.energy.battery));let e=document.getElementById("buyBattery"),s=e?Number(e.value):1;this.updateElementText("batteryCost",n(s*30000)+" oxygen and "+n(s*20000)+" science"),this.update()}}class de extends h{constructor(){super();if(t)t.events.on("spaceStation:unlocked",()=>this.checkUnlocked()),t.events.on("spaceStation:updated",()=>this.update())}checkUnlocked(){if(!t)return;if(t.spaceStation.unlocked)this.setVisible("spaceStationContainer",!0),this.setVisible("unlockedSpaceStation",!0),this.setVisible("unlockSpaceStation",!1),this.setVisible("tractorBeamContainer",!0);else this.setVisible("spaceStationContainer",!1),this.setVisible("unlockedSpaceStation",!1),this.setVisible("unlockSpaceStation",!0),this.setVisible("tractorBeamContainer",!1)}update(){if(!t)return;let e="",s="";for(let r=0;r<t.spaceStation.orbiting.length;r++){let o=t.spaceStation.orbiting[r];if(!o)continue;if(e+=n(o.amount)+" "+o.type,s+=n(o.amount/1e4,4)+" "+o.type,r!==t.spaceStation.orbiting.length-1)e+=", ",s+=", "}this.updateElementText("orbitingResources",e),this.updateElementText("orbitSending",s)}}class ue extends h{cometRows=new Map;takeAmountRows=new Map;constructor(){super();if(t)t.events.on("tractorBeam:unlocked",()=>this.checkUnlocked()),t.events.on("tractorBeam:updated",()=>this.update()),t.events.on("tractorBeam:removeComet",(e)=>{if(p)p.removeComet(e)})}checkUnlocked(){if(!t)return;if(t.tractorBeam.unlocked)this.setVisible("unlockedTractorBeam",!0),this.setVisible("unlockTractorBeam",!1);else this.setVisible("unlockedTractorBeam",!1),this.setVisible("unlockTractorBeam",!0)}update(){if(!t||!p)return;let e=this.getElement("allPassing"),s=t.tractorBeam.comets,r=new Set(s.map((o)=>o.id));for(let[o,d]of this.cometRows.entries())if(!r.has(o))d.remove(),this.cometRows.delete(o);for(let o=0;o<s.length;o++){let d=s[o];if(!d)continue;if(!this.cometRows.has(d.id)){let u=document.createElement("div");u.className="comet-row",u.innerHTML=`<span>${d.name}</span> with <span id="comet-amount-${d.id}"></span> ${d.amountType} passing in <span id="comet-duration-${d.id}"></span>`,e.appendChild(u),this.cometRows.set(d.id,u)}this.updateElementText(`comet-amount-${d.id}`,n(d.amount)),this.updateElementText(`comet-duration-${d.id}`,n(d.duration)),p.drawComet(d)}this.updateTakeAmount()}updateTakeAmount(){if(!t)return;let e=this.getElement("takeAmountContainer"),r=t.tractorBeam.takeAmount.filter((u)=>u.amount>0),o=r.map((u)=>u.type).join(","),d=Array.from(this.takeAmountRows.keys()).join(",");if(o!==d){e.innerHTML="",this.takeAmountRows.clear();for(let u=0;u<r.length;u++){let l=r[u],f=document.createElement("span"),b=u===r.length-1;f.innerHTML=`<span id="takeAmountVal-${l.type}"></span> ${l.type}${b?"":", "}`,e.appendChild(f),this.takeAmountRows.set(l.type,f)}}for(let u of r)this.updateElementText(`takeAmountVal-${u.type}`,n(u.amount,3))}}class ae extends h{constructor(){super();if(t){t.events.on("spaceDock:unlocked",()=>{this.checkUnlocked(),this.update()}),t.events.on("spaceDock:updated",()=>this.update());let e=document.getElementById("buyBattleshipAmount");if(e)e.addEventListener("change",()=>this.update())}}checkUnlocked(){if(!t)return;if(t.spaceDock.unlocked)this.setVisible("spaceDockContainer",!0),this.setVisible("hangarContainer",!0),this.setVisible("spaceCanvas",!0),this.setVisible("spaceContainer",!0),this.update();else this.setVisible("spaceDockContainer",!1),this.setVisible("hangarContainer",!1),this.setVisible("spaceCanvas",!1),this.setVisible("spaceContainer",!1)}update(){if(!t)return;this.updateElementText("battleships",n(t.spaceDock.battleships)),this.updateElementText("totalBattleships",n(t.spaceDock.battleships+t.spaceDock.sended));let e=document.getElementById("buyBattleshipAmount"),s=e?Number(e.value):1;this.updateElementText("battleshipCost",n(s*30000000)+" oxygen and "+n(s*15000000)+" science")}}class le extends h{constructor(){super();if(t){t.events.on("hangar:updated",()=>this.updateFull());let e=document.getElementById("buyHangarAmount");if(e)e.addEventListener("change",()=>this.updateFull())}}update(){if(!t)return;this.updateElementText("hangarSending",t.hangar.sendRate+" in "+ge(t.hangar.timeRemaining/10)+" seconds.")}updateFull(){if(!t)return;let e=document.getElementById("buyHangarAmount"),s=e?Number(e.value):1;this.updateElementText("hangarCost",n(s*1e6)),this.update()}}class he extends h{progressBar1;progressBar2;computerView;robotsView;resourceView;iceView;waterView;cloudsView;landView;populationView;treesView;energyView;spaceStationView;tractorBeamView;spaceDockView;hangarView;cometPool=[];allContainers=[];columns=[];lastVisibleCount=-1;lastWidth=-1;resizeHandler;constructor(){super();this.progressBar1=new N("nextStormProgress","#21276a"),this.progressBar2=new N("stormDurationProgress","#1c7682"),this.computerView=new D,this.robotsView=new P,this.resourceView=new z,this.iceView=new ee,this.waterView=new te,this.cloudsView=new se,this.landView=new re,this.populationView=new ne,this.treesView=new oe,this.energyView=new ie,this.spaceStationView=new de,this.tractorBeamView=new ue,this.spaceDockView=new ae,this.hangarView=new le;let e=this.getElement("mainContainer");if(e.querySelectorAll(".container").forEach((s)=>e.appendChild(s)),e.querySelectorAll(".column").forEach((s)=>s.remove()),this.allContainers=Array.from(e.querySelectorAll(".container")),this.resizeHandler=()=>this.refreshLayout(),window.addEventListener("resize",this.resizeHandler),t)t.events.on("tick",()=>{if(!document.hidden)this.update()}),t.events.on("computer:unlocked",()=>this.refreshLayout()),t.events.on("robots:unlocked",()=>this.refreshLayout()),t.events.on("energy:unlocked",()=>this.refreshLayout()),t.events.on("spaceStation:unlocked",()=>this.refreshLayout()),t.events.on("tractorBeam:unlocked",()=>this.refreshLayout()),t.events.on("spaceDock:unlocked",()=>this.refreshLayout())}destroy(){window.removeEventListener("resize",this.resizeHandler)}update(){if(!t)return;this.resourceView.update(),this.iceView.update(),this.waterView.update(),this.cloudsView.update(),this.landView.update(),this.treesView.update(),this.populationView.update(),this.updateComputerRowProgress(),this.robotsView.update(),this.updateRobotsRowProgress(),this.energyView.update(),this.spaceStationView.update(),this.tractorBeamView.update(),this.hangarView.update(),this.progressBar1.tick(t.clouds.initialStormTimer-t.clouds.stormTimer,t.clouds.initialStormTimer),this.progressBar2.tick(t.clouds.stormDuration,t.clouds.initialStormDuration),ke()}refreshLayout(){let e=this.getElement("mainContainer");if(e.offsetWidth===0)return;let s=window.getComputedStyle(e),r=parseFloat(s.columnGap||s.gap||"0"),o=280,d=e.querySelector(".column");if(d)o=parseFloat(window.getComputedStyle(d).minWidth);else{let c=document.createElement("div");c.className="column",c.style.visibility="hidden",c.style.position="absolute",e.appendChild(c),o=parseFloat(window.getComputedStyle(c).minWidth),e.removeChild(c)}o=Math.max(200,o||0);let u=o+r,l=e.offsetWidth,f=Math.max(1,Math.floor((l+r)/u)),b=this.allContainers.filter((c)=>!c.classList.contains("hidden")),E=b.length;if(this.columns.length===f&&E===this.lastVisibleCount&&l===this.lastWidth)return;b.sort((c,T)=>T.offsetHeight-c.offsetHeight);for(let c of this.allContainers)e.appendChild(c);if(this.columns.length!==f){this.columns.forEach((c)=>c.remove()),this.columns=[];for(let c=0;c<f;c++){let T=document.createElement("div");T.className="column",e.appendChild(T),this.columns.push(T)}}if(this.lastVisibleCount=E,this.lastWidth=l,this.columns.length===0)return;for(let c=0;c<b.length;c++){let T=b[c],I=this.columns[0];if(c<this.columns.length)I=this.columns[c];else{let w=I.offsetHeight;for(let k=1;k<this.columns.length;k++){let S=this.columns[k];if(S.offsetHeight<w)I=S,w=S.offsetHeight}}I.appendChild(T)}}clearComputerRows(){this.getElement("computerRows").innerHTML="",this.computerView.clearCache()}clearRobotRows(){this.getElement("robotRows").innerHTML="",this.robotsView.clearCache()}updateComputerRowProgress(){if(!t||!t.computer.unlocked)return;for(let e=0;e<t.computer.processes.length;e++)this.computerView.updateRowProgress(e)}updateRobotsRowProgress(){if(!t)return;for(let e=0;e<t.robots.jobs.length;e++)this.robotsView.updateRowProgress(e)}drawComet(e){let s,r="comet"+e.id;if(!e.drawed){s=this.cometPool.pop()||document.createElement("div"),s.className=e.name.toLowerCase(),s.id=r,s.classList.remove("hidden");let o=e.speed*e.duration;e.startingY=Math.random()*(o*0.4)+o*0.1,e.left=0,e.top=e.endingX=Math.pow(Math.pow(o,2)-Math.pow(e.startingY,2),0.5),e.slope=(0-e.startingY)/e.endingX,this.getElement("cometsContainer").appendChild(s),e.drawed=!0}else s=document.getElementById(r);if(s){e.left=(e.initialDuration-e.duration)/e.initialDuration*e.endingX,e.top=e.slope*e.left+e.startingY;let o=e.amountType==="ice"?e.amount/1000:e.amount,u=(e.name==="Comet"?40:20)*Math.sqrt(o/200);s.style.width=Math.round(u)+"px",s.style.height=Math.round(u)+"px",s.style.borderRadius=Math.round(u/2)+"px",s.style.left=Math.round(e.left-u/2)+"px",s.style.top=Math.round(e.top-u/2)+"px"}}removeComet(e){let s="comet"+e.id,r=document.getElementById(s);if(r)r.classList.add("hidden"),r.id="",this.cometPool.push(r);else console.log(s+"not found")}}var Oe=()=>{let e=(d,u)=>{let l=document.getElementById(d);if(l)l.addEventListener("click",u)};e("btnHardReset",_e),e("btnPause",Ce),e("btnBeg",$e),e("btnSave",me),e("btnExport",Ue),e("btnImport",Me),e("btnBuyIce",()=>t?.buyIce()),e("unlockComputer",()=>t?.computer.unlockComputer()),e("buyThread",()=>t?.computer.buyThread()),e("buySpeed",()=>t?.computer.buySpeed()),e("unlockRobots",()=>t?.robots.unlockRobots()),e("unlockEnergy",()=>t?.energy.unlockEnergy()),e("btnBuyBattery",()=>t?.buyBattery()),e("unlockSpaceStation",()=>t?.spaceStation.unlockSpaceStation()),e("unlockTractorBeam",()=>t?.tractorBeam.unlockTractorBeam()),e("btnBuyBattleship",()=>t?.buyBattleship()),e("btnBuyHangar",()=>t?.buyHangar()),document.getElementById("mainContainer")?.addEventListener("contextmenu",(d)=>d.preventDefault()),document.getElementById("scienceSlider")?.addEventListener("input",function(){if(t)t.population.scienceRatio=Number(this.value)}),document.getElementById("farmSlider")?.addEventListener("input",function(){if(t)t.farms.farmRatio=Number(this.value)}),document.querySelectorAll(".numeric-input-small").forEach((d)=>{d.addEventListener("change",function(){let u=Number(this.value);if(isNaN(u)||u<1)this.value="1";else if(u!==Math.floor(u))this.value=Math.floor(u).toString()})})};if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",Oe);else Oe();var ce=[];function ze(){if(ce.length===0)return;let e=ce[0]?.key;if(ce.splice(0,1),e===66)t?.buyIce()}document.addEventListener("keydown",function(e){let s={key:e.charCode!==0?e.charCode:e.keyCode,shift:e.shiftKey};ce.push(s),ze()});class fe{events=new Map;on(e,s){if(!this.events.has(e))this.events.set(e,[]);this.events.get(e)?.push(s)}off(e,s){let r=this.events.get(e);if(r)this.events.set(e,r.filter((o)=>o!==s))}emit(e,...s){let r=this.events.get(e);if(r)r.forEach((o)=>o(...s))}}var t=null,p=null,Ge=0,we=!1,Ae=0;function et(){Ge++}function tt(){we=!we}function He(){return Ae++,Ae}class Xe{totalLand;cash;oxygen;science;wood;metal;ore;power;oxygenLeak=0;canvasWidth=1200;canvasHeight=600;space;ice;water;clouds;land;trees;farms;population;computer;robots;energy;spaceStation;tractorBeam;spaceDock;hangar;events;constructor(){this.totalLand=1000,this.cash=100,this.oxygen=0,this.science=0,this.wood=0,this.metal=0,this.ore=0,this.power=0,this.canvasWidth=1200,this.canvasHeight=600,this.events=new fe}tick(){this.water.waterSpending=0,this.water.gain=0,this.ice.tick(),this.robots.tick(),this.computer.tick(),this.land.soil-=this.farms.updateFarms(this.land.soil),this.farms.tick(this.land.transferWater()),this.population.tick(),this.water.outdoor+=this.farms.transferWater(),this.trees.tick(this.land.transferWater()),this.water.outdoor+=this.trees.transferWater(),this.land.tick(this.clouds.transferWater()),this.clouds.tick(this.water.transferWater()),this.energy.tick(),this.water.tick(this.ice.transferWater()),this.tractorBeam.tick(),this.spaceStation.tick(),this.space.tick(),this.oxygenLeak=this.oxygen/1e5,this.oxygen-=this.oxygenLeak,this.hangar.tick(),this.events.emit("tick")}initialize(){this.space=new H,this.ice=new O,this.water=new _,this.clouds=new U,this.land=new M(this.totalLand),this.trees=new $,this.farms=new A,this.population=new G,this.computer=new X,this.robots=new K,this.energy=new j,this.spaceStation=new Y,this.tractorBeam=new q,this.spaceDock=new Q,this.hangar=new J,p?.clearComputerRows();for(let e=0;e<this.computer.processes.length;e++){p?.computerView.addComputerRow(e);let s=this.computer.processes[e];if(s)s.isMoving=!1,s.completions=0}p?.clearRobotRows();for(let e=0;e<this.robots.jobs.length;e++){p?.robotsView.addRobotRow(e);let s=this.robots.jobs[e];if(s)s.completions=0}}buyIce(){let e=this.cash;if(e<=0)return;this.cash-=this.ice.buyIce(e)}buyBattery(){let e=document.getElementById("buyBattery"),s=Number(e.value);if(s*30000>this.oxygen)s=Math.floor(this.oxygen/30000);if(s*20000>this.science)s=Math.floor(this.science/20000);if(s<=0)return;this.oxygen-=s*30000,this.science-=s*20000,this.energy.buyBattery(s)}buyBattleship(){let e=document.getElementById("buyBattleshipAmount"),s=Number(e.value);if(s*30000000>this.oxygen)s=Math.floor(this.oxygen/30000000);if(s*15000000>this.science)s=Math.floor(this.science/15000000);if(s<=0)return;this.oxygen-=30000000*s,this.science-=15000000*s,this.spaceDock.addBattleship(s)}buyHangar(){let s=document.getElementById("buyHangarAmount"),r=Number(s.value);if(r*1e6>this.metal)r=Math.floor(this.metal/1e6);if(r<=0)return;this.metal-=r*1e6,this.hangar.sendRate+=r,this.events.emit("hangar:updated")}}function st(){if(we)return;if(et(),t?.tick(),Ge%100===0)me()}function rt(e){Ie.postMessage({stop:!0}),Ie.postMessage({start:!0,ms:1000/e})}function Ce(){tt()}var Ie=new Worker(new URL("./workers/interval.js",import.meta.url).href);Ie.onmessage=function(e){if(e.data==="interval.start")st()};async function _e(){window.localStorage.terrafold2="",await Se()}function nt(){if(p)p.destroy();t=new Xe,p=new he,t?.initialize(),window.game=t,window.view=p}function ot(){if(!p)return;p.hangarView.updateFull(),p.spaceDockView.checkUnlocked(),p.tractorBeamView.checkUnlocked(),p.spaceStationView.checkUnlocked(),p.energyView.checkUnlocked(),p.computerView.checkUnlocked(),p.robotsView.checkUnlocked(),p.update()}async function Se(){if(nt(),window.localStorage.terrafold2){let e=await Te(window.localStorage.terrafold2),s=JSON.parse(e);if(t)Le(s,t);let r=document.getElementById("scienceSlider");if(r&&t)r.value=t.population.scienceRatio.toString();let o=document.getElementById("farmSlider");if(o&&t)o.value=t.farms.farmRatio.toString()}ot(),p?.refreshLayout(),rt(10)}var it=["text","tooltip","events","canvasWidth","canvasHeight","drawed","isMoving","transferred","foodCreated","convertedLand","takeAmount","foodEaten","popGrowth","starving","scienceDelta","cashDelta","happinessFromTrees","happinessFromOxygen","happiness","rotation","fernsDelta","fernsWaterUse","smallTreesDelta","smallTreesWaterUse","treesDelta","treesWaterUse","totalPlants","oxygenGain","woodIncome","woodSpending","metalIncome","metalSpending","oreIncome","oreSpending","oxygenSpending","waterIncome","waterSpending","cashSpending","scienceSpending","waterFarms","waterTrees","buyIncome"];function Le(e,s){for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&!it.includes(r)){if(typeof e[r]==="object"&&e[r]!==null){if(typeof s[r]>"u")s[r]=Array.isArray(e[r])?[]:{};Le(e[r],s[r])}else if(typeof e[r]!=="function")s[r]=e[r]}}async function me(){let e={};if(t)Le(t,e);window.localStorage.terrafold2=await Ee(JSON.stringify(e))}async function Ue(){await me();let e=document.getElementById("exportImportSave");if(e)e.value=await Ee(window.localStorage.terrafold2||""),e.select(),document.execCommand("copy"),e.value=""}async function Me(){let e=document.getElementById("exportImportSave");if(e)window.localStorage.terrafold2=await Te(e.value),await Se()}function $e(){if(t)t.cash+=0.1}Se();window.game=t;window.view=p;window.pauseGame=Ce;export{p as view,me as save,Ce as pauseGame,He as incrementCometId,Me as importSave,t as game,Ue as exportSave,_e as clearSave,$e as begForMoney};

//# debugId=B108492F22E2D50764756E2164756E21
//# sourceMappingURL=main.js.map
