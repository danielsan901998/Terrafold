function F(e){let r=1;if(e.ctrlKey)r*=5;if(e.shiftKey)r*=10;return r}function Re(e){return Math.floor(e*10)/10}function Oe(e){return Math.floor(e*100)/100}function be(e){return Number(e.toPrecision(2))}function R(e){return Number(e.toPrecision(3))}function O(e,r,s,i,n){return I(e,r,s,i)<n}function I(e,r,s,i){return Math.sqrt(Math.pow(Math.abs(e-s),2)+Math.pow(Math.abs(r-i),2))}function g(e,r){let s=1;if(e<0)s=-1,e*=-1;if(e>=1e4)return(s===1?"+":"-")+Me(e,3);else return(s===1?"+":"-")+Ce(e,r)}function o(e,r){if(e>=1e4)return Me(e,3);else return Ce(e,r)}function Ce(e,r){if(Number.isInteger(e))return e.toString();let s=3;if(r!==void 0)s=r;return e.toFixed(s-1).replace(pe,"$1")}var Fe=[{value:1000000000000000000000000000000000000000000000000000000000000000,symbol:"V"},{value:1000000000000000000000000000000000000000000000000000000000000,symbol:"Nd"},{value:1000000000000000000000000000000000000000000000000000000000,symbol:"Od"},{value:1000000000000000000000000000000000000000000000000000000,symbol:"Sd"},{value:1000000000000000000000000000000000000000000000000000,symbol:"sd"},{value:1000000000000000000000000000000000000000000000000,symbol:"Qd"},{value:1000000000000000000000000000000000000000000000,symbol:"qd"},{value:1000000000000000000000000000000000000000000,symbol:"Td"},{value:1000000000000000000000000000000000000000,symbol:"Dd"},{value:1000000000000000000000000000000000000,symbol:"Ud"},{value:1000000000000000000000000000000000,symbol:"Dc"},{value:1000000000000000000000000000000,symbol:"N"},{value:1000000000000000000000000000,symbol:"O"},{value:1000000000000000000000000,symbol:"Sp"},{value:1000000000000000000000,symbol:"Sx"},{value:1000000000000000000,symbol:"Qi"},{value:1000000000000000,symbol:"Qa"},{value:1000000000000,symbol:"T"},{value:1e9,symbol:"B"},{value:1e6,symbol:"M"},{value:1000,symbol:"K"}],pe=/\.0+$|(\.[0-9]*[1-9])0+$/,M=new Map;function Me(e,r){let s=e+"|"+r,i=M.get(s);if(i!==void 0)return i;let n,u=!1;for(let h=0;h<Fe.length;h++){let m=Fe[h];if(m&&e>=m.value/1.000501){n=(e/m.value).toPrecision(r).replace(pe,"$1")+m.symbol,u=!0;break}}if(!u)n=e.toPrecision(r).replace(pe,"$1");if(M.size>1000){let h=M.keys().next().value;if(h!==void 0)M.delete(h)}return M.set(s,n),n}function Ne(e,r){e.sort((s,i)=>s[r]-i[r])}async function ye(e){let r=new Blob([e]).stream().pipeThrough(new CompressionStream("gzip")),i=await new Response(r).arrayBuffer(),n=new Uint8Array(i),u="";for(let h=0;h<n.byteLength;h++)u+=String.fromCharCode(n[h]);return btoa(u)}async function ke(e){if(!e)return"";let r=e.trim();if(r.startsWith("{")&&r.endsWith("}"))return r;try{let s=atob(e),i=Uint8Array.from(s,(u)=>u.codePointAt(0)),n=new Blob([i]).stream().pipeThrough(new DecompressionStream("gzip"));return new Response(n).text()}catch(s){return e}}class a{static MINE_TICKS_MAX=2000;static FACTORY_TICKS_MAX=8000;static SOLAR_TICKS_MAX=1000;static COILGUN_TICKS_MAX=1000;static COILGUN_CHARGE_MAX=1000;static findArea(e){if(!t)return;let r=0;while(a.isWithinDistanceOfAny(e,e.x,e.y,75)){if(r++,r>40){console.log("too many planets");return}e.x=a.xAreaAllowed(),e.y=a.yAreaAllowed()}}static xAreaAllowed(){if(!t)return 0;let e=t.canvasWidth*0.8;return Math.random()*(e-200)}static yAreaAllowed(){if(!t)return 0;let e=t.canvasHeight*0.8;return Math.random()*(e-55)+10}static isWithinDistanceOfAny(e,r,s,i){if(!t)return!1;for(let n=0;n<t.space.planets.length;n++){let u=t.space.planets[n];if(!u||u===e)continue;if(O(r,s,u.x,u.y,i))return!0}return!1}static tick(e){if(!t)return;e.maxMines=t.hangar.maxMines,a.regenShields(e),a.tickResources(e)}static empty(e){return e.dirt<=0}static alive(e){return e.health>0}static regenShields(e){if(!a.alive(e)){e.atmo=0;return}if(e.atmo+=(e.maxAtmo-e.atmo)/100,e.atmo>e.maxAtmo)e.atmo=e.maxAtmo}static getShieldReduction(e){return e.atmo/e.maxAtmo}static takeDamage(e,r){let s=a.getShieldReduction(e),i=r*(1-s);e.atmo-=r*s;let n=0;if(e.atmo<0)n=e.atmo*-1,e.atmo=0;if(e.health-=i+n,e.health<0)e.health=0}static calcPower(e,r){if(!t)return;e.power=r*(e.isBoss?1.5:1),e.atmo=e.maxAtmo=Math.min(200,R(e.power*2+100)),e.health=e.maxHealth=R(e.power*20+1000),e.dirt=R(e.power*200+2000),e.maxMines=t.hangar.maxMines}static workConstruction(e,r){if(!a.doneFactory(e)){a.workOnFactory(e,r);return}if(!a.doneCoilgun(e)){a.workOnCoilgun(e,r);return}a.workOnMine(e,r)}static tickResources(e){if(a.empty(e))return;a.tickMines(e),a.tickBots(e),a.tickFactory(e),a.tickSolar(e),a.tickCoilgun(e)}static doneBuilding(e){return e.mines>=e.maxMines||a.empty(e)}static workOnMine(e,r){if(e.mineTicks+=r,e.mineTicks>=a.MINE_TICKS_MAX){let s=Math.floor(e.mineTicks/a.MINE_TICKS_MAX);s=Math.max(0,Math.min(s,e.maxMines-e.mines)),e.mines+=s,e.mineTicks-=s*a.MINE_TICKS_MAX}}static tickMines(e){e.ore+=e.mines}static tickBots(e){let r=Math.min(e.bots,e.ore);e.ore-=r,a.workOnSolar(e,r)}static doneFactory(e){return e.factoryTicks>=a.FACTORY_TICKS_MAX}static workOnFactory(e,r){e.factoryTicks+=r}static tickFactory(e){if(e.ore>=200){let r=Math.floor(e.ore/200);e.bots+=r,e.ore-=r*200}}static workOnSolar(e,r){if(e.solarTicks+=r,e.solarTicks>=a.SOLAR_TICKS_MAX){let s=Math.floor(e.solarTicks/a.SOLAR_TICKS_MAX);e.solar+=s,e.solarTicks-=s*a.SOLAR_TICKS_MAX}}static tickSolar(e){e.coilgunCharge+=e.solar}static doneCoilgun(e){return e.coilgunTicks>=a.COILGUN_TICKS_MAX}static workOnCoilgun(e,r){e.coilgunTicks+=r}static tickCoilgun(e){if(e.coilgunCharge>=a.COILGUN_CHARGE_MAX){let r=Math.floor(e.coilgunCharge/a.COILGUN_CHARGE_MAX);e.coilgunCharge-=r*a.COILGUN_CHARGE_MAX;let s=500*r;if(e.dirt<=s)s=e.dirt;if(e.dirt-=s,t&&t.spaceStation.orbiting[1])t.spaceStation.orbiting[1].amount+=s}}}class f{static foodPerShip=20;static actionRate=1;static actionSpeed=40;static globalTargetIndex=-1;static tick(e){f.checkEmpty(e),f.moveToNearestTarget(e),f.checkJoinFleet(e),f.attackTarget(e)}static updateGlobalTarget(){if(!t)return;let e=t.hangar.getTarget();f.globalTargetIndex=f.findClosestTarget(e.x,e.y)}static findClosestTarget(e,r){if(!t)return-1;let s=-1,i=1/0;for(let n=0;n<t.space.planets.length;n++){let u=t.space.planets[n];if(!a.doneBuilding(u)){let h=I(e,r,u.x,u.y);if(s===-1||h<i)s=n,i=h}}return s}static checkJoinFleet(e){if(!t||!e.engaged)return;for(let r=t.space.ships.length-1;r>=0;r--){let s=t.space.ships[r];if(s===e||f.isEmpty(s))continue;if(O(e.x,e.y,s.x,s.y,20))f.combineShips(e,s),t.space.ships.splice(r,1)}}static checkEmpty(e){if(e.food-=e.count,!f.isEmpty(e))return;e.food=0,e.engaged=!1,e.targetIndex=-1}static getTargetObject(e){if(!t)return null;if(e.targetIndex===-1)return t.hangar.getTarget();if(e.targetIndex>=0&&e.targetIndex<t.space.planets.length){let r=t.space.planets[e.targetIndex];if(!a.doneBuilding(r))return r}return e.targetIndex=f.findClosestTarget(e.x,e.y),e.targetIndex===-1?t.hangar.getTarget():t.space.planets[e.targetIndex]}static returnHome(e){if(!t)return;t.spaceDock.battleships+=e.count,t.spaceDock.sended-=e.count,t.farms.food+=e.food*f.foodPerShip,t.events.emit("spaceDock:updated");for(let r=t.space.ships.length-1;r>=0;r--)if(t.space.ships[r]===e){t.space.ships.splice(r,1);break}}static isEmpty(e){return e.food<=0}static getSpeed(e){if(t)return f.isEmpty(e)?t.spaceDock.emptySpeed:t.spaceDock.defaultSpeed;return f.isEmpty(e)?0.05:0.5}static moveToNearestTarget(e){let r=f.getTargetObject(e);if(!r)return;if(I(e.x,e.y,r.x,r.y)<40){if(!("isHome"in r)){e.engaged=!0;return}f.returnHome(e);return}e.engaged=!1;let s=f.getSpeed(e),i=0,n=r.y-e.y,u=r.x-e.x;if(n>=0&&u<0||n<0&&u<0)i=Math.PI;let h=Math.atan(n/u)+i;e.x=e.x+s*Math.cos(h),e.y=e.y+s*Math.sin(h),e.direction=h}static attackTarget(e){let r=f.getTargetObject(e);if(r&&!("isHome"in r)&&e.engaged){let s=r;if(e.actionCounter++,e.actionCounter>=f.actionSpeed){if(e.actionCounter=0,a.alive(s))a.takeDamage(s,f.actionRate*e.count);else if(a.workConstruction(s,e.count),a.doneBuilding(s))e.engaged=!1,e.targetIndex=f.findClosestTarget(e.x,e.y)}}}static combineShips(e,r){if(e.count+=r.count,e.energy+=r.energy,e.food+=r.food,r.actionCounter>e.actionCounter)e.actionCounter=r.actionCounter}}class W{isBoss=!1;view;x;y;mines=0;mineTicks=0;ore=0;bots=0;factoryTicks=0;solarTicks=0;solar=0;energy=0;coilgunTicks=0;coilgunCharge=0;id;power=0;atmo=0;maxAtmo=0;health=0;maxHealth=0;dirt=0;maxMines=0;constructor(){this.view={color:Math.floor(Math.random()*360),light:Math.floor(Math.random()*15+40)},this.x=a.xAreaAllowed(),this.y=a.yAreaAllowed(),a.findArea(this)}}class A{planets;ships;sector;allEmpty;constructor(){this.planets=[],this.ships=[],this.sector=0,this.allEmpty=!1}tick(){let e=this.planets[f.globalTargetIndex];if(!e||a.doneBuilding(e))f.updateGlobalTarget();if(!this.allEmpty){let r=!0;for(let s=0;s<this.planets.length;s++)if(a.tick(this.planets[s]),r&&!a.empty(this.planets[s]))r=!1;this.allEmpty=r}if(this.allEmpty&&this.ships.length===0)this.sector++,this.newLevel();for(let r=0;r<this.ships.length;r++)f.tick(this.ships[r])}spawnShip(e,r){e.x=-120,e.y=r,this.ships.push(e)}newLevel(){this.allEmpty=!1,this.planets=[];for(let r=0;r<10;r++){let s=new W;this.planets.push(s)}Ne(this.planets,"x");let e=this.planets[this.planets.length-1];if(e)e.isBoss=!0;for(let r=0;r<this.planets.length;r++)a.calcPower(this.planets[r],this.sector)}}class B{ice;buyable;gain;max;transferred;buyIncome=0;constructor(){this.ice=0,this.buyable=1000,this.gain=10,this.max=1000,this.transferred=0}tick(){if(this.transferred=0,this.buyIncome=0,this.buyable+=this.gain/100,this.buyable>this.max)this.buyable=this.max;t?.events.emit("ice:updated")}transferWater(){return this.transferred=this.ice/1000,this.ice-=this.transferred,this.transferred}buyIce(e){if(this.buyable<e)e=this.buyable;return this.buyable-=e,this.ice+=e,this.buyIncome+=e,e}findIceSeller(e){this.max+=e*200,this.gain+=e}}class H{indoor;outdoor;maxIndoor;selling;excess;gain;waterSpending=0;transferred=0;constructor(){this.indoor=0,this.outdoor=0,this.maxIndoor=50,this.selling=0,this.excess=0,this.gain=0}tick(e){if(this.indoor+=e,this.excess=this.indoor-this.maxIndoor,this.excess>0)this.indoor=this.maxIndoor,this.outdoor+=this.excess;else this.excess=0;this.selling=this.indoor/100,this.waterSpending+=this.selling,this.indoor-=this.selling;let r=this.selling*2;if(this.gain+=r,t)t.cash+=r;t?.events.emit("water:updated")}transferWater(){return this.transferred=this.outdoor/1000,this.outdoor-=this.transferred,this.transferred}sellWater(e){if(this.indoor<e)e=this.indoor;this.indoor-=e,this.waterSpending+=e;let r=this.getPrice(e);if(this.gain+=r,t)t.cash+=r}getPrice(e){return e*2}}class _{water;initialStormTimer;stormTimer;stormRate;storming;initialStormDuration;stormDuration;transferred;lightningChance;lightningStrength;constructor(){this.water=0,this.initialStormTimer=300,this.stormTimer=300,this.stormRate=0,this.storming=0,this.initialStormDuration=60,this.stormDuration=60,this.transferred=0,this.lightningChance=0,this.lightningStrength=0}tick(e){this.transferred=0,this.water+=e,this.nextStormTimer(),this.tickLightning(),t?.events.emit("clouds:updated")}tickLightning(){if(this.lightningChance+=0.01*this.stormRate/100,this.lightningStrength=this.water*0.01,this.stormRate===100&&this.lightningChance>Math.random()*100){if(this.lightningChance=0,t)t.energy.gainEnergy(this.lightningStrength)}}transferWater(){return this.transferred=this.water/500*this.stormRate/100,this.water-=this.transferred,this.transferred}nextStormTimer(){if(this.stormTimer>0)this.stormTimer--;else if(this.stormDuration>0)this.storming=1;if(this.stormRate>=100)if(this.storming=0,this.stormDuration>0)this.storming=0,this.stormDuration--;else this.storming=-1;else if(this.stormRate<=0&&this.storming===-1)this.stormDuration=this.initialStormDuration,this.stormTimer=this.initialStormTimer,this.storming=0;this.stormRate+=this.storming}gainStormDuration(e){this.stormDuration+=e,this.initialStormDuration+=e,t?.events.emit("clouds:stormDuration:updated")}}class G{land;baseLand;optimizedLand;water;soil;transferred;convertedLand=0;constructor(e){this.land=e,this.baseLand=e,this.optimizedLand=e,this.water=0,this.soil=0,this.transferred=0}tick(e){this.transferred=0,this.water+=e,this.turnLandToSoil(),t?.events.emit("land:updated")}turnLandToSoil(){if(this.convertedLand=this.water/1000,this.land<this.convertedLand)this.convertedLand=this.land;this.land-=this.convertedLand,this.soil+=this.convertedLand,this.water-=this.convertedLand}transferWater(){return this.transferred=this.water/1000,this.water-=this.transferred,this.transferred}improveLand(){let e=(10*this.baseLand-this.optimizedLand)/100;this.optimizedLand+=e,this.land+=e}addLand(e){this.optimizedLand+=e,this.land+=e,this.baseLand+=e}}class X{water;ferns;fernsDelta;fernsWaterUse;smallTrees;smallTreesDelta;smallTreesWaterUse;trees;treesDelta;treesWaterUse;totalPlants;oxygenGain;woodIncome=0;woodSpending=0;waterSpending=0;transferred=0;constructor(){this.water=0,this.ferns=0,this.fernsDelta=0,this.fernsWaterUse=0,this.smallTrees=0,this.smallTreesDelta=0,this.smallTreesWaterUse=0,this.trees=0,this.treesDelta=0,this.treesWaterUse=0,this.totalPlants=0,this.oxygenGain=0}tick(e){if(!t)return;this.transferred=0,this.oxygenGain=0,this.woodIncome=0,this.woodSpending=0,this.waterSpending=0,this.water+=e,this.plantGrowth(),this.oxygenGain=this.ferns/1000+3*this.smallTrees/1000+this.trees/100,t.oxygen+=this.oxygenGain,t.events.emit("trees:updated")}plantGrowth(){if(!t)return;if(this.totalPlants=this.ferns+this.smallTrees+this.trees,this.treesDelta=this.smallTrees/1000,this.smallTreesDelta=this.ferns/1000-this.treesDelta,this.fernsDelta=(t.land.soil-this.totalPlants)/1000-this.ferns/1000,this.fernsWaterUse=(t.land.soil-this.totalPlants)/1000,this.fernsWaterUse=this.fernsWaterUse<0?0:this.fernsWaterUse,this.smallTreesWaterUse=this.ferns/1000,this.treesWaterUse=this.smallTrees/1000,this.fernsDelta<0){let e=0;if(this.ferns+this.fernsDelta<0)e=this.fernsDelta+this.ferns,this.fernsDelta=-1*this.ferns;if(this.smallTreesDelta+=e,e=0,this.smallTrees+this.smallTreesDelta<0)e=this.smallTrees+this.smallTreesDelta,this.smallTreesDelta=-1*this.smallTrees;this.treesDelta+=e}if(this.water<this.treesWaterUse)this.treesDelta=this.treesDelta>0?this.water:this.treesDelta,this.treesWaterUse=this.water;if(this.trees+=this.treesDelta,this.water-=this.treesWaterUse,this.waterSpending+=this.treesWaterUse,this.water<this.smallTreesWaterUse)this.smallTreesDelta=this.smallTreesDelta>0?this.water:this.smallTreesDelta,this.smallTreesWaterUse=this.water;if(this.smallTrees+=this.smallTreesDelta,this.water-=this.smallTreesWaterUse,this.waterSpending+=this.smallTreesWaterUse,this.water<this.fernsWaterUse)this.fernsDelta=this.fernsDelta>0?this.water:this.fernsDelta,this.fernsWaterUse=this.water;this.ferns+=this.fernsDelta,this.water-=this.fernsWaterUse,this.waterSpending+=this.fernsWaterUse}transferWater(){return this.transferred=this.water/1000,this.water-=this.transferred,this.transferred}}class V{water;farms;food;foodCreated;efficiency;farmRatio;waterSpending=0;transferred=0;constructor(){this.water=0,this.farms=0,this.food=0,this.foodCreated=0,this.efficiency=1,this.farmRatio=0}tick(e){this.transferred=0,this.foodCreated=0,this.waterSpending=0,this.water+=e,this.gainFood(),t?.events.emit("farms:updated")}transferWater(){return this.transferred=this.water/1000,this.water-=this.transferred,this.transferred}gainFood(){if(this.foodCreated=this.farms/100*this.efficiency,this.foodCreated>this.water)this.foodCreated=this.water;this.waterSpending+=this.foodCreated,this.water-=this.foodCreated,this.food+=this.foodCreated}addFarm(e){this.farms+=e,t?.events.emit("farms:updated")}updateFarms(e){let r=e+this.farms*50,s=Math.floor(r*this.farmRatio/100/50),i=s-this.farms;if(i!==0)return this.farms=s,t?.events.emit("farms:updated"),i*50;return 0}improve(){this.efficiency+=0.02,t?.events.emit("farms:updated")}}class K{people;foodEaten;popGrowth;starving;scienceRatio;scienceDelta;cashDelta;happiness;houseBonus;happinessFromTrees=0;happinessFromOxygen=0;constructor(){this.people=0,this.foodEaten=0,this.popGrowth=0,this.starving=0,this.scienceRatio=0,this.scienceDelta=0,this.cashDelta=0,this.happiness=1,this.houseBonus=1}tick(){if(!t)return;if(this.foodEaten=this.people/100,this.foodEaten>t.farms.food)this.starving=this.foodEaten-t.farms.food,this.foodEaten=t.farms.food;else this.starving=0;t.farms.food-=this.foodEaten,this.popGrowth=(t.farms.food-this.people)/1000-this.starving/100,this.people+=this.popGrowth,this.updateHappiness(),this.tickRatio(),t.events.emit("population:updated")}updateHappiness(){if(!t)return;this.happinessFromTrees=Math.log10(t.trees.trees+1)/10,this.happinessFromOxygen=Math.log10(t.oxygen+1)/20,this.happiness=this.houseBonus*(1+this.happinessFromTrees+this.happinessFromOxygen)}tickRatio(){if(!t)return;this.scienceDelta=this.people/100*(100-this.scienceRatio)/100*this.happiness,this.cashDelta=this.people/100*this.scienceRatio/100*this.happiness,t.science+=this.scienceDelta,t.cash+=this.cashDelta}improveHouse(){this.houseBonus+=0.1}}class y{text;tooltip;workers;currentTicks=0;ticksNeeded;cost;costType;completions=0;isMoving=!1;spendingCategory;finish;showing;done;constructor(e){this.text=e.text||"",this.tooltip=e.tooltip||"",this.workers=e.workers||e.threads||0,this.currentTicks=e.currentTicks||0,this.ticksNeeded=e.ticksNeeded||0,this.cost=e.cost??0,this.costType=e.costType??"",this.spendingCategory=e.spendingCategory,this.finish=e.finish||(()=>{}),this.showing=e.showing!==void 0?e.showing:!0,this.done=e.done}tick(e,r=1,s){if(e===0||this.done&&this.done())return this.isMoving=!1,0;if(this.ticksNeeded===0)return this.finish(),0;if(this.cost&&this.costType){let n=Array.isArray(this.cost)?this.cost:[this.cost],u=Array.isArray(this.costType)?this.costType:[this.costType];for(let h=0;h<n.length;h++){let m=e*n[h]*r,b=u[h];if(b&&t&&t[b]<m)return this.isMoving=!1,0}for(let h=0;h<n.length;h++){let m=e*n[h]*r,b=u[h];if(b&&t){if(t[b]-=m,s)s(b,m)}}}this.currentTicks+=e,this.isMoving=!0;let i=0;while(this.currentTicks>=this.ticksNeeded)this.currentTicks-=this.ticksNeeded,this.completions++,this.finish(),i++;return i}}class ${unlocked;threads;freeThreads;speed;processes;cashSpending=0;scienceSpending=0;metalSpending=0;woodSpending=0;powerSpending=0;constructor(){if(this.unlocked=0,this.threads=1,this.freeThreads=1,this.speed=1,this.processes=[new y({text:"Optimize Land",tooltip:"Improve 1% of unimproved land.<br>Max to improve to is ( 10 x base land )<br>Percent Optimized: <div id='landOptimized'></div>",ticksNeeded:600,finish:function(){if(t)t.land.improveLand();if(t)this.ticksNeeded=Math.floor(t.land.baseLand);t?.events.emit("computer:optimize-land:updated")}}),new y({text:"Buy Ice",tooltip:"Buy available ice",ticksNeeded:50,finish:function(){if(t)t.buyIce()}}),new y({text:"Sell Water",tooltip:"Sells up to 50 water",ticksNeeded:50,finish:function(){if(t)t.water.sellWater(50)}}),new y({text:"Improve Farms",tooltip:"Farm efficiency increases by 2%",ticksNeeded:40,finish:function(){if(t)t.farms.improve();this.ticksNeeded=R(20*(this.completions+2)+Math.pow(this.completions,2)/10)}}),new y({text:"Find more Ice Sellers",tooltip:"Gain 200 buyable ice and 1 more per tick",ticksNeeded:2000,cost:0.5,costType:"cash",finish:function(){if(t)t.ice.findIceSeller(1)}}),new y({text:"Bigger Storms",tooltip:"Storms last 5 more ticks. Max 300 duration.",ticksNeeded:600,cost:2,costType:"science",finish:function(){if(t)t.clouds.gainStormDuration(5);this.cost=this.cost+0.5,this.ticksNeeded+=50},done:function(){if(t&&t.clouds.initialStormDuration>=300)return this.showing=!1,t.events.emit("computer:visibility:updated"),!0;return!1},showing:!0}),new y({text:"Build Robots",tooltip:"Builds a robot",ticksNeeded:1e4,cost:0.01,costType:"metal",finish:function(){if(t)t.robots.gainRobots(1)},showing:!1,done:function(){return t?t.robots.robots>=t.robots.robotMax:!1}}),new y({text:"More Robot Storage",tooltip:"Can hold 5 more robots",ticksNeeded:20000,cost:0.5,costType:"wood",finish:function(){if(t)t.robots.gainStorage(5);this.ticksNeeded+=2000},showing:!1}),new y({text:"Improve House Design",tooltip:"Improves base happiness modifier by .1",ticksNeeded:3000,cost:10,costType:"science",finish:function(){if(t)t.population.improveHouse();this.ticksNeeded+=500},showing:!1}),new y({text:"Improve Ship engines",tooltip:"Ship speed increases by 0.1 and empty ship speed by 0.01",ticksNeeded:20000,cost:1e4,costType:"science",finish:function(){if(t)t.spaceDock.improveEngines(0.1,0.01);this.cost=this.cost+5000,this.ticksNeeded+=1000},done:function(){if(t&&t.spaceDock.defaultSpeed>=1)return this.showing=!1,t.events.emit("computer:visibility:updated"),!0;return!1},showing:!1})],t)t.events.on("computer:unlocked",()=>{let e=["Build Robots","More Robot Storage","Improve House Design"];if(t&&t.robots.unlocked!==0)this.processes.filter((r)=>e.includes(r.text)).forEach((r)=>r.showing=!0)}),t.events.on("robots:unlocked",()=>{let e=["Build Robots","More Robot Storage","Improve House Design"];this.processes.filter((r)=>e.includes(r.text)).forEach((r)=>r.showing=!0)}),t.events.on("spaceDock:unlocked",()=>{let e=this.processes.find((r)=>r.text==="Improve Ship engines");if(e)e.showing=!0})}tick(){this.cashSpending=0,this.scienceSpending=0,this.metalSpending=0,this.woodSpending=0,this.powerSpending=0;for(let e=0;e<this.processes.length;e++){let r=this.processes[e];this.tickRow(r,this.speed*r.workers)}}tickRow(e,r){if(!t)return;if(r===0){e.isMoving=!1;return}if(e.done&&e.done()){if(e.isMoving=!1,e.workers>0)this.freeThreads+=e.workers,e.workers=0;t.events.emit("computer:threads:updated");return}e.tick(r,1,(s,i)=>{let n=e.spendingCategory?.[s]||s+"Spending";if(this[n]!==void 0&&typeof this[n]==="number")this[n]+=i})}unlockComputer(){if(!t)return;if(t.science>=1000)t.science-=1000,this.unlocked=1,t.events.emit("computer:unlocked")}buyThread(){if(!t)return;let e=this.getThreadCost();if(t.cash>=e)t.cash-=e,this.threads++,this.freeThreads++,t.events.emit("computer:threads:updated")}getThreadCost(){return be(Math.pow(2,this.threads)*500)}buySpeed(){if(!t)return;let e=this.getSpeedCost();if(t.science>=e)t.science-=e,this.speed++,t.events.emit("computer:speed:updated")}getSpeedCost(){return be(Math.pow(2,this.speed)*500)}addThread(e,r){r=Math.min(r,this.freeThreads);let s=this.processes[e];if(s)s.workers+=r,this.freeThreads-=r,t?.events.emit("computer:threads:updated")}removeThread(e,r){let s=this.processes[e];if(s)r=Math.min(r,s.workers),s.workers-=r,this.freeThreads+=r,t?.events.emit("computer:threads:updated")}}class j{robots;robotsFree;robotMax;unlocked;mines;jobs;woodIncome=0;woodSpending=0;metalIncome=0;metalSpending=0;oreIncome=0;oreSpending=0;oreToDirtSpending=0;oxygenSpending=0;powerSpending=0;constructor(){if(this.robots=0,this.robotsFree=0,this.robotMax=5,this.unlocked=0,this.mines=0,this.jobs=[new y({text:"Cut Trees",tooltip:"Cut down 2 trees for 1 wood",finish:function(){if(t)t.robots.cutTrees(this.workers)}}),new y({text:"Expand indoor water storage",tooltip:"Gives 50 more max indoor water.<br>Cost increases by 1",ticksNeeded:3000,cost:[0.1],costType:["metal"],finish:function(){if(this.ticksNeeded+=1000,t)t.water.maxIndoor+=50,t.events.emit("water:maxIndoor:updated")}}),new y({text:"Build Mines",tooltip:"Build mines to get ore. Limit: <span id='minesLimit'></span>. Currently: <span id='minesCount'></span>",ticksNeeded:300,cost:[1],costType:["wood"],finish:function(){if(t)t.robots.mines++,t.events.emit("robots:mines:updated");this.ticksNeeded+=200+this.completions*50},done:function(){if(!t)return!1;let e=t.land.optimizedLand/1000,r=Math.floor(Math.sqrt(e)/10)+1;return t.robots.mines>=r}}),new y({text:"Mine Ore",tooltip:"Get (mines / 100) ore per tick",finish:function(){if(t)t.robots.mineOre(this.workers)}}),new y({text:"Smelt Ore",tooltip:"Each tick costs 5 wood, 1 ore, and 1000 oxygen<br>Gain 1 metal",finish:function(){if(t)t.robots.smeltOre(this.workers)}}),new y({text:"Turn ore into dirt",tooltip:"Each tick costs 1 energy and 1000 ore<br>Gain 5 Base Land<br>Total land gained: <span id='totalDirtFromOre'></span>",ticksNeeded:1000,cost:[1,1000],costType:["power","ore"],spendingCategory:{ore:"oreToDirtSpending"},finish:function(){if(t)t.land.addLand(50)},showing:!1})],t)t.events.on("energy:unlocked",()=>{let e=this.jobs.find((r)=>r.text==="Turn ore into dirt");if(e)e.showing=!0})}tick(){this.woodIncome=0,this.woodSpending=0,this.metalIncome=0,this.metalSpending=0,this.oreIncome=0,this.oreSpending=0,this.oreToDirtSpending=0,this.oxygenSpending=0,this.powerSpending=0;for(let e=0;e<this.jobs.length;e++)this.tickRow(this.jobs[e],this.jobs[e].workers)}tickRow(e,r){if(!t)return;if(e.tick(r,1,(i,n)=>{let u=e.spendingCategory?.[i]||i+"Spending";if(this[u]!==void 0&&typeof this[u]==="number")this[u]+=n})>0)t.events.emit("robots:count:updated")}gainRobots(e){this.robots+=e,this.robotsFree+=e,t?.events.emit("robots:count:updated")}gainStorage(e){this.robotMax+=e,t?.events.emit("robots:storage:updated")}unlockRobots(){if(!t)return;if(t.cash>=3000)t.cash-=3000,this.unlocked=1,t.events.emit("robots:unlocked"),this.gainRobots(1);t.events.emit("robots:count:updated"),t.events.emit("robots:storage:updated")}addWorker(e,r){let s=this.jobs[e];if(s)r=Math.min(r,this.robotsFree),s.workers+=r,this.robotsFree-=r;t?.events.emit("robots:count:updated")}removeWorker(e,r){let s=this.jobs[e];if(s)r=Math.min(r,s.workers),s.workers-=r,this.robotsFree+=r;t?.events.emit("robots:count:updated")}cutTrees(e){if(t&&t.trees.trees>=2*e)t.trees.trees-=2*e,t.wood+=e,this.woodIncome+=e}mineOre(e){if(t){let r=t.robots.mines/100*e;t.ore+=r,this.oreIncome+=r}}smeltOre(e){if(t&&t.wood>=5*e&&t.ore>=e&&t.oxygen>=e*1000)t.wood-=5*e,t.ore-=e,t.oxygen-=1000*e,t.metal+=e,this.woodSpending+=5*e,this.oreSpending+=e,this.oxygenSpending+=1000*e,this.metalIncome+=e}}class Y{unlocked;battery;drain=0;powerPerTick=0;constructor(){this.unlocked=0,this.battery=100}unlockEnergy(){if(t&&t.metal>=500)t.metal-=500,this.unlocked=1,t.events.emit("energy:unlocked");t?.events.emit("energy:battery:updated")}tick(){if(!t)return;if(this.drain=t.computer.powerSpending+t.robots.powerSpending+t.spaceStation.powerSpending,this.powerPerTick=this.battery/100,t.power+=this.powerPerTick,t.power-=this.drain,t.power<0)t.power=0;t.events.emit("energy:updated")}gainEnergy(e){if(t)t.power+=e}buyBattery(e){this.battery+=e,t?.events.emit("energy:battery:updated")}}class D{unlocked;orbiting;waterIncome=0;powerSpending=0;constructor(){this.unlocked=0,this.orbiting=[{type:"ice",amount:1e6},{type:"dirt",amount:500}]}unlockSpaceStation(){if(t&&t.metal>=2000&&t.wood>=20000)t.metal-=2000,t.wood-=20000,this.unlocked=1,t.events.emit("spaceStation:unlocked");t?.events.emit("spaceStation:updated")}tick(){if(this.waterIncome=0,!this.unlocked||!t)return;for(let e=0;e<this.orbiting.length;e++){let r=this.orbiting[e],s=r.amount/1e5;r.amount-=s;let i=r.type;if(i==="ice")t.ice.ice+=s,this.waterIncome+=s;else if(i==="dirt")t.land.addLand(s)}}}function J(e,r,s){let i=e*r,n=s*(i*0.4)+i*0.1,u=Math.pow(Math.pow(i,2)-Math.pow(n,2),0.5),h=(0-n)/u;return{startingY:n,endingX:u,slope:h}}class q{unlocked;cometSpotChance;takeAmount;comets;constructor(){this.unlocked=0,this.cometSpotChance=0.006,this.takeAmount=[{type:"ice",amount:0},{type:"dirt",amount:0}],this.comets=[]}tick(){if(!this.unlocked||!t)return;if(this.checkForNewAsteroids(),this.comets.length){let e=t.power/1000;t.power-=this.pullIntoOrbit(e),this.removeAsteroidIfDone()}}unlockTractorBeam(){if(!t)return;if(t.science>=500000&&t.oxygen>=5000000)t.science-=500000,t.oxygen-=2000000,this.unlocked=1,t.events.emit("tractorBeam:unlocked"),t.spaceDock.unlocked=1,t.events.emit("spaceDock:unlocked");t.events.emit("tractorBeam:updated")}pullIntoOrbit(e){if(!t)return 0;let r=e/this.comets.length,s=0;for(let i=0;i<t.spaceStation.orbiting.length;i++){let n=t.spaceStation.orbiting[i],u=0;for(let m=0;m<this.comets.length;m++){let b=this.comets[m];if(b.amountType===n.type){let T=Math.min(r,b.amount);s+=T,b.amount-=T,u+=T}}n.amount+=u;let h=this.takeAmount.find((m)=>m.type===n.type);if(h)h.amount=u;else this.takeAmount.push({type:n.type,amount:u})}return s}checkForNewAsteroids(){if(Math.random()<this.cometSpotChance)this.addComet()}removeAsteroidIfDone(){let e=this.comets.length-1;for(let r=e;r>=0;r--){let s=this.comets[r];if(s.duration--,s.duration<0||s.amount<1){if(s.drawed)t?.events.emit("tractorBeam:removeComet",s);this.comets.splice(r,1)}}}addComet(){if(!t||this.comets.length>20)return;let e=Math.random(),r=Math.random()*100*t.space.sector+200,s=Math.floor(Math.random()*800+400),i=Math.random()*2+1,n={};if(e<0.9)n={name:"Comet",amountType:"ice",amount:r*1000,initialAmount:r*1000,duration:s,initialDuration:s,speed:i};else n={name:"Asteroid",amountType:"dirt",amount:r,initialAmount:r,duration:s*2,initialDuration:s*2,speed:i/2};n.id=Ie(),n.drawed=!1;let u=J(n.speed||0,n.duration||0,Math.random());n.startingY=u.startingY,n.endingX=u.endingX,n.slope=u.slope,n.left=0,this.comets.push(n)}}class Q{battleships;unlocked;sended;defaultSpeed=0.5;emptySpeed=0.05;constructor(){this.battleships=0,this.unlocked=0,this.sended=0}addBattleship(e){this.battleships+=e,t?.events.emit("spaceDock:updated")}improveEngines(e,r){this.defaultSpeed+=e,this.emptySpeed+=r,t?.events.emit("spaceDock:updated")}}class Z{count;food;actionCounter;energy;x;y;engaged;direction;targetIndex;constructor(e,r,s){this.count=e,this.food=r/s,this.actionCounter=0,this.energy=0,this.x=0,this.y=0,this.engaged=!1,this.direction=0,this.targetIndex=-1}}class U{sendRate;timeRemaining;totalTime;y;maxMines;constructor(){this.sendRate=1,this.timeRemaining=this.totalTime=40,this.y=(t?.canvasHeight||600)*0.5-25,this.maxMines=10}tick(){if(!t)return;if(this.y=t.canvasHeight*0.5-25,this.timeRemaining--,this.timeRemaining<0)if(t.spaceDock.battleships>0&&!t.space.allEmpty){let e=Math.min(this.sendRate,t.spaceDock.battleships),r=t.farms.food*0.05;t.farms.food-=r;let s=new Z(e,r,f.foodPerShip);s.targetIndex=f.globalTargetIndex,t.space.spawnShip(s,this.y),t.spaceDock.battleships-=e,t.spaceDock.sended+=e,t.events.emit("spaceDock:updated"),this.timeRemaining=this.totalTime}else this.timeRemaining=0}getTarget(){return{isHome:!0,x:-125,y:this.y}}}class N{aProgress;color;lastPercentage=-1;constructor(e,r){this.aProgress=document.getElementById(e),this.color=r}tick(e,r){if(!this.aProgress||r<=0)return;let s=e/r;if(Math.abs(this.lastPercentage-s)<0.001)return;this.lastPercentage=s,this.reset(this.aProgress),this.drawProgress(this.aProgress,s,this.color)}reset(e){if(!e)return;let r=e.getContext("2d");if(!r)return;r.lineCap="square";let s=e.width/2,i=e.width/2-5;r.beginPath(),r.lineWidth=8,r.fillStyle="#1e1e1e",r.arc(s,s,i,0,2*Math.PI),r.fill()}drawProgress(e,r,s){if(!e)return;let i=e.getContext("2d");if(!i)return;let n=Math.PI/2,u=2*r*0.95*Math.PI-n*0.9,h=0-n*0.9,m=e.width/2,b=e.width/2-10;i.lineCap="square",i.beginPath(),i.lineWidth=8,i.strokeStyle=s,i.arc(m,m,b,h,u),i.stroke()}}var x=document.getElementById("spaceCanvas"),d=x?x.getContext("2d"):null;if(d)d.font="13px Arial";var C=240,Te={x:0,y:0};function We(){if(!x||!t)return;if(x.width!==t.canvasWidth||x.height!==t.canvasHeight){if(x.width=t.canvasWidth,x.height=t.canvasHeight,C=x.width/5,d)d.font="13px Arial"}}if(x)window.addEventListener("resize",We),We(),x.addEventListener("mousemove",function(e){Te={x:e.offsetX-C,y:e.offsetY}});function we(){if(!d||!t||!x)return;d.clearRect(0,0,x.width,x.height),Ye(),je(),$e()}function $e(){if(!t)return;for(let e=0;e<t.space.planets.length;e++)qe(t.space.planets[e])}function je(){if(!t)return;for(let e=0;e<t.space.ships.length;e++)De(t.space.ships[e])}function Ye(){if(!t)return;for(let e=0;e<t.space.planets.length;e++){let r=t.space.planets[e];Je(r,r.isBoss?"B":(e+1).toString())}}function De(e){if(!d)return;let r=e.x+C,s=f.getTargetObject(e);if(e.engaged&&s&&e.actionCounter<10){let m="isHome"in s,b=xe(!m?s.isBoss:!1);d.save(),d.beginPath(),d.strokeStyle="rgba(255, 50, 50, "+(1-e.actionCounter/10)+")",d.lineWidth=3,d.moveTo(r+25,e.y+25),d.lineTo(s.x+C+b,s.y+b),d.stroke(),d.restore()}d.save(),d.translate(r+25,e.y+25),d.rotate(e.direction);let i={x:-10,y:-10},n={x:10,y:0},u={x:-10,y:10},h={x:-7,y:0};d.beginPath(),d.fillStyle="#008080",d.lineWidth=3,d.moveTo(i.x,i.y),d.lineTo(n.x,n.y),d.lineTo(u.x,u.y),d.lineTo(h.x,h.y),d.fill(),d.restore(),d.save(),d.translate(r+25,e.y+25),d.fillStyle="white",d.fillText(o(e.count),-4,20),d.fillText(o(e.food/e.count/10,1),-4,30),d.restore()}function Je(e,r){if(!d)return;let s=xe(e.isBoss),i=e.x+C;d.save(),d.translate(i+s,e.y+s),Qe(e,s),Ze(e,s),Ue(e,s),d.fillStyle="white",d.fillText(r,-3,4),d.restore()}function qe(e){if(!d)return;let r=xe(e.isBoss),s=e.x+C;if(!O(Te.x,Te.y,e.x+r,e.y+r,50))return;d.save(),d.translate(s+r,e.y+r),d.fillStyle="#ffffff",d.fillText("Atmosphere: "+o(e.atmo),-15,r),d.fillText("Reduction: "+o(a.getShieldReduction(e)*100)+"%",-15,r+10),d.fillText("Health: "+o(e.health),-15,r+20),d.fillText("Dirt: "+o(e.dirt),-15,r+30),d.fillText("Ore: "+o(e.ore),-15,r+40),d.fillText("C.Bots: "+o(e.bots)+" / "+o(e.maxMines),-15,r+50),d.fillText("Solar: "+o(e.solar),-15,r+60),d.fillText("Build Factory: "+o(e.factoryTicks)+" / "+o(a.FACTORY_TICKS_MAX),-15,r+70),d.fillText("Build Coilgun: "+o(e.coilgunTicks)+" / "+o(a.COILGUN_TICKS_MAX),-15,r+80),d.fillText("Coilgun Charge: "+o(e.coilgunCharge)+" / "+o(a.COILGUN_CHARGE_MAX),-15,r+90),d.fillText("Build Solar: "+o(e.solarTicks)+" / "+o(a.SOLAR_TICKS_MAX),-15,r+100),d.fillText("Mines: "+o(e.mines)+" / "+o(e.maxMines),-15,r+110),d.fillText("Build Mine: "+o(e.mineTicks)+" / "+o(a.MINE_TICKS_MAX),-15,r+120),d.restore()}function Qe(e,r){if(!d)return;let s=r*(e.atmo/e.maxAtmo/2+0.5),i=d.createRadialGradient(0,0,s*1.1,0,0,s/3.3);i.addColorStop(0,"black");let n="hsl("+(e.view.color+120)+",90%,60%)";i.addColorStop(1,n),d.fillStyle=i,d.fillRect(-r,-r,r*2,r*2),d.beginPath(),d.strokeStyle="#008080",d.lineWidth=3,d.arc(0,0,r-4,0,2*Math.PI*(e.atmo/e.maxAtmo)),d.stroke()}function Ze(e,r){if(!d)return;d.beginPath();let s=Math.floor(e.health/e.maxHealth*70+10);d.fillStyle="hsl("+e.view.color+","+s+"%,"+e.view.light+"%)",d.arc(0,0,r/2,0,2*Math.PI),d.fill(),d.beginPath(),d.strokeStyle="#b6000b",d.lineWidth=3,d.moveTo(-r*2/3,-r),d.lineTo(-r*2/3+r*4/3*(e.health/e.maxHealth),-r),d.stroke()}function Ue(e,r){if(!d||a.empty(e))return;let s=Math.PI/2,i=-s;if(e.factoryTicks>0&&e.factoryTicks<a.FACTORY_TICKS_MAX){let u=2*(e.factoryTicks/a.FACTORY_TICKS_MAX)*Math.PI-s;d.beginPath(),d.strokeStyle="#888888",d.lineWidth=2,d.arc(0,0,r*0.9,i,u),d.stroke()}if(e.coilgunTicks>0&&e.coilgunTicks<a.COILGUN_TICKS_MAX){let u=2*(e.coilgunTicks/a.COILGUN_TICKS_MAX)*Math.PI-s;d.beginPath(),d.strokeStyle="#884400",d.lineWidth=2,d.arc(0,0,r*0.8,i,u),d.stroke()}if(e.coilgunTicks>=a.COILGUN_TICKS_MAX&&e.coilgunCharge>0){let u=2*(e.coilgunCharge/a.COILGUN_CHARGE_MAX)*Math.PI-s;d.beginPath(),d.strokeStyle="#ffcc00",d.lineWidth=2,d.arc(0,0,r*0.8,i,u),d.stroke()}if(e.solar>0||e.solarTicks>0){let u=2*(e.solarTicks/a.SOLAR_TICKS_MAX)*Math.PI-s;d.beginPath(),d.strokeStyle="#4444ff",d.lineWidth=2,d.arc(0,0,r*0.7,i,u),d.stroke()}if(e.mines<e.maxMines&&e.mineTicks>0){let u=2*(e.mineTicks/a.MINE_TICKS_MAX)*Math.PI-s;d.beginPath(),d.strokeStyle="#666666",d.lineWidth=2,d.arc(0,0,r*0.6,i,u),d.stroke()}}function xe(e){return e?40:25}class p{textCache=new Map;elementCache=new Map;clearCache(){this.textCache.clear(),this.elementCache.clear()}getElement(e){let r=this.elementCache.get(e);if(!r){let s=document.getElementById(e);if(!s)throw Error(`Element ${e} not found`);r=s,this.elementCache.set(e,r)}return r}updateElementText(e,r){if(this.textCache.get(e)===r)return;this.getElement(e).textContent=r,this.textCache.set(e,r)}updateElementHTML(e,r){if(this.textCache.get(e)===r)return;this.getElement(e).innerHTML=r,this.textCache.set(e,r)}elementExists(e){return this.elementCache.has(e)||document.getElementById(e)!==null}setVisible(e,r){if(!this.elementExists(e))return;let s=this.getElement(e);if(r)s.classList.remove("hidden");else s.classList.add("hidden")}updateFull(){this.update()}}class c{static pendingNotifications=new Map;static specialEvents=[];static notifiedThisCycle=new Set;static initialized=!1;static isBatching=!1;static init(){if(this.initialized)return;document.addEventListener("visibilitychange",()=>{if(!document.hidden)this.flush()}),this.initialized=!0}static startBatch(){this.isBatching=!0,this.notifiedThisCycle.clear()}static endBatch(){if(this.isBatching=!1,!document.hidden)this.flush()}static on(e,r,s){if(!e)return;this.init(),e.on(r,(...i)=>{if(document.hidden||this.isBatching)if(r==="tractorBeam:removeComet")this.specialEvents.push({listener:s,args:i});else this.pendingNotifications.set(s,i);else s(...i)})}static notifyOnlyOnce(e,r){let s=r||e;if(this.notifiedThisCycle.has(s))return;this.notifiedThisCycle.add(s),e()}static flush(){if(this.pendingNotifications.size===0&&this.specialEvents.length===0){this.notifiedThisCycle.clear();return}let e=new Map(this.pendingNotifications);this.pendingNotifications.clear();let r=[...this.specialEvents];this.specialEvents=[],this.notifiedThisCycle.clear(),r.forEach((s)=>s.listener(...s.args)),e.forEach((s,i)=>i(...s)),this.notifiedThisCycle.clear()}}class P extends p{rows=new Map;constructor(){super();if(t)c.on(t.events,"computer:unlocked",()=>this.checkUnlocked()),c.on(t.events,"computer:threads:updated",()=>this.updateThreads()),c.on(t.events,"computer:speed:updated",()=>this.updateSpeed()),c.on(t.events,"computer:optimize-land:updated",()=>this.updateLandOptimized()),c.on(t.events,"robots:unlocked",()=>this.updateVisibility()),c.on(t.events,"spaceDock:unlocked",()=>this.updateVisibility()),c.on(t.events,"computer:visibility:updated",()=>this.updateVisibility())}checkUnlocked(){if(!t)return;if(t.computer.unlocked)this.setVisible("unlockedComputer",!0),this.setVisible("unlockComputer",!1),this.setVisible("robotsContainer",!0),this.updateThreads(),this.updateSpeed(),this.updateVisibility();else this.setVisible("unlockedComputer",!1),this.setVisible("unlockComputer",!0),this.setVisible("robotsContainer",!1)}updateVisibility(){if(!t)return;for(let e=0;e<t.computer.processes.length;e++){let r=t.computer.processes[e];if(!r)continue;this.setVisible("computerRow"+e+"Container",r.showing)}}updateLandOptimized(){if(!t)return;this.updateElementText("landOptimized",Oe(t.land.optimizedLand/(t.land.baseLand*10)*100)+"%")}updateThreads(){if(!t)return;this.updateElementText("freeThreads",o(t.computer.freeThreads)),this.updateElementText("threads",o(t.computer.threads)),this.updateElementText("threadCost",o(t.computer.getThreadCost()));for(let e=0;e<t.computer.processes.length;e++){let r=t.computer.processes[e];if(!r)continue;let s="computerRow"+e+"Threads";if(r.showing&&this.elementExists(s))this.updateElementText(s,o(r.workers))}}updateSpeed(){if(!t)return;this.updateElementText("speed",o(t.computer.speed)),this.updateElementText("speedCost",o(t.computer.getSpeedCost()))}updateRowProgress(e){if(!t||!t.computer.unlocked)return;let r=t.computer.processes[e];if(!r||!r.showing)return;let s="computerRow"+e;if(!this.elementExists(s+"PB"))return;let i=this.getElement(s+"PB");i.style.width=r.currentTicks/r.ticksNeeded*100+"%",i.style.backgroundColor=r.isMoving?"yellow":"red",this.updateElementText(s+"CurrentTicks",o(r.currentTicks)),this.updateElementText(s+"TicksNeeded",o(r.ticksNeeded));let n=this.getElement(s+"CostContainer");if(r.cost!==0){n.classList.remove("hidden");let u=Array.isArray(r.cost)?r.cost[0]||0:r.cost,h=Array.isArray(r.costType)?r.costType[0]||"":r.costType;this.updateElementText(s+"Cost",o(u)),this.updateElementText(s+"CostType",h)}else n.classList.add("hidden")}addComputerRow(e){let r=this.getElement("computerRows"),s=document.createElement("div");s.className="computerRow";let i="computerRow"+e;s.id=i+"Container";let n=document.createElement("button");n.id=i+"Plus",n.innerHTML="+",n.addEventListener("click",(E)=>t?.computer.addThread(e,F(E)));let u=document.createElement("button");u.id=i+"Minus",u.innerHTML="-",u.addEventListener("click",(E)=>t?.computer.removeThread(e,F(E)));let h=document.createElement("div");h.id=i+"Threads",h.className="small",h.style.marginRight="4px";let m=t?.computer.processes[e]?.text||"",b=document.createElement("div");b.innerHTML=m;let T=document.createElement("div");T.className="rowProgressBarOuter",T.innerHTML="<div class='rowProgressBarInner' id='"+i+"PB'></div>";let l=document.createElement("div");l.className="computerTooltipContainer",l.id=i+"Tooltip";let w=document.createElement("div");w.className="rowTooltip";let v=t?.computer.processes[e]?.tooltip||"";w.innerHTML=`
            <div class="tooltipDescription">${v}</div>
            <div class="tooltipDivider"></div>
            <div class="tooltipStats">
                <div><b>Progress:</b> <span id="${i}CurrentTicks"></span> / <span id="${i}TicksNeeded"></span> ticks</div>
                <div id="${i}CostContainer" class="hidden"><b>Cost:</b> <span id="${i}Cost"></span> <span id="${i}CostType"></span> per tick</div>
            </div>
        `,l.appendChild(w),s.appendChild(n),s.appendChild(h),s.appendChild(u);let S=document.createElement("div");S.className="rowLabel",S.appendChild(b),s.appendChild(S),s.appendChild(T),s.appendChild(l),r.appendChild(s)}update(){}updateFull(){if(!t)return;if(this.checkUnlocked(),t.computer.unlocked)this.updateLandOptimized(),this.updateVisibility(),this.updateThreads(),this.updateSpeed()}}class z extends p{rows=new Map;constructor(){super();if(t)c.on(t.events,"robots:unlocked",()=>{this.checkUnlocked(),this.updateFull()}),c.on(t.events,"robots:count:updated",()=>c.notifyOnlyOnce(()=>this.updateCount(),this.updateCount)),c.on(t.events,"robots:storage:updated",()=>c.notifyOnlyOnce(()=>this.updateStorage(),this.updateStorage)),c.on(t.events,"robots:mines:updated",()=>c.notifyOnlyOnce(()=>this.updateMinesCount(),this.updateMinesCount)),c.on(t.events,"energy:unlocked",()=>{this.updateVisibility()})}checkUnlocked(){if(!t)return;if(t.robots.unlocked)this.setVisible("unlockedRobots",!0),this.setVisible("unlockRobots",!1),this.setVisible("lightningContainer",!0),this.setVisible("lightningTooltip",!0),this.setVisible("energyContainer",!0),this.setVisible("woodContainer",!0),this.setVisible("oreContainer",!0),this.setVisible("metalContainer",!0),this.updateCount(),this.updateStorage(),this.updateMinesCount(),this.updateVisibility();else this.setVisible("unlockedRobots",!1),this.setVisible("unlockRobots",!0),this.setVisible("lightningContainer",!1),this.setVisible("lightningTooltip",!1),this.setVisible("energyContainer",!1),this.setVisible("woodContainer",!1),this.setVisible("oreContainer",!1),this.setVisible("metalContainer",!1)}updateVisibility(){if(!t)return;for(let e=0;e<t.robots.jobs.length;e++){let r=t.robots.jobs[e];if(!r)continue;this.setVisible("robotRow"+e+"Container",r.showing)}}updateCount(){if(!t)return;if(this.updateElementText("robots",o(t.robots.robots)),this.updateElementText("robotsFree",o(t.robots.robotsFree)),t.robots.jobs[2]&&this.elementExists("minesLimit")){let r=t.land.optimizedLand/1000,s=Math.floor(Math.pow(r,2)/10);this.updateElementText("minesLimit",o(s))}if(t.robots.jobs[5]&&this.elementExists("totalDirtFromOre"))this.updateElementText("totalDirtFromOre",o(t.robots.jobs[5].completions*5));for(let r=0;r<t.robots.jobs.length;r++){let s=t.robots.jobs[r];if(!s)continue;let i="robotRow"+r;if(s.showing&&this.elementExists(i+"Workers"))this.updateElementText(i+"Workers",o(s.workers))}}updateMinesCount(){if(!t)return;if(this.elementExists("minesCount"))this.updateElementText("minesCount",o(t.robots.mines))}updateStorage(){if(!t)return;this.updateElementText("robotMax",o(t.robots.robotMax))}updateRowProgress(e){if(!t)return;let r=t.robots.jobs[e];if(!r||!r.showing||r.ticksNeeded===0)return;let s="robotRow"+e;if(!this.elementExists(s+"PB"))return;let i=this.getElement(s+"PB");i.style.width=r.currentTicks/r.ticksNeeded*100+"%",i.style.backgroundColor=r.isMoving?"yellow":"red",this.updateElementText(s+"CurrentTicks",o(r.currentTicks)),this.updateElementText(s+"TicksNeeded",o(r.ticksNeeded));let n=this.getElement(s+"CostContainer");if(r.cost&&r.costType){n.classList.remove("hidden");let u=Array.isArray(r.cost)?r.cost:[r.cost],h=Array.isArray(r.costType)?r.costType:[r.costType],m=o(u[0]||0)+" "+(h[0]||"");m+=u.length>1?" and "+o(u[1]||0)+" "+(h[1]||""):"",this.updateElementText(s+"Cost",m)}else n.classList.add("hidden")}addRobotRow(e){let r=this.getElement("robotRows"),s=document.createElement("div");s.className="robotRow";let i="robotRow"+e;s.id=i+"Container";let n=document.createElement("button");n.id=i+"Plus",n.innerHTML="+",n.addEventListener("click",(L)=>t?.robots.addWorker(e,F(L)));let u=document.createElement("button");u.id=i+"Minus",u.innerHTML="-",u.addEventListener("click",(L)=>t?.robots.removeWorker(e,F(L)));let h=document.createElement("div");h.id=i+"Workers",h.className="small",h.style.marginRight="4px";let m=t?.robots.jobs[e]?.text||"",b=document.createElement("div");b.id=i+"Text",b.innerHTML=m;let T=document.createElement("div");if(t?.robots.jobs[e]?.ticksNeeded)T.className="rowProgressBarOuter",T.innerHTML="<div class='rowProgressBarInner' id='"+i+"PB'></div>";let l=document.createElement("div");l.className="computerTooltipContainer",l.id=i+"Tooltip";let w=document.createElement("div");w.className="rowTooltip";let v=t?.robots.jobs[e]?.tooltip||"",S="";if(t?.robots.jobs[e]?.ticksNeeded)S=`
                <div class="tooltipDivider"></div>
                <div class="tooltipStats">
                    <div><b>Progress:</b> <span id="${i}CurrentTicks"></span> / <span id="${i}TicksNeeded"></span> ticks</div>
                    <div id="${i}CostContainer" class="hidden"><b>Cost:</b> <span id="${i}Cost"></span> per tick</div>
                </div>
            `;w.innerHTML=`
            <div class="tooltipDescription" id="${i}Description">${v}</div>
            ${S}
        `,l.appendChild(w),s.appendChild(n),s.appendChild(h),s.appendChild(u);let E=document.createElement("div");if(E.className="rowLabel",E.appendChild(b),s.appendChild(E),T.innerHTML)s.appendChild(T);s.appendChild(l),r.appendChild(s)}update(){}updateFull(){if(!t)return;if(this.checkUnlocked(),t.robots.unlocked)this.updateCount(),this.updateStorage(),this.updateMinesCount(),this.updateVisibility()}}class ee extends p{constructor(){super();if(t){let e=()=>c.notifyOnlyOnce(()=>this.update(),this);c.on(t.events,"ice:updated",e),c.on(t.events,"water:updated",e),c.on(t.events,"clouds:updated",e),c.on(t.events,"land:updated",e),c.on(t.events,"trees:updated",e),c.on(t.events,"farms:updated",e),c.on(t.events,"population:updated",e),c.on(t.events,"energy:updated",e),c.on(t.events,"resources:updated",e)}}update(){if(!t)return;this.updateElementText("totalWater",o(t.ice.ice+t.water.indoor+t.water.outdoor+t.clouds.water+t.land.water+t.trees.water+t.farms.water)),this.updateElementText("waterIncome",o(t.spaceStation.waterIncome,4)),this.updateElementText("waterBought",o(t.ice.buyIncome,4)),this.updateElementText("waterSpending",o(t.water.waterSpending,4)),this.updateElementText("waterFarms",o(t.farms.waterSpending,4)),this.updateElementText("waterTrees",o(t.trees.waterSpending,4)),this.updateElementText("waterNet",g(t.spaceStation.waterIncome+t.ice.buyIncome-t.water.waterSpending-t.farms.waterSpending-t.trees.waterSpending,4)),this.updateElementText("cash",o(t.cash)),this.updateElementText("cashIncome",o(t.population.cashDelta+t.water.gain,4)),this.updateElementText("cashFromPeople",o(t.population.cashDelta,4)),this.updateElementText("cashFromWater",o(t.water.gain,4)),this.updateElementText("cashComputer",o(t.computer.cashSpending,4)),this.updateElementText("cashNet",g(t.population.cashDelta+t.water.gain-t.computer.cashSpending,4)),this.updateElementText("oxygen",o(t.oxygen)),this.updateElementText("oxygenIncome",o(t.trees.oxygenGain,4)),this.updateElementText("oxygenLeak",o(t.oxygenLeak,4)),this.updateElementText("oxygenSmelting",o(t.robots.oxygenSpending,4)),this.updateElementText("oxygenNet",g(t.trees.oxygenGain-t.oxygenLeak-t.robots.oxygenSpending,4)),this.updateElementText("science",o(t.science)),this.updateElementText("scienceIncome",o(t.population.scienceDelta,4)),this.updateElementText("scienceComputer",o(t.computer.scienceSpending,4)),this.updateElementText("scienceNet",g(t.population.scienceDelta-t.computer.scienceSpending,4)),this.updateElementText("wood",o(t.wood)),this.updateElementText("woodIncome",o(t.robots.woodIncome,4)),this.updateElementText("woodSpending",o(t.robots.woodSpending,4)),this.updateElementText("woodComputer",o(t.computer.woodSpending,4)),this.updateElementText("woodNet",g(t.robots.woodIncome-t.robots.woodSpending-t.computer.woodSpending,4)),this.updateElementText("metal",o(t.metal)),this.updateElementText("metalIncome",o(t.robots.metalIncome,4)),this.updateElementText("metalSpending",o(t.robots.metalSpending,4)),this.updateElementText("metalComputer",o(t.computer.metalSpending,4)),this.updateElementText("metalNet",g(t.robots.metalIncome-t.robots.metalSpending-t.computer.metalSpending,4)),this.updateElementText("ore",o(t.ore,4)),this.updateElementText("oreIncome",o(t.robots.oreIncome,4)),this.updateElementText("oreSpending",o(t.robots.oreSpending,4)),this.updateElementText("oreToDirtSpending",o(t.robots.oreToDirtSpending,4)),this.updateElementText("oreNet",g(t.robots.oreIncome-t.robots.oreSpending-t.robots.oreToDirtSpending,4))}}class te extends p{constructor(){super();if(t)c.on(t.events,"water:maxIndoor:updated",()=>{this.updateFull()}),c.on(t.events,"ice:updated",()=>c.notifyOnlyOnce(()=>this.update(),this))}updateFull(){if(!t)return;this.updateElementText("indoorWaterMax",o(t.water.maxIndoor)),this.update()}update(){if(!t)return;this.updateElementText("ice",o(t.ice.ice)),this.updateElementText("buyableIce",o(t.ice.buyable)),this.updateElementText("iceTransferred",o(t.ice.transferred,4)),this.updateElementText("indoorWaterReceived",o(Math.max(0,t.ice.transferred-t.water.excess),4)),this.updateElementText("iceBuyerAmount",o(t.ice.gain)),this.updateElementText("indoorWater",o(t.water.indoor)),this.updateElementText("indoorWaterSelling",o(t.water.selling)),this.updateElementText("indoorWaterProfits",o(t.water.gain)),this.updateElementText("excessWater",o(t.water.excess,4))}}class re extends p{constructor(){super();if(t)c.on(t.events,"clouds:updated",()=>c.notifyOnlyOnce(()=>this.update(),this))}update(){if(!t)return;this.updateElementText("clouds",o(t.clouds.water)),this.updateElementText("stormTimer",o(t.clouds.stormTimer)),this.updateElementText("stormRate",t.clouds.stormRate+"%"),this.getElement("intensityPB").style.height=t.clouds.stormRate+"%",this.updateElementText("stormDuration",o(t.clouds.stormDuration)),this.updateElementText("rain",o(t.clouds.transferred,4)),this.updateElementText("landReceived",o(t.clouds.transferred,4)),this.updateElementText("lightningChance",o(t.clouds.lightningChance)+"%"),this.getElement("lightningPB").style.height=t.clouds.lightningChance+"%",this.updateElementText("lightningStrength",o(t.clouds.lightningStrength))}}class se extends p{constructor(){super();if(t)c.on(t.events,"land:updated",()=>c.notifyOnlyOnce(()=>this.update(),this))}update(){if(!t)return;this.updateElementText("outdoorWater",o(t.water.outdoor)),this.updateElementText("lakeWaterFromStorage",o(t.water.excess,4)),this.updateElementText("waterTransferred",o(t.water.transferred,4)),this.updateElementText("cloudsReceived",o(t.water.transferred,4)),this.updateElementText("landWater",o(t.land.water)),this.updateElementText("optimizedLand",o(t.land.optimizedLand)),this.updateElementText("baseLand",o(t.land.baseLand)),this.updateElementText("land",o(t.land.land)),this.updateElementText("soil",o(t.land.soil)),this.updateElementText("landConverted",o(t.land.convertedLand,4)),this.updateElementText("landWaterToForest",o(t.land.transferred,4)),this.updateElementText("forestReceived",o(t.land.transferred,4)),this.updateElementText("landWaterToFarm",o(t.land.transferred,4)),this.updateElementText("farmReceived",o(t.land.transferred,4)),this.updateElementText("farmsWater",o(t.farms.water)),this.updateElementText("food",o(t.farms.food)),this.updateElementText("foodCreated",o(t.farms.foodCreated,4)),this.updateElementText("farmFoodEaten",o(t.population.foodEaten,4)),this.updateElementText("farmWaterToLake",o(t.farms.transferred,4)),this.updateElementText("lakeWaterFromFarm",o(t.farms.transferred,4)),this.updateElementText("farms",o(t.farms.farms)),this.updateElementText("efficiency",o(t.farms.efficiency*100)),this.updateElementText("farmRatioLabel",t.farms.farmRatio+"% soil to farms")}}class oe extends p{constructor(){super();if(t)c.on(t.events,"population:updated",()=>c.notifyOnlyOnce(()=>this.update(),this))}update(){if(!t)return;this.updateElementText("population",o(t.population.people)),this.updateElementText("foodEaten",o(t.population.foodEaten,4)),this.updateElementText("populationGrowth",g(t.population.popGrowth,4)),this.updateElementText("starving",o(t.population.starving,4)),this.updateElementText("scienceDelta",o(t.population.scienceDelta,4)),this.updateElementText("cashDelta",o(t.population.cashDelta,4)),this.updateElementText("scienceRatio",t.population.scienceRatio<50?100-t.population.scienceRatio+"% science":t.population.scienceRatio+"% cash"),this.updateElementText("happiness",o(t.population.happiness,4)),this.updateElementText("happinessFromHouse",o(t.population.houseBonus)),this.updateElementText("happinessFromTrees",o(t.population.happinessFromTrees,4)),this.updateElementText("happinessFromOxygen",o(t.population.happinessFromOxygen,4))}}class ie extends p{constructor(){super();if(t)c.on(t.events,"trees:updated",()=>c.notifyOnlyOnce(()=>this.update(),this))}update(){if(!t)return;this.updateElementText("forestWater",o(t.trees.water)),this.updateElementText("ferns",o(t.trees.ferns)),this.updateElementText("fernsDelta",o(t.trees.fernsDelta,4)),this.updateElementText("smallTrees",o(t.trees.smallTrees)),this.updateElementText("smallTreesDelta",o(t.trees.smallTreesDelta,4)),this.updateElementText("trees",o(t.trees.trees)),this.updateElementText("treesDelta",o(t.trees.treesDelta,4)),this.updateElementText("totalPlants",o(t.trees.totalPlants)),this.updateElementText("oxygenGain",o(t.trees.oxygenGain,4)),this.updateElementText("forestWaterToLake",o(t.trees.transferred,4)),this.updateElementText("lakeWaterFromForest",o(t.trees.transferred,4)),this.updateElementText("fernWater",o(t.trees.fernsWaterUse,4)),this.updateElementText("smallTreesWater",o(t.trees.smallTreesWaterUse,4)),this.updateElementText("treesWater",o(t.trees.treesWaterUse,4))}}class ne extends p{constructor(){super();if(t){c.on(t.events,"energy:unlocked",()=>{this.checkUnlocked(),this.updateFull()}),c.on(t.events,"energy:battery:updated",()=>this.updateFull()),c.on(t.events,"energy:updated",()=>c.notifyOnlyOnce(()=>this.update(),this));let e=document.getElementById("buyBattery");if(e)e.addEventListener("change",()=>this.updateFull())}}checkUnlocked(){if(!t)return;if(t.energy.unlocked){if(this.setVisible("unlockedEnergy",!0),this.setVisible("unlockEnergy",!1),this.getElement("spaceStationContainer").classList.contains("hidden"))this.getElement("spaceStationContainer").classList.remove("hidden")}else if(this.setVisible("unlockedEnergy",!1),this.setVisible("unlockEnergy",!0),!this.getElement("spaceStationContainer").classList.contains("hidden"))this.getElement("spaceStationContainer").classList.add("hidden")}update(){if(!t)return;this.updateElementText("energy",o(t.power)),this.updateElementText("drain",o(t.energy.drain))}updateFull(){if(!t)return;if(this.checkUnlocked(),t.energy.unlocked){this.updateElementText("battery",o(t.energy.battery));let e=document.getElementById("buyBattery"),r=e?Number(e.value):1;this.updateElementText("batteryCost",o(r*30000)+" oxygen and "+o(r*20000)+" science")}this.update()}}class ue extends p{constructor(){super();if(t)c.on(t.events,"spaceStation:unlocked",()=>this.checkUnlocked()),c.on(t.events,"spaceStation:updated",()=>c.notifyOnlyOnce(()=>this.update(),this))}checkUnlocked(){if(!t)return;if(t.spaceStation.unlocked)this.setVisible("spaceStationContainer",!0),this.setVisible("unlockedSpaceStation",!0),this.setVisible("unlockSpaceStation",!1),this.setVisible("tractorBeamContainer",!0);else this.setVisible("spaceStationContainer",!1),this.setVisible("unlockedSpaceStation",!1),this.setVisible("unlockSpaceStation",!0),this.setVisible("tractorBeamContainer",!1)}updateFull(){if(!t)return;if(this.checkUnlocked(),t.spaceStation.unlocked)this.update()}update(){if(!t)return;let e="",r="";for(let s=0;s<t.spaceStation.orbiting.length;s++){let i=t.spaceStation.orbiting[s];if(!i)continue;if(e+=o(i.amount)+" "+i.type,r+=o(i.amount/1e4,4)+" "+i.type,s!==t.spaceStation.orbiting.length-1)e+=", ",r+=", "}this.updateElementText("orbitingResources",e),this.updateElementText("orbitSending",r)}}class de extends p{cometRows=new Map;takeAmountRows=new Map;constructor(){super();let e=document.getElementById("allPassing");if(e)e.innerHTML="";let r=document.getElementById("takeAmountContainer");if(r)r.innerHTML="";if(t)c.on(t.events,"tractorBeam:unlocked",()=>this.checkUnlocked()),c.on(t.events,"tractorBeam:updated",()=>c.notifyOnlyOnce(()=>this.update(),this)),c.on(t.events,"tractorBeam:removeComet",(s)=>{if(k)k.removeComet(s)})}checkUnlocked(){if(!t)return;if(t.tractorBeam.unlocked)this.setVisible("unlockedTractorBeam",!0),this.setVisible("unlockTractorBeam",!1);else this.setVisible("unlockedTractorBeam",!1),this.setVisible("unlockTractorBeam",!0)}updateFull(){if(!t)return;if(this.checkUnlocked(),t.tractorBeam.unlocked)this.update()}update(){if(!t||!k)return;let e=this.getElement("allPassing"),r=t.tractorBeam.comets,s=new Set(r.map((i)=>i.id));for(let[i,n]of this.cometRows.entries())if(!s.has(i))n.remove(),this.cometRows.delete(i);for(let i=0;i<r.length;i++){let n=r[i];if(!n)continue;if(!this.cometRows.has(n.id)){let u=document.createElement("div");u.className="comet-row",u.innerHTML=`<span>${n.name}</span> with <span id="comet-amount-${n.id}"></span> ${n.amountType} passing in <span id="comet-duration-${n.id}"></span>`,e.appendChild(u),this.cometRows.set(n.id,u)}this.updateElementText(`comet-amount-${n.id}`,o(n.amount)),this.updateElementText(`comet-duration-${n.id}`,o(n.duration)),k.drawComet(n)}this.updateTakeAmount()}updateTakeAmount(){if(!t)return;let e=this.getElement("takeAmountContainer"),s=t.tractorBeam.takeAmount.filter((u)=>u.amount>0),i=s.map((u)=>u.type).join(","),n=Array.from(this.takeAmountRows.keys()).join(",");if(i!==n){e.innerHTML="",this.takeAmountRows.clear();for(let u=0;u<s.length;u++){let h=s[u],m=document.createElement("span"),b=u===s.length-1;m.innerHTML=`<span id="takeAmountVal-${h.type}"></span> ${h.type}${b?"":", "}`,e.appendChild(m),this.takeAmountRows.set(h.type,m)}}for(let u of s)this.updateElementText(`takeAmountVal-${u.type}`,o(u.amount,3))}}class ce extends p{constructor(){super();if(t)c.on(t.events,"spaceDock:unlocked",()=>{this.checkUnlocked(),this.updateFull()}),c.on(t.events,"spaceDock:updated",()=>c.notifyOnlyOnce(()=>this.update(),this))}checkUnlocked(){if(!t)return;if(t.spaceDock.unlocked)this.setVisible("spaceDockContainer",!0),this.setVisible("hangarContainer",!0),this.setVisible("spaceCanvas",!0),this.setVisible("spaceContainer",!0),this.update();else this.setVisible("spaceDockContainer",!1),this.setVisible("hangarContainer",!1),this.setVisible("spaceCanvas",!1),this.setVisible("spaceContainer",!1)}updateFull(){if(!t)return;if(this.checkUnlocked(),t.spaceDock.unlocked)this.update()}update(){if(!t)return;this.updateElementText("battleships",o(t.spaceDock.battleships)),this.updateElementText("totalBattleships",o(t.spaceDock.battleships+t.spaceDock.sended));let e=document.getElementById("buyBattleshipAmount"),r=e?Number(e.value):1;this.updateElementText("battleshipCost",o(r*30000000)+" oxygen and "+o(r*15000000)+" science")}}class ae extends p{constructor(){super();if(t){c.on(t.events,"hangar:updated",()=>c.notifyOnlyOnce(()=>this.updateFull(),this));let e=document.getElementById("maxMinesInput");if(e)e.addEventListener("change",(r)=>{if(t)t.hangar.maxMines=Number(r.target.value)})}}update(){if(!t)return;this.updateElementText("hangarSending",t.hangar.sendRate+" in "+Re(t.hangar.timeRemaining/10)+" seconds.")}updateFull(){if(!t)return;if(this.getElement("hangarContainer").classList.contains("hidden"))return;let e=document.getElementById("buyHangarAmount"),r=e?Number(e.value):1;this.updateElementText("hangarCost",o(r*1e6));let s=document.getElementById("maxMinesInput");if(s)s.value=t.hangar.maxMines.toString();this.update()}}class me extends p{progressBar1;progressBar2;computerView;robotsView;resourceView;iceView;cloudsView;landView;populationView;treesView;energyView;spaceStationView;tractorBeamView;spaceDockView;hangarView;cometPool=[];allContainers=[];columns=[];lastVisibleCount=-1;lastWidth=-1;resizeHandler;constructor(){super();this.progressBar1=new N("nextStormProgress","#21276a"),this.progressBar2=new N("stormDurationProgress","#1c7682"),this.computerView=new P,this.robotsView=new z,this.resourceView=new ee,this.iceView=new te,this.cloudsView=new re,this.landView=new se,this.populationView=new oe,this.treesView=new ie,this.energyView=new ne,this.spaceStationView=new ue,this.tractorBeamView=new de,this.spaceDockView=new ce,this.hangarView=new ae;let e=this.getElement("mainContainer");e.querySelectorAll(".container").forEach((s)=>e.appendChild(s)),e.querySelectorAll(".column").forEach((s)=>s.remove()),this.allContainers=Array.from(e.querySelectorAll(".container"));let r=this.getElement("cometsContainer");if(r)r.innerHTML="";if(this.resizeHandler=()=>this.refreshLayout(),window.addEventListener("resize",this.resizeHandler),t)c.on(t.events,"tick",()=>this.update()),c.on(t.events,"computer:unlocked",()=>this.refreshLayout()),c.on(t.events,"robots:unlocked",()=>this.refreshLayout()),c.on(t.events,"energy:unlocked",()=>this.refreshLayout()),c.on(t.events,"spaceStation:unlocked",()=>this.refreshLayout()),c.on(t.events,"tractorBeam:unlocked",()=>this.refreshLayout()),c.on(t.events,"spaceDock:unlocked",()=>this.refreshLayout())}destroy(){window.removeEventListener("resize",this.resizeHandler)}update(){if(!t)return;c.notifyOnlyOnce(()=>this.resourceView.update(),this.resourceView),c.notifyOnlyOnce(()=>this.iceView.update(),this.iceView),c.notifyOnlyOnce(()=>this.cloudsView.update(),this.cloudsView),c.notifyOnlyOnce(()=>this.landView.update(),this.landView),c.notifyOnlyOnce(()=>this.treesView.update(),this.treesView),c.notifyOnlyOnce(()=>this.populationView.update(),this.populationView),this.updateComputerRowProgress(),this.updateRobotsRowProgress(),c.notifyOnlyOnce(()=>this.energyView.update(),this.energyView),c.notifyOnlyOnce(()=>this.spaceStationView.update(),this.spaceStationView),c.notifyOnlyOnce(()=>this.tractorBeamView.update(),this.tractorBeamView),c.notifyOnlyOnce(()=>this.hangarView.update(),this.hangarView),this.progressBar1.tick(t.clouds.initialStormTimer-t.clouds.stormTimer,t.clouds.initialStormTimer),this.progressBar2.tick(t.clouds.stormDuration,t.clouds.initialStormDuration),we()}updateFull(){if(!t)return;this.resourceView.updateFull(),this.iceView.updateFull(),this.cloudsView.updateFull(),this.landView.updateFull(),this.treesView.updateFull(),this.populationView.updateFull(),this.computerView.updateFull(),this.robotsView.updateFull(),this.energyView.updateFull(),this.spaceStationView.updateFull(),this.tractorBeamView.updateFull(),this.spaceDockView.updateFull(),this.hangarView.updateFull()}refreshLayout(){let e=this.getElement("mainContainer");if(e.offsetWidth===0)return;let r=window.getComputedStyle(e),s=parseFloat(r.columnGap||r.gap||"0"),i=280,n=e.querySelector(".column");if(n)i=parseFloat(window.getComputedStyle(n).minWidth);else{let l=document.createElement("div");l.className="column",l.style.visibility="hidden",l.style.position="absolute",e.appendChild(l),i=parseFloat(window.getComputedStyle(l).minWidth),e.removeChild(l)}i=Math.max(200,i||0);let u=i+s,h=e.offsetWidth,m=Math.max(1,Math.floor((h+s)/u)),b=this.allContainers.filter((l)=>!l.classList.contains("hidden")),T=b.length;if(this.columns.length===m&&T===this.lastVisibleCount&&h===this.lastWidth)return;b.sort((l,w)=>w.offsetHeight-l.offsetHeight);for(let l of this.allContainers)e.appendChild(l);if(this.columns.length!==m){this.columns.forEach((l)=>l.remove()),this.columns=[];for(let l=0;l<m;l++){let w=document.createElement("div");w.className="column",e.appendChild(w),this.columns.push(w)}}if(this.lastVisibleCount=T,this.lastWidth=h,this.columns.length===0)return;for(let l=0;l<b.length;l++){let w=b[l],v=this.columns[0];if(l<this.columns.length)v=this.columns[l];else{let S=v.offsetHeight;for(let E=1;E<this.columns.length;E++){let L=this.columns[E];if(L.offsetHeight<S)v=L,S=L.offsetHeight}}v.appendChild(w)}}clearComputerRows(){this.getElement("computerRows").innerHTML="",this.computerView.clearCache()}clearRobotRows(){this.getElement("robotRows").innerHTML="",this.robotsView.clearCache()}updateComputerRowProgress(){if(!t||!t.computer.unlocked)return;for(let e=0;e<t.computer.processes.length;e++)this.computerView.updateRowProgress(e)}updateRobotsRowProgress(){if(!t)return;for(let e=0;e<t.robots.jobs.length;e++)this.robotsView.updateRowProgress(e)}drawComet(e){let r,s="comet"+e.id;if(!e.drawed){if(r=this.cometPool.pop()||document.createElement("div"),r.className=e.name.toLowerCase(),r.id=s,r.classList.remove("hidden"),e.startingY===void 0){let i=J(e.speed,e.initialDuration,Math.random());e.startingY=i.startingY,e.endingX=i.endingX,e.slope=i.slope}this.getElement("cometsContainer").appendChild(r),e.drawed=!0}else r=document.getElementById(s);if(r){e.left=(e.initialDuration-e.duration)/e.initialDuration*e.endingX,e.top=e.slope*e.left+e.startingY;let i=e.amountType==="ice"?e.amount/1000:e.amount,u=(e.name==="Comet"?40:20)*Math.sqrt(i/200);r.style.width=Math.round(u)+"px",r.style.height=Math.round(u)+"px",r.style.borderRadius=Math.round(u/2)+"px",r.style.left=Math.round(e.left-u/2)+"px",r.style.top=Math.round(e.top-u/2)+"px"}}removeComet(e){let r="comet"+e.id,s=document.getElementById(r);if(s)s.classList.add("hidden"),s.id="",this.cometPool.push(s);else console.log(r+"not found")}}var Ae=()=>{let e=(n,u)=>{let h=document.getElementById(n);if(h)h.addEventListener("click",u)};e("btnHardReset",Be),e("btnPause",Ee),e("btnBeg",Ge),e("btnSave",le),e("btnExport",He),e("btnImport",_e),e("btnBuyIce",()=>t?.buyIce()),e("unlockComputer",()=>t?.computer.unlockComputer()),e("buyThread",()=>t?.computer.buyThread()),e("buySpeed",()=>t?.computer.buySpeed()),e("unlockRobots",()=>t?.robots.unlockRobots()),e("unlockEnergy",()=>t?.energy.unlockEnergy()),e("btnBuyBattery",()=>t?.buyBattery()),e("unlockSpaceStation",()=>t?.spaceStation.unlockSpaceStation()),e("unlockTractorBeam",()=>t?.tractorBeam.unlockTractorBeam()),e("btnBuyBattleship",()=>t?.buyBattleship()),e("btnBuyHangar",()=>t?.buyHangar()),document.getElementById("mainContainer")?.addEventListener("contextmenu",(n)=>n.preventDefault()),document.getElementById("scienceSlider")?.addEventListener("input",function(){if(t)t.population.scienceRatio=Number(this.value)}),document.getElementById("farmSlider")?.addEventListener("input",function(){if(t)t.farms.farmRatio=Number(this.value)}),document.querySelectorAll(".numeric-input-small").forEach((n)=>{n.addEventListener("change",function(){let u=Number(this.value);if(isNaN(u)||u<1)this.value="1";else if(u!==Math.floor(u))this.value=Math.floor(u).toString()})})};if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",Ae);else Ae();var he=[];function Pe(){if(he.length===0)return;let e=he[0]?.key;if(he.splice(0,1),e===66)t?.buyIce()}document.addEventListener("keydown",function(e){let r={key:e.charCode!==0?e.charCode:e.keyCode,shift:e.shiftKey};he.push(r),Pe()});class fe{events=new Map;on(e,r){if(!this.events.has(e))this.events.set(e,[]);this.events.get(e)?.push(r)}off(e,r){let s=this.events.get(e);if(s)this.events.set(e,s.filter((i)=>i!==r))}emit(e,...r){let s=this.events.get(e);if(s)s.forEach((i)=>i(...r))}}var t=null,k=null,Ve=0,ge=!1,Xe=0;function ze(){Ve++}function et(){ge=!ge}function Ie(){return Xe++,Xe}class Ke{totalLand;cash;oxygen;science;wood;metal;ore;power;oxygenLeak=0;canvasWidth=1200;canvasHeight=600;space;ice;water;clouds;land;trees;farms;population;computer;robots;energy;spaceStation;tractorBeam;spaceDock;hangar;events;constructor(){this.totalLand=1000,this.cash=100,this.oxygen=0,this.science=0,this.wood=0,this.metal=0,this.ore=0,this.power=0,this.canvasWidth=1200,this.canvasHeight=600,this.events=new fe}tick(){this.water.waterSpending=0,this.water.gain=0,this.ice.tick(),this.robots.tick(),this.computer.tick(),this.land.soil-=this.farms.updateFarms(this.land.soil),this.farms.tick(this.land.transferWater()),this.population.tick(),this.water.outdoor+=this.farms.transferWater(),this.trees.tick(this.land.transferWater()),this.water.outdoor+=this.trees.transferWater(),this.land.tick(this.clouds.transferWater()),this.clouds.tick(this.water.transferWater()),this.energy.tick(),this.water.tick(this.ice.transferWater()),this.tractorBeam.tick(),this.spaceStation.tick(),this.space.tick(),this.oxygenLeak=this.oxygen/1e5,this.oxygen-=this.oxygenLeak,this.hangar.tick(),this.events.emit("resources:updated"),this.events.emit("tick")}initialize(){this.initializeSystems()}initializeSystems(){this.space=new A,this.ice=new B,this.water=new H,this.clouds=new _,this.land=new G(this.totalLand),this.trees=new X,this.farms=new V,this.population=new K,this.computer=new $,this.robots=new j,this.energy=new Y,this.spaceStation=new D,this.tractorBeam=new q,this.spaceDock=new Q,this.hangar=new U}initializeView(){k?.clearComputerRows();for(let e=0;e<this.computer.processes.length;e++){k?.computerView.addComputerRow(e);let r=this.computer.processes[e];if(r)r.isMoving=!1,r.completions=0}k?.clearRobotRows();for(let e=0;e<this.robots.jobs.length;e++){k?.robotsView.addRobotRow(e);let r=this.robots.jobs[e];if(r)r.completions=0}}buyIce(){let e=this.cash;if(e<=0)return;this.cash-=this.ice.buyIce(e)}buyBattery(){let e=document.getElementById("buyBattery"),r=Number(e.value);if(r*30000>this.oxygen)r=Math.floor(this.oxygen/30000);if(r*20000>this.science)r=Math.floor(this.science/20000);if(r<=0)return;this.oxygen-=r*30000,this.science-=r*20000,this.energy.buyBattery(r)}buyBattleship(){let e=document.getElementById("buyBattleshipAmount"),r=Number(e.value);if(r*30000000>this.oxygen)r=Math.floor(this.oxygen/30000000);if(r*15000000>this.science)r=Math.floor(this.science/15000000);if(r<=0)return;this.oxygen-=30000000*r,this.science-=15000000*r,this.spaceDock.addBattleship(r)}buyHangar(){let r=document.getElementById("buyHangarAmount"),s=Number(r.value);if(s*1e6>this.metal)s=Math.floor(this.metal/1e6);if(s<=0)return;this.metal-=s*1e6,this.hangar.sendRate+=s,this.events.emit("hangar:updated")}}function tt(){if(ge)return;if(ze(),c.startBatch(),t?.tick(),c.endBatch(),Ve%100===0)le()}function rt(e){Se.postMessage({stop:!0}),Se.postMessage({start:!0,ms:1000/e})}function Ee(){et()}var Se=new Worker(new URL("./workers/interval.js",import.meta.url).href);Se.onmessage=function(e){if(e.data==="interval.start")tt()};async function Be(){window.localStorage.terrafold2="",await ve()}function st(){if(k)k.destroy();t=new Ke,t.initialize(),k=new me,t.initializeView(),window.game=t,window.view=k}function ot(){if(!k)return;k.updateFull(),k.refreshLayout()}async function ve(){if(st(),window.localStorage.terrafold2){let e=await ke(window.localStorage.terrafold2),r=JSON.parse(e);if(t)Le(r,t);let s=document.getElementById("scienceSlider");if(s&&t)s.value=t.population.scienceRatio.toString();let i=document.getElementById("farmSlider");if(i&&t)i.value=t.farms.farmRatio.toString()}ot(),k?.refreshLayout(),rt(10)}var it=["text","tooltip","events","canvasWidth","canvasHeight","drawed","isMoving","transferred","foodCreated","convertedLand","takeAmount","foodEaten","popGrowth","starving","scienceDelta","cashDelta","happinessFromTrees","happinessFromOxygen","happiness","fernsDelta","fernsWaterUse","smallTreesDelta","smallTreesWaterUse","treesDelta","treesWaterUse","totalPlants","oxygenGain","woodIncome","woodSpending","metalIncome","metalSpending","oreIncome","oreSpending","oreToDirtSpending","oxygenSpending","waterIncome","waterSpending","cashSpending","scienceSpending","waterFarms","waterTrees","buyIncome"];function Le(e,r){for(let s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&!it.includes(s)){if(typeof e[s]==="object"&&e[s]!==null){if(typeof r[s]>"u")r[s]=Array.isArray(e[s])?[]:{};Le(e[s],r[s])}else if(typeof e[s]!=="function")r[s]=e[s]}}async function le(){let e={};if(t)Le(t,e);window.localStorage.terrafold2=await ye(JSON.stringify(e))}async function He(){await le();let e=document.getElementById("exportImportSave");if(e)e.value=await ye(window.localStorage.terrafold2||""),e.select(),document.execCommand("copy"),e.value=""}async function _e(){let e=document.getElementById("exportImportSave");if(e)window.localStorage.terrafold2=await ke(e.value),await ve()}function Ge(){if(t)t.cash+=0.1}ve();window.game=t;window.view=k;window.pauseGame=Ee;export{k as view,le as save,Ee as pauseGame,Ie as incrementCometId,_e as importSave,t as game,He as exportSave,Be as clearSave,Ge as begForMoney};

//# debugId=91520F5AA2A3B64764756E2164756E21
//# sourceMappingURL=main.js.map
